<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[WenRis Blog]]></title>
  <link href="http://suda-morris.github.io/atom.xml" rel="self"/>
  <link href="http://suda-morris.github.io/"/>
  <updated>2015-11-22T19:24:35+08:00</updated>
  <id>http://suda-morris.github.io/</id>
  <author>
    <name><![CDATA[suda-morris]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[TinyHttpd]]></title>
    <link href="http://suda-morris.github.io/blog/2015/11/22/tinyhttpd/"/>
    <updated>2015-11-22T15:56:10+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/11/22/tinyhttpd</id>
    <content type="html"><![CDATA[<h2>简介</h2>

<ol>
<li>tinyhttpd是一个不到500行的超轻量型Http Server</li>
</ol>


<h2>函数介绍</h2>

<ol>
<li>void accept_request(int);

<ul>
<li>处理从套接字上监听到的一个HTTP请求，在这里可以很大一部分体现服务器处理请求流程</li>
</ul>
</li>
<li>void bad_request(int);

<ul>
<li>返回给客户端这是一个错误请求，HTTP状态码400 BAD REQUEST</li>
</ul>
</li>
<li>void cat(int, FILE *);

<ul>
<li>读取服务器上某个文件写到socket套接字</li>
</ul>
</li>
<li>void cannot_execute(int);

<ul>
<li>主要处理发生在执行cgi程序时出现的错误</li>
</ul>
</li>
<li>void error_die(const char *);

<ul>
<li>将错误信息写到perror并退出</li>
</ul>
</li>
<li>void execute_cgi(int, const char <em>, const char </em>, const char *);

<ul>
<li>运行cgi程序的处理</li>
</ul>
</li>
<li>int get_line(int, char *, int);

<ul>
<li>读取套接字的一行，把回车换行等情况都统一为换行结束符</li>
</ul>
</li>
<li>void headers(int, const char *);

<ul>
<li>把HTTP响应的头部写到套接字</li>
</ul>
</li>
<li>void not_found(int);

<ul>
<li>主要处理找不到请求的文件时的情况</li>
</ul>
</li>
<li>void serve_file(int, const char *);

<ul>
<li>调用cat把服务器文件返回给浏览器</li>
</ul>
</li>
<li>int startup(u_short *);

<ul>
<li>初始化httpd服务，包括建立套接字，绑定端口，进行监听等</li>
</ul>
</li>
<li>void unimplemented(int);

<ul>
<li>返回给浏览器表明收到的HTTP请求所用的method不被支持</li>
</ul>
</li>
</ol>


<h2>源码详解</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
<span class='line-number'>421</span>
<span class='line-number'>422</span>
<span class='line-number'>423</span>
<span class='line-number'>424</span>
<span class='line-number'>425</span>
<span class='line-number'>426</span>
<span class='line-number'>427</span>
<span class='line-number'>428</span>
<span class='line-number'>429</span>
<span class='line-number'>430</span>
<span class='line-number'>431</span>
<span class='line-number'>432</span>
<span class='line-number'>433</span>
<span class='line-number'>434</span>
<span class='line-number'>435</span>
<span class='line-number'>436</span>
<span class='line-number'>437</span>
<span class='line-number'>438</span>
<span class='line-number'>439</span>
<span class='line-number'>440</span>
<span class='line-number'>441</span>
<span class='line-number'>442</span>
<span class='line-number'>443</span>
<span class='line-number'>444</span>
<span class='line-number'>445</span>
<span class='line-number'>446</span>
<span class='line-number'>447</span>
<span class='line-number'>448</span>
<span class='line-number'>449</span>
<span class='line-number'>450</span>
<span class='line-number'>451</span>
<span class='line-number'>452</span>
<span class='line-number'>453</span>
<span class='line-number'>454</span>
<span class='line-number'>455</span>
<span class='line-number'>456</span>
<span class='line-number'>457</span>
<span class='line-number'>458</span>
<span class='line-number'>459</span>
<span class='line-number'>460</span>
<span class='line-number'>461</span>
<span class='line-number'>462</span>
<span class='line-number'>463</span>
<span class='line-number'>464</span>
<span class='line-number'>465</span>
<span class='line-number'>466</span>
<span class='line-number'>467</span>
<span class='line-number'>468</span>
<span class='line-number'>469</span>
<span class='line-number'>470</span>
<span class='line-number'>471</span>
<span class='line-number'>472</span>
<span class='line-number'>473</span>
<span class='line-number'>474</span>
<span class='line-number'>475</span>
<span class='line-number'>476</span>
<span class='line-number'>477</span>
<span class='line-number'>478</span>
<span class='line-number'>479</span>
<span class='line-number'>480</span>
<span class='line-number'>481</span>
<span class='line-number'>482</span>
<span class='line-number'>483</span>
<span class='line-number'>484</span>
<span class='line-number'>485</span>
<span class='line-number'>486</span>
<span class='line-number'>487</span>
<span class='line-number'>488</span>
<span class='line-number'>489</span>
<span class='line-number'>490</span>
<span class='line-number'>491</span>
<span class='line-number'>492</span>
<span class='line-number'>493</span>
<span class='line-number'>494</span>
<span class='line-number'>495</span>
<span class='line-number'>496</span>
<span class='line-number'>497</span>
<span class='line-number'>498</span>
<span class='line-number'>499</span>
<span class='line-number'>500</span>
<span class='line-number'>501</span>
<span class='line-number'>502</span>
<span class='line-number'>503</span>
<span class='line-number'>504</span>
<span class='line-number'>505</span>
<span class='line-number'>506</span>
<span class='line-number'>507</span>
<span class='line-number'>508</span>
<span class='line-number'>509</span>
<span class='line-number'>510</span>
<span class='line-number'>511</span>
<span class='line-number'>512</span>
<span class='line-number'>513</span>
<span class='line-number'>514</span>
<span class='line-number'>515</span>
<span class='line-number'>516</span>
<span class='line-number'>517</span>
<span class='line-number'>518</span>
<span class='line-number'>519</span>
<span class='line-number'>520</span>
<span class='line-number'>521</span>
<span class='line-number'>522</span>
<span class='line-number'>523</span>
<span class='line-number'>524</span>
<span class='line-number'>525</span>
<span class='line-number'>526</span>
<span class='line-number'>527</span>
<span class='line-number'>528</span>
<span class='line-number'>529</span>
<span class='line-number'>530</span>
<span class='line-number'>531</span>
<span class='line-number'>532</span>
<span class='line-number'>533</span>
<span class='line-number'>534</span>
<span class='line-number'>535</span>
<span class='line-number'>536</span>
<span class='line-number'>537</span>
<span class='line-number'>538</span>
<span class='line-number'>539</span>
<span class='line-number'>540</span>
<span class='line-number'>541</span>
<span class='line-number'>542</span>
<span class='line-number'>543</span>
<span class='line-number'>544</span>
<span class='line-number'>545</span>
<span class='line-number'>546</span>
<span class='line-number'>547</span>
<span class='line-number'>548</span>
<span class='line-number'>549</span>
<span class='line-number'>550</span>
<span class='line-number'>551</span>
<span class='line-number'>552</span>
<span class='line-number'>553</span>
<span class='line-number'>554</span>
<span class='line-number'>555</span>
<span class='line-number'>556</span>
<span class='line-number'>557</span>
<span class='line-number'>558</span>
<span class='line-number'>559</span>
<span class='line-number'>560</span>
<span class='line-number'>561</span>
<span class='line-number'>562</span>
<span class='line-number'>563</span>
<span class='line-number'>564</span>
<span class='line-number'>565</span>
<span class='line-number'>566</span>
<span class='line-number'>567</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="cm">/* J. David&#39;s webserver */</span>
</span><span class='line'><span class="cm">/* This is a simple webserver. </span>
</span><span class='line'><span class="cm"> * Created November 1999 by J. David Blackstone. </span>
</span><span class='line'><span class="cm"> * CSE 4344 (Network concepts), Prof. Zeigler </span>
</span><span class='line'><span class="cm"> * University of Texas at Arlington </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cm">/* This program compiles for Sparc Solaris 2.6. </span>
</span><span class='line'><span class="cm"> * To compile for Linux: </span>
</span><span class='line'><span class="cm"> *  1) Comment out the #include &lt;pthread.h&gt; line. </span>
</span><span class='line'><span class="cm"> *  2) Comment out the line that defines the variable newthread. </span>
</span><span class='line'><span class="cm"> *  3) Comment out the two lines that run pthread_create(). </span>
</span><span class='line'><span class="cm"> *  4) Uncomment the line that runs accept_request(). </span>
</span><span class='line'><span class="cm"> *  5) Remove -lsocket from the Makefile. </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;sys/socket.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;netinet/in.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;arpa/inet.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;ctype.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;strings.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;sys/stat.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;pthread.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;sys/wait.h&gt;  </span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;  </span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define ISspace(x) isspace((int)(x))  </span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define SERVER_STRING &quot;Server: jdbhttpd/0.1.0\r\n&quot;  </span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">accept_request</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">bad_request</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">cat</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">cannot_execute</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">error_die</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">execute_cgi</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">get_line</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">headers</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">not_found</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">serve_file</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">startup</span><span class="p">(</span><span class="n">u_short</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">unimplemented</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* A request has caused a call to accept() on the server port to </span>
</span><span class='line'><span class="cm"> * return.  Process the request appropriately. </span>
</span><span class='line'><span class="cm"> * Parameters: the socket connected to the client */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">accept_request</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">numchars</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">method</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">url</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">path</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">size_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">stat</span> <span class="n">st</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">cgi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>      <span class="cm">/* becomes true if server decides this is a CGI program */</span>
</span><span class='line'>    <span class="kt">char</span> <span class="o">*</span><span class="n">query_string</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*得到请求的第一行*/</span>
</span><span class='line'>    <span class="n">numchars</span> <span class="o">=</span> <span class="n">get_line</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="cm">/*把客户端的请求方法存到 method 数组*/</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">ISspace</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">method</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span><span class='line'>        <span class="n">i</span><span class="o">++</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">method</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*如果既不是 GET 又不是 POST 则无法处理 */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s">&quot;GET&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strcasecmp</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s">&quot;POST&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">unimplemented</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* POST 的时候开启 cgi */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s">&quot;POST&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="n">cgi</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*读取 url 地址*/</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">ISspace</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)))</span>
</span><span class='line'>        <span class="n">j</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">ISspace</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*存下 url */</span>
</span><span class='line'>        <span class="n">url</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span><span class='line'>        <span class="n">i</span><span class="o">++</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">url</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*处理 GET 方法*/</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s">&quot;GET&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/* 待处理请求为 url */</span>
</span><span class='line'>        <span class="n">query_string</span> <span class="o">=</span> <span class="n">url</span><span class="p">;</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">((</span><span class="o">*</span><span class="n">query_string</span> <span class="o">!=</span> <span class="sc">&#39;?&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">query_string</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">))</span>
</span><span class='line'>            <span class="n">query_string</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="cm">/* GET 方法特点，? 后面为参数*/</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">query_string</span> <span class="o">==</span> <span class="sc">&#39;?&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="cm">/*开启 cgi */</span>
</span><span class='line'>            <span class="n">cgi</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>            <span class="o">*</span><span class="n">query_string</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="n">query_string</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*格式化 url 到 path 数组，html 文件都在 htdocs 中*/</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;htdocs%s&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*默认情况为 index.html */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">strcat</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;index.html&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*根据路径找到对应文件 */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*把所有 headers 的信息都丢弃*/</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">((</span><span class="n">numchars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">))</span>  <span class="cm">/* read &amp; discard headers */</span>
</span><span class='line'>            <span class="n">numchars</span> <span class="o">=</span> <span class="n">get_line</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span><span class='line'>        <span class="cm">/*回应客户端找不到*/</span>
</span><span class='line'>        <span class="n">not_found</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*如果是个目录，则默认使用该目录下 index.html 文件*/</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">((</span><span class="n">st</span><span class="p">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="n">S_IFMT</span><span class="p">)</span> <span class="o">==</span> <span class="n">S_IFDIR</span><span class="p">)</span>
</span><span class='line'>            <span class="n">strcat</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;/index.html&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="n">st</span><span class="p">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="n">S_IXUSR</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="n">S_IXGRP</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="n">S_IXOTH</span><span class="p">)</span>    <span class="p">)</span>
</span><span class='line'>          <span class="n">cgi</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="cm">/*不是 cgi,直接把服务器文件返回，否则执行 cgi */</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cgi</span><span class="p">)</span>
</span><span class='line'>          <span class="n">serve_file</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>          <span class="n">execute_cgi</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">query_string</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*断开与客户端的连接（HTTP 特点：无连接）*/</span>
</span><span class='line'>    <span class="n">close</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Inform the client that a request it has made has a problem. </span>
</span><span class='line'><span class="cm"> * Parameters: client socket */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">bad_request</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*回应客户端错误的 HTTP 请求 */</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;HTTP/1.0 400 BAD REQUEST</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;Content-type: text/html</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;P&gt;Your browser sent a bad request, &quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;such as a POST without a Content-Length.</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Put the entire contents of a file out on a socket.  This function </span>
</span><span class='line'><span class="cm"> * is named after the UNIX &quot;cat&quot; command, because it might have been </span>
</span><span class='line'><span class="cm"> * easier just to do something like pipe, fork, and exec(&quot;cat&quot;). </span>
</span><span class='line'><span class="cm"> * Parameters: the client socket descriptor </span>
</span><span class='line'><span class="cm"> *             FILE pointer for the file to cat */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">cat</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">resource</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*读取文件中的所有数据写到 socket */</span>
</span><span class='line'>    <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">resource</span><span class="p">);</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">resource</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">resource</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Inform the client that a CGI script could not be executed. </span>
</span><span class='line'><span class="cm"> * Parameter: the client socket descriptor. */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">cannot_execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* 回应客户端 cgi 无法执行*/</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;HTTP/1.0 500 Internal Server Error</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;Content-type: text/html</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;P&gt;Error prohibited CGI execution.</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Print out an error message with perror() (for system errors; based </span>
</span><span class='line'><span class="cm"> * on value of errno, which indicates system call errors) and exit the </span>
</span><span class='line'><span class="cm"> * program indicating an error. */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">error_die</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sc</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="cm">/*出错信息处理 */</span>
</span><span class='line'>    <span class="n">perror</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
</span><span class='line'>    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Execute a CGI script.  Will need to set environment variables as </span>
</span><span class='line'><span class="cm"> * appropriate. </span>
</span><span class='line'><span class="cm"> * Parameters: client socket descriptor </span>
</span><span class='line'><span class="cm"> *             path to the CGI script */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">execute_cgi</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">method</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">query_string</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">cgi_output</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">cgi_input</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">pid_t</span> <span class="n">pid</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">numchars</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">content_length</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s">&quot;GET&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="cm">/*把所有的 HTTP header 读取并丢弃*/</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">((</span><span class="n">numchars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">))</span>  <span class="cm">/* read &amp; discard headers */</span>
</span><span class='line'>            <span class="n">numchars</span> <span class="o">=</span> <span class="n">get_line</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span><span class='line'>    <span class="k">else</span>    <span class="cm">/* POST */</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/* 对 POST 的 HTTP 请求中找出 content_length */</span>
</span><span class='line'>        <span class="n">numchars</span> <span class="o">=</span> <span class="n">get_line</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">((</span><span class="n">numchars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="cm">/*利用 \0 进行分隔 */</span>
</span><span class='line'>            <span class="n">buf</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="cm">/* HTTP 请求的特点*/</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;Content-Length:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                <span class="n">content_length</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">16</span><span class="p">]));</span>
</span><span class='line'>            <span class="n">numchars</span> <span class="o">=</span> <span class="n">get_line</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="cm">/*没有找到 content_length */</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">content_length</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="cm">/*错误请求*/</span>
</span><span class='line'>            <span class="n">bad_request</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* 正确，HTTP 状态码 200 */</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;HTTP/1.0 200 OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* 建立管道*/</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">pipe</span><span class="p">(</span><span class="n">cgi_output</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*错误处理*/</span>
</span><span class='line'>        <span class="n">cannot_execute</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/*建立管道*/</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">pipe</span><span class="p">(</span><span class="n">cgi_input</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*错误处理*/</span>
</span><span class='line'>        <span class="n">cannot_execute</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*错误处理*/</span>
</span><span class='line'>        <span class="n">cannot_execute</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="cm">/* child: CGI script */</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">char</span> <span class="n">meth_env</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
</span><span class='line'>        <span class="kt">char</span> <span class="n">query_env</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
</span><span class='line'>        <span class="kt">char</span> <span class="n">length_env</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/* 把 STDOUT 重定向到 cgi_output 的写入端 */</span>
</span><span class='line'>        <span class="n">dup2</span><span class="p">(</span><span class="n">cgi_output</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/* 把 STDIN 重定向到 cgi_input 的读取端 */</span>
</span><span class='line'>        <span class="n">dup2</span><span class="p">(</span><span class="n">cgi_input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/* 关闭 cgi_input 的写入端 和 cgi_output 的读取端 */</span>
</span><span class='line'>        <span class="n">close</span><span class="p">(</span><span class="n">cgi_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>        <span class="n">close</span><span class="p">(</span><span class="n">cgi_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>        <span class="cm">/*设置 request_method 的环境变量*/</span>
</span><span class='line'>        <span class="n">sprintf</span><span class="p">(</span><span class="n">meth_env</span><span class="p">,</span> <span class="s">&quot;REQUEST_METHOD=%s&quot;</span><span class="p">,</span> <span class="n">method</span><span class="p">);</span>
</span><span class='line'>        <span class="n">putenv</span><span class="p">(</span><span class="n">meth_env</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s">&quot;GET&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="cm">/*设置 query_string 的环境变量*/</span>
</span><span class='line'>            <span class="n">sprintf</span><span class="p">(</span><span class="n">query_env</span><span class="p">,</span> <span class="s">&quot;QUERY_STRING=%s&quot;</span><span class="p">,</span> <span class="n">query_string</span><span class="p">);</span>
</span><span class='line'>            <span class="n">putenv</span><span class="p">(</span><span class="n">query_env</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">{</span>   <span class="cm">/* POST */</span>
</span><span class='line'>            <span class="cm">/*设置 content_length 的环境变量*/</span>
</span><span class='line'>            <span class="n">sprintf</span><span class="p">(</span><span class="n">length_env</span><span class="p">,</span> <span class="s">&quot;CONTENT_LENGTH=%d&quot;</span><span class="p">,</span> <span class="n">content_length</span><span class="p">);</span>
</span><span class='line'>            <span class="n">putenv</span><span class="p">(</span><span class="n">length_env</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="cm">/*用 execl 运行 cgi 程序*/</span>
</span><span class='line'>        <span class="n">execl</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>    <span class="cm">/* parent */</span>
</span><span class='line'>        <span class="cm">/* 关闭 cgi_input 的读取端 和 cgi_output 的写入端 */</span>
</span><span class='line'>        <span class="n">close</span><span class="p">(</span><span class="n">cgi_output</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>        <span class="n">close</span><span class="p">(</span><span class="n">cgi_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s">&quot;POST&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>            <span class="cm">/*接收 POST 过来的数据*/</span>
</span><span class='line'>            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">content_length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">recv</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>                <span class="cm">/*把 POST 数据写入 cgi_input，现在重定向到 STDIN */</span>
</span><span class='line'>                <span class="n">write</span><span class="p">(</span><span class="n">cgi_input</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="cm">/*读取 cgi_output 的管道输出到客户端，该管道输入是 STDOUT */</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="n">cgi_output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>            <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*关闭管道*/</span>
</span><span class='line'>        <span class="n">close</span><span class="p">(</span><span class="n">cgi_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>        <span class="n">close</span><span class="p">(</span><span class="n">cgi_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>        <span class="cm">/*等待子进程*/</span>
</span><span class='line'>        <span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Get a line from a socket, whether the line ends in a newline, </span>
</span><span class='line'><span class="cm"> * carriage return, or a CRLF combination.  Terminates the string read </span>
</span><span class='line'><span class="cm"> * with a null character.  If no newline indicator is found before the </span>
</span><span class='line'><span class="cm"> * end of the buffer, the string is terminated with a null.  If any of </span>
</span><span class='line'><span class="cm"> * the above three line terminators is read, the last character of the </span>
</span><span class='line'><span class="cm"> * string will be a linefeed and the string will be terminated with a </span>
</span><span class='line'><span class="cm"> * null character. </span>
</span><span class='line'><span class="cm"> * Parameters: the socket descriptor </span>
</span><span class='line'><span class="cm"> *             the buffer to save the data in </span>
</span><span class='line'><span class="cm"> *             the size of the buffer </span>
</span><span class='line'><span class="cm"> * Returns: the number of bytes stored (excluding null) */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">get_line</span><span class="p">(</span><span class="kt">int</span> <span class="n">sock</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*把终止条件统一为 \n 换行符，标准化 buf 数组*/</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">((</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;\n&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*一次仅接收一个字节*/</span>
</span><span class='line'>        <span class="n">n</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/* DEBUG printf(&quot;%02X\n&quot;, c); */</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="cm">/*收到 \r 则继续接收下个字节，因为换行符可能是 \r\n */</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\r&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="cm">/*使用 MSG_PEEK 标志使下一次读取依然可以得到这次读取的内容，可认为接收窗口不滑动*/</span>
</span><span class='line'>                <span class="n">n</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MSG_PEEK</span><span class="p">);</span>
</span><span class='line'>                <span class="cm">/* DEBUG printf(&quot;%02X\n&quot;, c); */</span>
</span><span class='line'>                <span class="cm">/*但如果是换行符则把它吸收掉*/</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">((</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">))</span>
</span><span class='line'>                    <span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>                <span class="k">else</span>
</span><span class='line'>                    <span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="cm">/*存到缓冲区*/</span>
</span><span class='line'>            <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>            <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*返回 buf 数组大小*/</span>
</span><span class='line'>    <span class="k">return</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Return the informational HTTP headers about a file. */</span>
</span><span class='line'><span class="cm">/* Parameters: the socket to print the headers on </span>
</span><span class='line'><span class="cm"> *             the name of the file */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">headers</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>    <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">filename</span><span class="p">;</span>  <span class="cm">/* could use filename to determine file type */</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*正常的 HTTP header */</span>
</span><span class='line'>    <span class="n">strcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;HTTP/1.0 200 OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*服务器信息*/</span>
</span><span class='line'>    <span class="n">strcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">SERVER_STRING</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;Content-Type: text/html</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">strcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Give a client a 404 not found status message. */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">not_found</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* 404 页面 */</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;HTTP/1.0 404 NOT FOUND</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*服务器信息*/</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">SERVER_STRING</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;Content-Type: text/html</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;HTML&gt;&lt;TITLE&gt;Not Found&lt;/TITLE&gt;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;BODY&gt;&lt;P&gt;The server could not fulfill</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;your request because the resource specified</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;is unavailable or nonexistent.</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;/BODY&gt;&lt;/HTML&gt;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Send a regular file to the client.  Use headers, and report </span>
</span><span class='line'><span class="cm"> * errors to client if they occur. </span>
</span><span class='line'><span class="cm"> * Parameters: a pointer to a file structure produced from the socket </span>
</span><span class='line'><span class="cm"> *              file descriptor </span>
</span><span class='line'><span class="cm"> *             the name of the file to serve */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">serve_file</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">FILE</span> <span class="o">*</span><span class="n">resource</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">numchars</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*读取并丢弃 header */</span>
</span><span class='line'>    <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">((</span><span class="n">numchars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">))</span>  <span class="cm">/* read &amp; discard headers */</span>
</span><span class='line'>        <span class="n">numchars</span> <span class="o">=</span> <span class="n">get_line</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*打开 sever 的文件*/</span>
</span><span class='line'>    <span class="n">resource</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">resource</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>        <span class="n">not_found</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*写 HTTP header */</span>
</span><span class='line'>        <span class="n">headers</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/*复制文件*/</span>
</span><span class='line'>        <span class="n">cat</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">resource</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">fclose</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* This function starts the process of listening for web connections </span>
</span><span class='line'><span class="cm"> * on a specified port.  If the port is 0, then dynamically allocate a </span>
</span><span class='line'><span class="cm"> * port and modify the original port variable to reflect the actual </span>
</span><span class='line'><span class="cm"> * port. </span>
</span><span class='line'><span class="cm"> * Parameters: pointer to variable containing the port to connect on </span>
</span><span class='line'><span class="cm"> * Returns: the socket */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">startup</span><span class="p">(</span><span class="n">u_short</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">httpd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">name</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*建立 socket */</span>
</span><span class='line'>    <span class="n">httpd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">httpd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">error_die</span><span class="p">(</span><span class="s">&quot;socket&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">name</span><span class="p">));</span>
</span><span class='line'>    <span class="n">name</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'>    <span class="n">name</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="o">*</span><span class="n">port</span><span class="p">);</span>
</span><span class='line'>    <span class="n">name</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">httpd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="n">error_die</span><span class="p">(</span><span class="s">&quot;bind&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*如果当前指定端口是 0，则动态随机分配一个端口*/</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">port</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="cm">/* if dynamically allocating a port */</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">namelen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">getsockname</span><span class="p">(</span><span class="n">httpd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">namelen</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>            <span class="n">error_die</span><span class="p">(</span><span class="s">&quot;getsockname&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="o">*</span><span class="n">port</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">sin_port</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/*开始监听*/</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">httpd</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="n">error_die</span><span class="p">(</span><span class="s">&quot;listen&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*返回 socket id */</span>
</span><span class='line'>    <span class="k">return</span><span class="p">(</span><span class="n">httpd</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="cm">/* Inform the client that the requested web method has not been </span>
</span><span class='line'><span class="cm"> * implemented. </span>
</span><span class='line'><span class="cm"> * Parameter: the client socket */</span>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">unimplemented</span><span class="p">(</span><span class="kt">int</span> <span class="n">client</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* HTTP method 不被支持*/</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;HTTP/1.0 501 Method Not Implemented</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*服务器信息*/</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">SERVER_STRING</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;Content-Type: text/html</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Method Not Implemented</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;/TITLE&gt;&lt;/HEAD&gt;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;BODY&gt;&lt;P&gt;HTTP request method not supported.</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;&lt;/BODY&gt;&lt;/HTML&gt;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**********************************************************************/</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">server_sock</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="n">u_short</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">client_sock</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">client_name</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">client_name_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">client_name</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">pthread_t</span> <span class="n">newthread</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*在对应端口建立 httpd 服务*/</span>
</span><span class='line'>    <span class="n">server_sock</span> <span class="o">=</span> <span class="n">startup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">port</span><span class="p">);</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;httpd running on port %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*套接字收到客户端连接请求*/</span>
</span><span class='line'>        <span class="n">client_sock</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">server_sock</span><span class="p">,(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">client_name</span><span class="p">,</span><span class="o">&amp;</span><span class="n">client_name_len</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">client_sock</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>            <span class="n">error_die</span><span class="p">(</span><span class="s">&quot;accept&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/*派生新线程用 accept_request 函数处理新请求*/</span>
</span><span class='line'>        <span class="cm">/* accept_request(client_sock); */</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newthread</span> <span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">accept_request</span><span class="p">,</span> <span class="n">client_sock</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>            <span class="n">perror</span><span class="p">(</span><span class="s">&quot;pthread_create&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">close</span><span class="p">(</span><span class="n">server_sock</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[i.MX280]]></title>
    <link href="http://suda-morris.github.io/blog/2015/11/12/i-dot-mx280/"/>
    <updated>2015-11-12T15:40:17+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/11/12/i-dot-mx280</id>
    <content type="html"><![CDATA[<h2>Linux内核组成部分</h2>

<ol>
<li>内存管理

<ol>
<li>进程管理负责控制进程对CPU的访问，如任务的创建、调度和终止等。任务调度是进程管理最核心的工作，由Linux内核调度器来完成。Linux内核调度器根据一定算法来选择最值得运行的进程</li>
<li>运行态：已经获得了资源，并且进程正在被CPU执行进程既可以运行在内核态，也可运行在用户态

<ol>
<li>内核态：内核和驱动所运行时的状态，程序处于特权阶级，能够访问系统的任何资源</li>
<li>用户态：用户程序运行的状态，处于非特权阶级，不能随意访问系统资源，必须通过驱动程序方可访问，用户态程序运行的状态，处于非特权阶级，不能随意访问系统资源，必须通过驱动程序方可访问，用户态程序可通过系统调用进入内核态。</li>
</ol>
</li>
<li>就绪态：当系统资源已经可用，但由于前一个进程还没有执行完而释放CPU，准备进入运行状态</li>
<li>可中断睡眠状态：当进程处于可中断等待状态时，系统不会调度改程序执行。当系统产生一个中断或者释放了进程正在等待的资源，或者进程收到一个信号，都可以被唤醒进入就绪状态或者运行态</li>
<li>不可中断睡眠状态：处于中断等待状态，但是该进程只能被使用wake_up（）函数明确唤醒的时候才可进入就绪状态。</li>
<li>暂停状态：当进程收到SIGSTOP、SIGSTP、SIGTTIN或者SIGTTOU就会进入暂停状态，收到SIGCONT信号即可进入运行态</li>
<li>僵死态：进程已经被停止运行，但是其父进程还没有询问其状态
<img src="http://i.imgur.com/bBBsOdX.png" alt="Linux进程状态和转换" /></li>
</ol>
</li>
<li>内存管理

<ul>
<li>内存管理的主要作用是控制和管理多个进程，使之能够安全的共享主内存区域。当CPU提供内存管理单元MMU时，内存管理为各进程实现虚拟地址到内存物理地址的转换。在32位系统上，Linux内核将4G空间分为1G内核空间（3~4G）和3G（0~3G）用户控件，通过内存管理，每个进程都可以使用3G的用户空间</li>
</ul>
</li>
<li>文件系统

<ul>
<li>Linux内核支持众多的逻辑文件系统，如Ext2、Ext3、Ext4、btrfs、NFS、VFAT等。VFS则是Linux基于各种逻辑文件系统抽象出的一种内存中的文件系统，隐藏了各种硬件设备的细节，为用户提供了同意的操作接口，是用户访问各种不同文件系统和设备时，不用区分具体的逻辑文件系统。</li>
</ul>
</li>
<li>网络接口

<ul>
<li>Linux对网络支持相当完善，网络接口提供了对各种网络标准的存取和各种网络硬件的支持，接口可分为网络协议和网络驱动程序。网络协议部分负责实现每一种可能的网络传输协议。网络设备驱动程序负责与硬件设备通讯，每一种可能的硬件设备都有相应的设备驱动程序</li>
</ul>
</li>
<li>进程间通信

<ul>
<li>支持进程间各种通信机制，如管道、命令管道、信号、消息队列、内存共享、信号量和套接字等。

<ol>
<li>管道通常用于具有亲缘关系的父子进程或者兄弟进程间通信，是半双工的，数据只能往一个方向流动，先入先出，与自来水管很相似。如果双方胡同时，需要建立两个管道</li>
<li>命名管道突破了进程间的亲缘关系限制，即非父子、兄弟进程之间也可以相互通信</li>
<li>信号是软件中断，用于在多个进程之间传递一步信号。</li>
<li>信号能传递的信息很有限，而消息队列正好弥补了这点。</li>
<li>共享内存常用于不同进程间进行大量数据传递。Linux下每个进程都有自己的独立空间，各自都不能直接访问其他进程的空间。</li>
<li>信号量用于进程同步。只有获得了信号量的进程才可以运行，没有获得信号量的进程则只能等待。</li>
<li>套接字起源于BSD，也常称“BSD套接字”，用于多个进程间通信，可以基于文件，也可以基于网络。
<img src="http://i.imgur.com/fk3Ryjy.png" alt="Linux操作系统基本体系结构" /></li>
</ol>
</li>
</ul>
</li>
</ol>


<h2>设置主板支持虚拟化</h2>

<ol>
<li>进入BIOS（F2或者F10等等）</li>
<li>找到Intel Virtualization Technology选项，设置为Enable</li>
<li>设置好后重启电脑</li>
</ol>


<h2>虚拟网卡有三种模式</h2>

<ol>
<li>桥接模式

<ol>
<li>这种情况下，虚拟机虚拟出来的操作系统就像是局域网中的一台独立的主机，它可以访问网内任何一台主机。在桥接模式下，虚拟系统和宿主机的关系就像连接在同一个Hub上的两台电脑。用户需要手工为虚拟系统配置IP地址、子网掩码，而且还要和宿主机器处于同一网段，这样虚拟系统才能和宿主机器进行通信。同时，由于这个虚拟系统是局域网中的而一个独立的主机系统，那么就可以手工配置它的TCP/IP配置信息，以实现通过局域网的网关或罗尤其访问互联网。在进行嵌入式Linux开发，要目标板通过NFS挂载虚拟机的NFS共享目录的话，必须将虚拟王珂配置为桥接模式</li>
</ol>
</li>
<li>NAT模式

<ol>
<li>使用NAT模式，就是让虚拟机系统借助NAT（网络地址转化）功能，通过宿主机器在的网络来访问公网。也就是说，使用NAT模式可以实现在虚拟系统里访问互联网。NAT模式下的虚拟系统的TCP/IP配置信息是由VMnet8（NAT）虚拟网络的DHCP服务器提供的，虚拟机无法正常对主机锁链网络中的其他主机提供普通的而络服务，如TFTP、NFS和FTP等。采用NAT模式最大的优势是虚拟系统接入互联网非常简单，用户不需要进行任何其他的配置，只需要宿主机器能访问互联网即可</li>
</ol>
</li>
<li>Host-Only模式

<ol>
<li>在某些特殊的网络调试环境中，要求将真实环境和虚拟环境隔开，这是用户就可采用仅主机（Host-Only）模式。在Host-Only模式中，所有的虚拟系统是可以相互通信的，但虚拟系统和真实的网络是被隔离开的。</li>
</ol>
</li>
</ol>


<h2>简单的Shell</h2>

<ol>
<li>cd -:切换至之前的工作目录</li>
<li>ls -lash:查看当前目录文件信息</li>
<li>pwd：查看当前路径</li>
<li>mkdir -p：创建多级目录</li>
<li>rmdir：删除空目录</li>
<li>alias rm=&ldquo;rm -vi"：为rm -vi取别名</li>
<li>rm -rf:强制删除某些文件或者目录</li>
<li>touch a：创建a文件，文件大小为0</li>
<li>file a：读取a文件的文件头并识别文件类型。a文件必须具有可读属性</li>
<li>more/less：两个命令都能用来浏览文本文件，可以分页查看文件内容，空格翻页。文件浏览完毕，按键盘q退出。相比来说，less命令更加灵活，支持键盘Page Up和Page Down键，可任意向前后翻页浏览，并且还支持文本搜索。使用less打开文件后，输入/abc可在文本中搜索字符串abc</li>
<li>head/tail：这两个命令可分别查看文件头部和文件尾部，一般用于查看ASCII文件。默认显示10行，加上参数-n【数字】可以指定显示行数或者加上参数-c【数字】指定显示的字节数</li>
<li>cat：cat命令可以将一个或者多个文件输出到标准输出上，可以用于文件查看</li>
</ol>


<h2>重定向</h2>

<ol>
<li>Linux Shell终端启动的时候会打开3个标准文件：标准输入（stdin）、标准输出（stdout）和标准错误（stderr）。shell从标准输入（通常是键盘）接收命令，命令执行结果信息打印到标准输出（通常是终端屏幕）上，如有错误信息，则打印到标准错误（通常是终端屏幕）上。</li>
<li>Shell允许用户对输入输出进行重定向。输出重定向允许将输出信息从标准输出重定向到其他文件上，也可以重定向到某个设备如打印机上。</li>
<li>重定向在Linux下用“>”和“>>”表示，“>”表示输出到一个新文件中，而“>>”则表示输出到现有文件的末尾。如果文件已经存在，直接操作文件，否则将创建新文件。</li>
<li>echo命令将内容回显到标准输出上，使用echo命令加上重定向可以创建一个带内容的非空文件。</li>
<li>回显内容如果不加引号，则用单空格替代多个连续空格，如果加了引号，则原封不动回显</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Matlab基础知识]]></title>
    <link href="http://suda-morris.github.io/blog/2015/11/11/matlab/"/>
    <updated>2015-11-11T22:45:49+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/11/11/matlab</id>
    <content type="html"><![CDATA[<h2>几个常用命令</h2>

<ol>
<li>help：查看某个命令的帮助文档</li>
<li>version：获得当前Matlab的版本</li>
<li>pwd：给出当前的工作目录名</li>
<li>dir：ls或dir列出当前目录下的所有文件名清单</li>
<li>cd：改变目录</li>
<li>what：列出当前工作目录下所有的M文件、MAT文件和MEX文件</li>
<li>who：列出当前工作空间里的变量名</li>
<li>clock：时钟设置命令</li>
<li>data：日期设置命令</li>
<li>path：显示MATLAB的当前搜索路径</li>
<li>getenv：getenv（‘matlabpath’）显示当前的MATLAB路径</li>
<li>diary on，diary off：利用diary可以记录MATLAB窗口中进行的所有操作</li>
<li>！（escape）：符号！是MATLAB的扩展运算符，通过该符号，用户有权使用DOS或UNIX命令</li>
<li>demo：该命令引导使用者通过菜单选择为数众多的演示程序</li>
<li>format：数据显示格式。系统默认的数据显示格式是5位</li>
<li>clear：清除命令。</li>
</ol>


<h2>运算符</h2>

<ul>
<li>反除运算符：:该运算符得到商的倒数，即a\b等于b/a</li>
<li>不等于：~=</li>
<li>逻辑与：&amp;</li>
<li>逻辑或：|</li>
<li>逻辑非：~</li>
</ul>


<h2>变量名</h2>

<ol>
<li>区分大小写</li>
<li>长度不能超过31位</li>
<li>变量名以字母开头，可以是字母、数字、下划线组成</li>
</ol>


<h2>分支结构</h2>

<blockquote><p>if-else-end语句中的else子句是可选项
嵌套：if-elseif-elseif-&hellip;-else-end</p></blockquote>

<h2>循环结构</h2>

<blockquote><p>for-end
while-end；该语句中的循环判断语句为矩阵时，当且仅当所有的矩阵元素非零时，逻辑表达式的值为真
break；退出循环体，执行循环后的其他语句</p></blockquote>

<h2>数据输入与输出</h2>

<ol>
<li>input：通过键盘输入数据</li>
<li>fprintf：输出格式化信息和数字</li>
<li>disp：可以在命令窗口输出数字、向量、矩阵或字符串，无需变量名</li>
<li>sprintf：将输出写入字符串</li>
</ol>


<h2>数组</h2>

<ol>
<li>MATLAB中，行数组与行向量是同义语，列数组和列向量是同义语</li>
<li>对于加法和减法，数组运算与线性代数中的向量运算相同。但是符号.*和./分别被称为数组乘法运算符和数组除法运算符，它们不同于矩阵和向量乘除法。</li>
<li>计算数组长度：length（x）</li>
<li>删除数组元素：z（3）=[]</li>
<li>MATLAB里，二维数组变量等同于一个矩阵，每一行的元素以分号结束</li>
<li>二维数组的整行或整列可以用一个冒号表示。例如：m(1,:)和m(:,3)分别表示m的第一列和第三列</li>
<li>只有长度相同的向量才能在if语句中进行比较，如果将两个长度不同的向量进行比较，命令窗口会出现出错信息提示。在if语句中比较字符串之前一定要通过增加空格使字符串长度完全相同</li>
</ol>


<h2>MATLAB特有的数字特性</h2>

<blockquote><p>在MATLAB里，所有的变量均为双精度，整数变量和实数变量之间没有区别，实数变量和复数变量同样也没有区别</p></blockquote>

<h2>初等数学函数</h2>

<ul>
<li>sin(x)</li>
<li>cos(x)</li>
<li>tan(x)</li>
<li>asin(x)</li>
<li>acos(x)</li>
<li>atan(x):[-π/2,π/2]</li>
<li>atan2(y,x):与atan(y/x)结果相同，但是-π/2≥atan2(y,x)≥π</li>
<li>sinh(x)</li>
<li>cosh(x)</li>
<li>tanh(x)</li>
<li>asinh(x)</li>
<li>acosh(x)</li>
<li>atanh(x)</li>
<li>abs(x):x的绝对值</li>
<li>angle(x):复数x的相位角</li>
<li>sqrt(x):x的平方根</li>
<li>real(x)</li>
<li>imag(x)</li>
<li>conj(x):复数x的共轭数</li>
<li>round(x):向最近整数取整</li>
<li>fix(x):向0取整</li>
<li>floor(x):向-∞取整</li>
<li>ceil(x):向+∞取整</li>
<li>sign(x):如果x>0,则为+1；如果x&lt;0,则为-1</li>
<li>mod(x,y)：除后余数：x-y*fix(x/y)</li>
<li>rem(x,y):除后余数：x-y*fix(x/y).如果y≤0，则与mod不同</li>
<li>exp(x):以e为底的指数</li>
<li>log(x):以e为底的对数</li>
<li>log10(x):以10为底的对数</li>
<li>factor(x):将x分解质因数</li>
<li>isprime(x):如果x为素数，值为1，否则为0</li>
<li>factorial(x):x!</li>
</ul>


<h2>功能函数</h2>

<ol>
<li>sort(x):将x按照升序重新排列,如果x是矩阵，则重新排列按列进行</li>
<li>sum(x):如果是x是矩阵，返回值由矩阵各列元素和组成的一个行向量</li>
<li>max(x),min(x):如果x是矩阵，函数值为一个行向量，每个元素为矩阵相应列的最大或最小值</li>
<li>rand(n),返回一个nxn的矩阵，元素全是随机数。除非特别规定，否则所生成的是0~1之间均匀分布的随机数</li>
<li>eval：该命令可以作为字符串被编辑，然后用eval执行。字符串可以通过input读取，或在程序中创建</li>
</ol>


<h2>M文件</h2>

<ol>
<li>M文件可以分为脚本文件和函数文件两种</li>
<li>脚本文件操作对象为MATLAB工作空间内的变量，并且在脚本执行结束后，脚本中对变量的一切操作均会被保留。在MATLAB语言中也可以在脚本内部定义变量，并且该变量将会自动地被加入到当前的MATLAB工作空间中，并可以为其他的脚本或函数引用，直到MATLAB被关闭或采用一定的命令将其删除</li>
<li>MATLAB语言的函数文件包含5个部分：

<ol>
<li>函数题头：指函数的定义行，是函数语句的第一行，在该行中将定义函数名，输入变量列表以及输出变量列表等</li>
<li>HI行：指函数帮助文档的第一行</li>
<li>帮助信息</li>
<li>函数体</li>
<li>注释部分：注释语句是以%引导的</li>
</ol>
</li>
<li>echo on,echo off:M文件执行过程中，其命令语句通常不出现在屏幕上，但是当echo on命令将echo开启后，屏幕上会显示所有语句。这时，用户可以看到正在执行的那部分M文件。</li>
<li>开发函数M文件最基本且很有效的一个办法是将第一行的函数语句用%注释掉，然后作为一个命令M文件进行测试。测试通过后，再将函数语句恢复</li>
</ol>


<h2>保存和载入数据</h2>

<ol>
<li>save，load：如果直接使用save，则所有当前变量将被保存到默认文件matlab.mat里。load是与save相反的命令，它取回所有被save保存的变量。</li>
<li>save file_name data-ascii：save能以ASCII码格式保存数据。带有ASCII选项的save和load非常重要，因为他们可以从MATLAB导入和导出数据</li>
<li>自动创建文件名：在一个M文件中，常常需要自动创建一些文件名。如果整条命令连同文件名写为一个字符串，则可通过eval执行。</li>
</ol>


<h2>硬拷贝</h2>

<ul>
<li>使用diary命令制作一个屏幕内容的拷贝，如果其后不加任何文件名，屏幕内容将存入名为diary的文件中，此文件可以用文本方式打开。但是在diary文件里无法得到图形</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UML-Knowledges]]></title>
    <link href="http://suda-morris.github.io/blog/2015/11/10/uml-knowledges/"/>
    <updated>2015-11-10T15:44:29+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/11/10/uml-knowledges</id>
    <content type="html"><![CDATA[<h2>StarUML 软件破解</h2>

<ol>
<li><a href="http://staruml.io">官网地址</a></li>
<li>该软件为跨平台的UML建模工具，采用NodeJs编写</li>
<li>破解：安装目录/www/license/node/LicenseManagerDomain.js文件修改为如下：</li>
</ol>


<figure class='code'><figcaption><span>LicenseManagerDomain.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">NodeRSA</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-rsa&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">validate</span><span class="p">(</span><span class="nx">PK</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">product</span><span class="p">,</span> <span class="nx">licenseKey</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">pk</span><span class="p">,</span> <span class="nx">decrypted</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;morris&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">product</span><span class="o">:</span> <span class="s2">&quot;StarUML&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">licenseType</span><span class="o">:</span> <span class="s2">&quot;vip&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">quantity</span><span class="o">:</span> <span class="s2">&quot;suda_morris.github.io&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">licenseKey</span><span class="o">:</span> <span class="s2">&quot;later equals never!&quot;</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>        <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">pk</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NodeRSA</span><span class="p">(</span><span class="nx">PK</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">decrypted</span> <span class="o">=</span> <span class="nx">pk</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">licenseKey</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">terms</span> <span class="o">=</span> <span class="nx">decrypted</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">terms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">product</span><span class="o">:</span> <span class="nx">product</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">licenseType</span><span class="o">:</span> <span class="nx">terms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span class='line'>                <span class="nx">quantity</span><span class="o">:</span> <span class="nx">terms</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span class='line'>                <span class="nx">licenseKey</span><span class="o">:</span> <span class="nx">licenseKey</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Initializes the domain with several commands.</span>
</span><span class='line'><span class="cm">     * @param {DomainManager} domainManager The DomainManager for the server</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">domainManager</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">domainManager</span><span class="p">.</span><span class="nx">hasDomain</span><span class="p">(</span><span class="s2">&quot;LicenseManager&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">domainManager</span><span class="p">.</span><span class="nx">registerDomain</span><span class="p">(</span><span class="s2">&quot;LicenseManager&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">major</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">minor</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nx">domainManager</span><span class="p">.</span><span class="nx">registerCommand</span><span class="p">(</span>
</span><span class='line'>            <span class="s2">&quot;LicenseManager&quot;</span><span class="p">,</span> <span class="c1">// domain name</span>
</span><span class='line'>            <span class="s2">&quot;validate&quot;</span><span class="p">,</span>       <span class="c1">// command name</span>
</span><span class='line'>            <span class="nx">validate</span><span class="p">,</span>         <span class="c1">// command handler function</span>
</span><span class='line'>            <span class="kc">false</span><span class="p">,</span>            <span class="c1">// this command is synchronous in Node (&quot;false&quot; means synchronous&quot;)</span>
</span><span class='line'>            <span class="s2">&quot;Validate License&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="p">[</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;PK&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;PK&quot;</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;name of license owner&quot;</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;product name&quot;</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;licenseKey&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;license key&quot;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="p">[</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="c1">// return values</span>
</span><span class='line'>                    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;result&quot;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">exports</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}());</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>打开软件，，help->Enter License,随便输入用户名密码即可破解成功</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Review C++]]></title>
    <link href="http://suda-morris.github.io/blog/2015/11/09/c++Primer/"/>
    <updated>2015-11-09T18:08:50+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/11/09/c++Primer</id>
    <content type="html"><![CDATA[<h2>补码的好处</h2>

<ol>
<li>0的表示唯一</li>
<li>符号位可以直接参与运算</li>
</ol>


<h2>常用的I/O流类库操纵符</h2>

<ol>
<li>dec：数值数据采用十进制表示</li>
<li>hex：数值数据采用十六进制表示</li>
<li>oct： 数值数据采用八进制表示</li>
<li>ws：  提取空白符</li>
<li>endl：插入换行符，并刷新流</li>
<li>ends： 插入空字符</li>
<li>setsprecision(int)： 设置浮点数的小数位数（包括小数点）</li>
<li>setw(int)： 设置域宽</li>
</ol>


<h2>类型别名</h2>

<ol>
<li>typedef 已有类型名 新类型名</li>
<li>using 新类型名 = 已有类型名</li>
</ol>


<h2>auto类型与decltype类型</h2>

<ol>
<li>auto：编译器通过初始值自动推断变量的类型</li>
<li>decltype：定义一个变量与某一表达式的类型相同，但并不用该表达式初始化变量

<ol>
<li>decltype（i） j=2,表示j以2作为初始值，类型与i一致</li>
</ol>
</li>
</ol>


<h2>引用类型</h2>

<ol>
<li>引用（&amp;）是标识符的别名

<ol>
<li>int i；int &amp;ri = i；</li>
</ol>
</li>
<li>定义一个引用时，必须同时对它初始化，使它指向一个已存在的对象</li>
<li>一旦一个引用被初始化后，就不能改为指向其它对象</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LCD]]></title>
    <link href="http://suda-morris.github.io/blog/2015/11/05/lcd/"/>
    <updated>2015-11-05T10:19:01+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/11/05/lcd</id>
    <content type="html"><![CDATA[<h2>TFTLCD驱动芯片</h2>

<ul>
<li>ILI9341、ILI9325、RM68042、RM68021、ILI9320、ILI9328、LGDP4531、SSD1289等</li>
</ul>


<h2>ILI9341</h2>

<ol>
<li>自带显存，其显存总大小为172800（240X320X18/8），即18位模式下（26万色）的显存量。在16位模式下，ILI9341采用RGB565格式存储颜色数据</li>
<li>ILI9341所有的指令都是8位的，高8位无效，且参数除了读写GRAM的时候是16位，其他操作参数都是8位的。这个和ILI9320等驱动器不一样</li>
<li>命令

<ol>
<li>0xD3，这个是读ID4指令，用于读取LCD控制器的ID，这可以用来判断所用的LCD驱动器是什么型号，这样就可以根据控制器的型号去执行对应驱动IC的初始化代码。0xD3指令后跟了4个参数，最后2个参数读出来是0x93和0x41</li>
<li>0x36，这个是存储访问控制指令，可以控制ILI9341存储器的读写方向。简单说木九十在连续写GRAM的时候，可以控制GRAM指针增长的方向，从而控制显示方式。0x36指令后面紧跟一个参数，用来设置GRAM自增方式</li>
<li>0x2A，这是列地址设置指令，在从左到右、从上到下的扫描方式（默认）下面，该指令用于设置横坐标（x坐标）。该指令带有4个参数，实际上是2个坐标值：SC和EC，即列地址的起始值和结束值，SC必须小于等于EC。一般在设置x坐标的时候，我们只需要带2个参数即可，也就是设置SC即可，因为EC没有变化，我们只需要设置一次即可（在初始化ILI9341的时候设置）</li>
<li>0x2B，是页地址设置指令，在从左到右、从上到下的扫描方式（默认）下面，该指令用于设置纵坐标（y坐标）</li>
<li>0x2C，该指令是写GRAM指令，在发送该指令之后，我们便可以网LCD的GRAM里面写入颜色数据了。该指令支持连续写。ILI9341在收到0x2C指令之后，数据有效位宽变为16位，我们可以连续写入LCD GRAM值，而GRAM的地址将根据MY/MX/MV设置的扫描方式进行自增。</li>
<li>0x2E，该指令是读GRAM指令，用于读取ILI9341的显存GRAM。ILI9341在收到该指令后，第一次输出的是dummy数据，也就是无效的数据，第二次开始读取到的才是有效的GRAM数据（从坐标SC、SP开始），输出规律为：每个颜色分量占8位，一次输出2个颜色分量。比如第一次输出的是R1G1，随后的规律为B1R2->G2B2->R3G3->B3R4->G4B4->R5G5&hellip;以此类推。</li>
</ol>
</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CMOS图像传感器OV7670]]></title>
    <link href="http://suda-morris.github.io/blog/2015/11/04/ov7670/"/>
    <updated>2015-11-04T20:19:43+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/11/04/ov7670</id>
    <content type="html"><![CDATA[<h2>OV7670简介</h2>

<ol>
<li>通过SCCB总线控制，可以输出整帧、子采样、取窗口等方式及各种分辨率的8位影响数据。VGA图像最高达到30帧/秒。用户可以完全控制图像质量、数据格式和传输方式</li>
<li>具有自动曝光控制、自动增益控制、自动白平衡，自动消除灯光条纹、自动黑电平校准等自动影像控制功能</li>
<li>支持VGA、GIF和从CIF到40X30的各种尺寸。</li>
<li>所有图像处理功能过程包括伽马曲线、白平衡、饱和度、色度等都可以通过SCCB接口编程。</li>
<li>OV7670 CMOS图像传感器通过减少或消除光学或电子缺陷（如固定图案噪声、拖尾、浮散等），提高图像质量，得到清晰的稳定的彩色图像</li>
<li>OV7670芯片内部有：感光阵列、模拟信号处理模块（包括自动增益和自动白平衡）、10位的ADC、测试图案发生器（八色彩条图案渐变至黑白色条图案）、数字信号处理器（控制由原始信号差值到RGB信号的过程，并控制边缘锐化、颜色空间转换等图像质量处理）、图像缩放模块（按照预先设置的要求输出数据格式）、时许发生模块（产生阵列控制和帧率、帧率的时序、自动曝光控制、输出外部时序）、数字视频端口、SCCB接口、LED和闪光灯输出控制电路等</li>
</ol>


<h2>OV7670参数</h2>

<ol>
<li>感光阵列：640*480</li>
<li>稳定工作温度0~50℃</li>
<li>输出格式：

<ol>
<li>YUV/YCbCr4:2:2</li>
<li>RGB565/555/444</li>
<li>GRB4:2:2</li>
<li>Raw RGB Data</li>
</ol>
</li>
<li>光学尺寸：1/6″</li>
<li>视场角：25°</li>
<li>最大帧率：VGA30 f/s</li>
</ol>


<h2>视频帧存储器AL422B简介</h2>

<ol>
<li>AL422B是一个存储容量为3Mb的视频帧存储器，能够配置为384KB（393，216）X8b FIFO，支持VGA、CCIR、NTSC、PAL和HDTV分辨率</li>
<li>具有独立的读写操作能力，读/写周期时间为20ns，访问时间为15ns，具有高速异步串行存取、输出使能控制、自行刷新数据等功能。</li>
<li>目前1帧图像信息通常包含640X480或者720X480字节。</li>
<li>操作过程：

<ol>
<li>初始化。上电后，分别给nWRST和nRRST各0.1ms的初始化脉冲，使AL422B初始化。</li>
<li>复位操作。通常，复位信号可在任何时候给出而不考虑nWE，nRE以及nOE的状态，但是它们仍然要参照时钟信号的输入情况，使它们满足建立时间和保持时间的要求。如果在禁止时钟周期内给给出复位信号，必须等到允许周期到来后才会执行复位操作。当nWRST和nRRST均为低电平时，数据的输入和输出均从地址0开始</li>
<li>写操作。当写使能信号nWE为低电平时，在WCK信号的上升沿，数据通过DI7~DI0写入寄存器，参照WCK的输入周期，写入的数据必须满足建立时间和保持时间的要求。当nWE为高电平时，写操作被禁止，写地址指针停在当前位置上；当nWE再次变为低电平时，写地址指针从当前位置继续开始</li>
<li>读操作。当读使能nRE和数据输出使能nOE均为低电平时，在RCK信号的上升沿，数据由DO7~DO0输出。当nRE为高电平时，读地址指针停在当前位置上；当nRE再次变为低电平时，读地址指针从当前位置开始。执行读操作时，nOE须为低电平，如nOE为高电平，则数据输出端均为高阻态，且读地址指针任然同步加1.nRE和nOE须参照RCK的输入周期，满足建立时间和保持时间的要求。</li>
</ol>
</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SD卡与文件系统]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/30/sd-card-driver/"/>
    <updated>2015-10-30T16:58:07+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/30/sd-card-driver</id>
    <content type="html"><![CDATA[<h2>Micro SD卡简介</h2>

<p><img src="http://i.imgur.com/baGsEky.jpg" alt="SD卡" /></p>

<ol>
<li>Micro SD卡的控制指令功能强大，支持SPI、SDIO模式，兼容MMC。在SPI模式下，CS/MOSI/MISO/CLK都需要加10~100K左右的上拉电阻</li>
<li>SD卡有5个寄存器

<ol>
<li>CID：128比特，卡标识寄存器,只读</li>
<li>RCA：16比特，相对卡地址寄存器，即本地系统中卡的地址，动态变化，在主机初始化的时候确定。SPI模式中没有此寄存器</li>
<li>CSD：128比特，卡描述数据，主要存储了卡的容量、数据格式、DSR寄存器是否可用、数据传输相关参数、数据传输速度、最大的数据访问时间、最大的读写数据块长度等，是可配置寄存器</li>
<li>SCR：64比特，SD配置寄存器，即SD卡特定信息数据如：SCR版本号、SD卡版本号、是否支持安全性、擦除后卡状态默认值、SD总线宽度等，由生产商在卡生产阶段写入</li>
<li>OCR：32比特，操作条件寄存器,提供SD Host查询SD卡支持的电压范围，是否是大容量卡OCR[30],卡省电过程是否结束OCR[31]</li>
</ol>
</li>
<li>每发送一个命令，SD卡都会给出一个应答，以告知主机该命令的执行情况，或者返回主机需要获取的数据。SPI模式下，SD卡针对不同的命令，应答可以是R1~R7。命令与响应都是MSB优先。除了SEND_STATUS和READ_OCR指令外，其他指令的响应格式都是R1，格式R1的长度是1Byte，并且最高位总是0，其余每位均是错误提示，在指令接收过程中发生了什么样的错误，对应的错误位就会是‘1’。R1b和R1具有相同的格式，它将伴随一个附加的busy信号，busy信号的长度可以是任意个字节，全0表示卡处在“忙”的状态。格式R2的长度为2字节，它是指令SEND_STATUS的响应，它的高字节和R1相同，低字节同样作为状态提示。格式R3的长度是5字节，它是指令READ_OCR的响应，最高字节和R1相同，其余4字节包含SD卡的OCR寄存器信息</li>
<li>在SD卡收到复位命令（CMD0）时，CS为低电平则SD卡的SPI模式被启用。不过在发送CMD0之前，要发送>74个时钟这是因为SD卡内部有一个供电电压上升时间，大概为64个CLK，剩下的10个CLK用于SD卡同步，之后才能开始CMD0的操作。在卡初始化的时候，CLK时钟最大不能超过400KHz</li>
<li>对SD卡的常用基本操作主要由：单块读、连续读、单块写、连续写。SPI模式下，通过向SD卡发送响应的命令并读取相应的响应来实现对SD卡的控制。</li>
</ol>


<h2>SD 命令</h2>

<ol>
<li>命令:每个命令都有一个起始位和结束位，总长度为48 bits，并且每个命令都有 7 bits 的CRC 校验码，高字节优先传输
<img src="http://i.imgur.com/sDb6XU5.jpg" alt="SD Command" /></li>
<li>Command 共分为12类（class0 - class11），在寄存器CSD中有12 bits CCC（Card Command Class）对本卡支持的分类进行描述
<img src="http://i.imgur.com/2QG9Ein.jpg" alt="SD命令" /></li>
<li>几个重要的命令
<img src="http://i.imgur.com/Xh1BWEV.png" alt="常用命令" /></li>
<li>CMD8命令格式
<img src="http://i.imgur.com/9oboqjq.jpg" alt="CMD8" /></li>
</ol>


<h2>SD 应答</h2>

<ol>
<li>R1响应格式
<img src="http://i.imgur.com/ZYbXuth.png" alt="R1响应格式" /></li>
</ol>


<h2>SD卡初始化</h2>

<p><img src="http://i.imgur.com/ccW4YbS.jpg" alt="SD卡初始化流程" /></p>

<ol>
<li>配置时钟，慢速一般为400Hz，设置工作模式</li>
<li>发送CMD0，对卡进行软复位，进入空闲态，该指令没有反馈</li>
<li>发送CMD8命令用于读取卡的接口信息，如果是SD2.0，则支持CMD8命令；如果是SD1.x，MMC，则不支持CMD8</li>
<li>发送CMD55+ACMD41，判断当前电压是否在卡的工作范围内，看卡能否识别命令，如果是MMC卡，则CMD55不能被识别，短反馈</li>
<li>发送CMD2，验证SD卡是否接入，长反馈</li>
<li>发送CMD3，读取SD卡的RCA地址，短反馈</li>
<li>以RCA作为参数，发送CMD9读取CSD，长反馈</li>
<li>发送CMD7，选中要操作的SD卡，短反馈</li>
<li>配置告诉时钟，准备数据传输，一般为20~25MHz</li>
<li>设置工作模式：DMA、中断或者查询模式</li>
</ol>


<h2>SD卡读取数据流程</h2>

<ol>
<li>发送CMD17</li>
<li>接收卡响应R1</li>
<li>接收数据起始令牌0xFE</li>
<li>接收数据</li>
<li>接收2字节的CRC，如果不使用CRC，这两个字节在读取后可以丢掉</li>
<li>禁止片选之后，发多8个CLK</li>
</ol>


<h2>SD卡写数据流程</h2>

<ol>
<li>发送CMD24</li>
<li>接收卡响应R1</li>
<li>发送写数据起始令牌0xFE</li>
<li>发送数据</li>
<li>发送2字节的伪CRC</li>
<li>禁止片选之后，发多8个CLK</li>
</ol>


<h2>SD卡读数据块操作</h2>

<ol>
<li>在读数据块模式下，数据传输的基本单元是数据块，它的大小在CSD中（READ_BL_LEN）定义</li>
<li>为了保证数据传输的正确，每个数据块后都有一个CRC校验码。</li>
<li>CMD17（Read_Single_Block）启动一次读数据块操作，在传输结束后返回返回到发送状态。</li>
<li>CMD18（Read_Multiple_Block）启动一次连续多个数据块的读操作</li>
<li>主机可以在多数据块读操作的任何时候终止操作，而不管操作的类型。发送停止传输命令即可终止操作</li>
<li>如果在多数据块读操作中，卡检测到错误（如越界，地址错位或内部错误），它将停止数据传输并仍处于数据状态；此时主机必须发送停止传输命令，终止操作</li>
</ol>


<h2>FATFS简介</h2>

<ol>
<li>FATFS是一个完全免费开源的FAT文件系统模块，专门为小型的嵌入式系统而设计。支持FAT12、FAT16和FAT32，支持多个存储媒介；有独立的缓冲区，可以对多个文件进行读/写。</li>
<li>拥有多种配置选项：

<ol>
<li>支持多卷（物理驱动器或分区，最多10个卷）</li>
<li>多个ANSI/OEM代码页包括DBCS</li>
<li>支持长文件名、ANSI/OEM或Unicode</li>
<li>支持RTOS</li>
<li>支持多种扇区大小</li>
<li>只读、最小化的API和I/O缓冲区等</li>
</ol>
</li>
<li>需要我们编写移植代码的是FATFS模块提供的底层接口，包括存储媒介读/写接口(disk I/O)和供给文件创建修改时间的实时时钟

<ol>
<li>ffconf.h:FATFS模块配置文件</li>
<li>ff.h:FATFS和应用模块共用的包含文件</li>
<li>ff.c:FATFS模块</li>
<li>diskio.h:FATFS和disk I/O模块共用的包含文件</li>
<li>interger.h:数据类型定义</li>
<li>option：可选的外部功能(比如支持中文等)</li>
<li>diskio.c:FATFS和disk I/O模块接口层文件</li>
</ol>
</li>
<li>ffconf.h

<ol>
<li>_CODE_PAGE,根据具体使用的而语言在ffconf.h中定义具体的宏定义。如果使用简体中文，则选择936；如果使用英文，则选择437；如果使用日文，则选择932。打开option文件夹，打开cc936.c文件，里面有一个很大的数组static const WCHAR uni2oem[]。这个数组用于unicode码和OEM码之间的相互转换。接下来又有两个函数，ff_convert()和ff_wtoupper()具体执行码型转换和将字符串转换为大写。unicode是一种双字节字符编码，无论中文还是英文，或者其他语言统一到2字节。与现有的任何编码都不兼容。WindowsNT的内核即使用该编码，所有数据进入内核前转换成UNICODE，退出内核后再转换成版本相关的编码(通常称为OEM，在简体中文下即为GB)</li>
<li>_FS_TINY，使用浓缩版的FATFS就设置为1</li>
<li>_FS_READONLY,这个用来配置是不是只读</li>
<li>_USE_STRFUNC,这个用来设置是否支持字符串类操作，比如f_putc,f_puts等</li>
<li>_USE_MKFS,这个用来设置是否使能格式化</li>
<li>_USE_FASTSEEK，这个用来使能快速定位</li>
<li>_USE_LABEL,这个用来设置是否支持磁盘盘符（磁盘名字）读取与设置</li>
<li><em>USE_LFN,该选项用于设置是否支持长文件名，还需要</em>CODE_PAGE支持，取值范围为0~3。0表示不支持长文件名，1~3是支持长文件名，但是存储地方不一样</li>
<li>_VOLUMES,用于设置FATFS支持的逻辑设备数目</li>
<li>_MAX_SS,扇区缓冲的最大值，一般设置为512</li>
</ol>
</li>
<li>ff.h中的函数定义

<ol>
<li>FRESULT f_mount (FATFS<em> fs, const TCHAR</em> path, BYTE opt);加载文件系统

<ul>
<li>fs表示文件系统对象，path表示本地设备驱动号，opt=1表示立即挂载，0表示延迟挂载</li>
</ul>
</li>
<li>FRESULT f_lseek (FIL* fp, DWORD ofs);移动文件的读写指针

<ul>
<li>ofs表示文件偏移量的数目</li>
</ul>
</li>
<li>FRESULT f_close (FIL* fp);关闭打开的文件对象</li>
<li>FRESULT f_opendir (DIR<em> dp, const TCHAR</em> path);打开目录，返回目录对象</li>
<li>FRESULT f_readdir (DIR<em> dp, FILINFO</em> fno);读取目录获得文件信息</li>
<li>FRESULT f_stat (const TCHAR<em> path, FILINFO</em> fno);读取文件的状态</li>
<li>FRESULT f_getfree (const TCHAR<em> path, DWORD</em> nclst, FATFS** fatfs);获取驱动器上的空闲簇数</li>
<li>FRESULT f_truncate (FIL* fp);截断文件</li>
<li>FRESULT f_sync (FIL* fp);刷新写文件的缓冲数据</li>
<li>FRESULT f_unlink (const TCHAR* path);删除目录中的一个文件</li>
<li>FRESULT f_mkdir (const TCHAR* path);创建一个新目录</li>
<li>FRESULT f_chmod (const TCHAR* path, BYTE attr, BYTE mask);更改文件/目录的属性</li>
<li>FRESULT f_utime (const TCHAR<em> path, const FILINFO</em> fno);更改文件/目录的时间戳</li>
<li>FRESULT f_rename (const TCHAR<em> path_old, const TCHAR</em> path_new);重命名/移动文件或目录</li>
<li>FRESULT f_forward (FIL<em> fp, UINT(</em>func)(const BYTE<em>,UINT), UINT btf, UINT</em> bf);转发数据流</li>
<li>FRESULT f_mkfs (const TCHAR* path, BYTE sfd, UINT au);在驱动器上创建一个文件系统</li>
<li>FRESULT f_chdir (const TCHAR* path);改变当前目录</li>
<li>FRESULT f_chdrive (const TCHAR* path);更改当前驱动器</li>
<li>int f_putc (TCHAR c, FIL* fp);</li>
<li>int f_puts (const TCHAR<em> str, FIL</em> cp);</li>
<li>int f_printf (FIL<em> fp, const TCHAR</em> str, &hellip;);</li>
<li>TCHAR<em> f_gets (TCHAR</em> buff, int len, FIL* fp);</li>
</ol>
</li>
<li>diskio.c(需要用户提供如下几个函数接口)

<ol>
<li>DSTATUS disk_initialize (BYTE pdrv);初始化磁盘驱动器</li>
<li>DSTATUS disk_status (BYTE pdrv);获取磁盘状态</li>
<li>DRESULT disk_read (BYTE pdrv, BYTE* buff, DWORD sector, UINT count);读扇区</li>
<li>DRESULT disk_write (BYTE pdrv, const BYTE* buff, DWORD sector, UINT count);写扇区</li>
<li>DRESULT disk_ioctl (BYTE pdrv, BYTE cmd, void* buff);设备相关的控制特性</li>
<li>get_fattime获取当前时间</li>
</ol>
</li>
<li>簇：文件数据分配的基本单位</li>
<li>FAT文件系统依次应该为:引导扇区、文件分配表两个、根目录区和数据区</li>
</ol>


<h2>汉字字库</h2>

<ol>
<li>常用的汉字内码系统有GB2312，GB13000，GBK，BIG5（繁体）等几种，其中GB2312支持的汉字仅有几千个，很多时候不够用，而GBK内码不仅完全兼容GB2312，还支持繁体字，总汉字数量达到2万多个。</li>
<li>每个GBK码由2字节组成，第一个字节为0X81~0xFE，第二个字节分为两部分，一是0x40~0x7E，二是0x80~0xFE。第一个字节代表的意义称为区，GBK里面总共有126个区，每个区内有190个汉字。</li>
<li></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FRDM_KL02Z]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/26/frdm-kl02z/"/>
    <updated>2015-10-26T15:51:29+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/26/frdm-kl02z</id>
    <content type="html"><![CDATA[<h2>FRDM_KL02Z开发板简介</h2>

<ol>
<li>MKL02Z32VFM4 MCU – 48 MHz、32 KB闪存、4 KB SRAM、32QFN</li>
<li>电容滑动触摸传感板，MMA8451Q加速度传感器，三色LED</li>
<li>新型OpenSDA调试接口：

<ol>
<li>大容量存储设备闪存编程接口(默认)；无需安装任何工具即可评估演示应用</li>
<li>P&amp;E调试接口具有运行控制调试功能并兼容IDE工具</li>
<li>CMSIS-DAP接口：面向嵌入式调试接口的ARM新标准</li>
</ol>
</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[STM32_L4]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/26/stm32-l4/"/>
    <updated>2015-10-26T14:54:05+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/26/stm32-l4</id>
    <content type="html"><![CDATA[<h2>STM32L4系列超低功耗微控制器简介</h2>

<ol>
<li>最高主频80MHz，凭借带有DSP和浮点单元（FPU）的ARM® Cortex®-M4内核扩展了超低功耗产品系列及其性能。</li>
<li>提供USB（支持OTG2.0全速，LPM和BCD）</li>
<li>带有LCD驱动（4X44或8X40，带有升压转换器）</li>
<li>存储器范围可以利用SDIO、Quad SPI和FSMC接口轻松扩展</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[碎片阅读]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/18/short-news-and-knowledges/"/>
    <updated>2015-10-18T11:10:22+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/18/short-news-and-knowledges</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NEO-M8N]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/16/neo-m8n/"/>
    <updated>2015-10-16T09:06:12+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/16/neo-m8n</id>
    <content type="html"><![CDATA[<h2>NEO-M8N模块</h2>

<ol>
<li>内嵌USB转串口功能</li>
<li>三维位置定位</li>
<li>测速</li>
<li>授时</li>
<li>MAXIM公司20.5dB高增益LNA芯片</li>
<li>应用场合：

<ol>
<li>语音报站</li>
<li>航模，飞控，无人机</li>
<li>同步授时</li>
<li>汽车导航</li>
</ol>
</li>
<li>接收制式：

<ol>
<li>GPS</li>
<li>GLONASS</li>
<li>Galileo</li>
<li>BeiDou</li>
<li>QZSS</li>
<li>SBAS</li>
</ol>
</li>
<li>72路接收通道</li>
<li>水平定位精度：2米（空旷地）</li>
<li>输出频率1Hz~10Hz</li>
<li>速度精度：0.1m/s</li>
<li>加速度精度：0.1m/s2</li>
<li>最大高度18000米，最大速度515m/s</li>
<li>最大加速度4g</li>
<li>基于UBX协议进行模块的配置</li>
<li>IIC接口的SDA与SCL已经内部接了上拉电阻</li>
</ol>


<h2>XH414法拉电容</h2>

<ol>
<li>参数:3.3V 0.07F</li>
<li>功能和锂电池一样，在主电源掉电的时候可以为GPS模块的RTC部分供电，以使GPS模块在下次启动时能快速搜索到卫星，一般可维持供电1小时</li>
</ol>


<h2>NMEA-0183协议</h2>

<ol>
<li>NMEA是美国国家海洋电子协会为海用电子设备指定的标准格式，目前已经成为了GPS导航设备统一的RTCM标准协议</li>
<li>NMEA-0183是一套定义接收机输出的标准信息，有几种不同的二格式，每种都是独立相关的ASCII，使用逗号隔开数据，数据流长度30-100字符不等，通常以每秒间隔选择输出，最常用的格式为“GGA”，它包含了定位时间，纬度，经度，高度，定位所用的卫星数，DOP值，差分状态和校正时段，其他的有速度，跟踪，日期等。</li>
<li>NMEA-0183常用语句格式说明：

<ol>
<li>$GPGGA:全球定位数据，最大帧长72</li>
<li>$GPGSA：卫星PRN数据，最大帧长65</li>
<li>$GPGSV：卫星状态信息，最大帧长210</li>
<li>$GPRMC：推荐最小数据，最大帧长70</li>
<li>$GPVTG：地面速度信息，最大帧长34</li>
<li>$GPGLL：大地坐标信息</li>
<li>$GPZDA：UTC时间和日期</li>
</ol>
</li>
<li>协议帧总说明：该协议采用ASCII码。帧格式形如：$aacc,dd,dd,&hellip;,ddd*hh<CR><LF>

<ol>
<li>$表示帧命令起始位</li>
<li>aaccc表示地址域，前两位是标识符，后三位为语句名</li>
<li>ddd&hellip;ddd表示数据</li>
<li>*表示校验和前缀</li>
<li>hh表示校验和，$与*之间所有字符ASCII码的校验和(各字节做异或运算，得到校验和后，再转换16进制格式的ASCII字符)</li>
<li><CR><LF>表示回车和换行</li>
</ol>
</li>
<li>GPGGA：GPS固定数据输出语句

<ol>
<li>格式：$GPGGA,<1>,<2>,<3>,<4>,<5>,<6>,<7>,<8>,<9>,<10>,<11>,<12>,<13>,<14>*<15><CR><LF></li>
<li>例子：$GPGGA,092725.00,4717.11399,N,00833.91590,E,1,8,1.01,499.6,M,48.0,M,,0*5B</li>
<li><1>UTC时间，格式为hhmmss.sss</li>
<li><2>纬度，格式ddmm.mmmm</li>
<li><3>纬度半球，N或者S</li>
<li><4>经度，格式ddmm.mmmm</li>
<li><5>经度半球，E或W</li>
<li><6>定位质量指标，0=定位无效，1=标准定位，2=差分定位，6=估算</li>
<li><7>使用卫星数量，从00到12</li>
<li><8>水平精确度，0.5到99.9</li>
<li><9>天线离海平面的高度，-9999.9到9999.9米</li>
<li><10>高度单位，M表示单位米</li>
<li><11>大地椭球面相对海平面的高度</li>
<li><12>高度单位，M表示单位米</li>
<li><13>差分GPS数据期限（RTCM SC-104），最后设立RTCM传送的秒数量</li>
<li><14>差分参考基站标号，从0000到1023</li>
<li><15>校验和</li>
</ol>
</li>
<li>GPGSA：GPS精度指针及使用卫星

<ol>
<li>格式：$GPGSA,<1>,<2>,<3>,<4>,<5>,<6>,<7>,<8>,<9>,<10>,<11>,<12>,<13>,<14>,<15>,<16>,<17>*<18><CR><LF></li>
<li>例子：$GPGSA,A,3,23,29,07,08,09,18,26,28,,,,,1.94,1.18,1.54*0D</li>
<li><1>模式2：M=手动，A=自动</li>
<li><2>模式1：定位型式1=未定位，2=二维定位，3=三维定位</li>
<li><3>第1信道正在使用的卫星PRN码编号(Pseudo Random Noise，伪随机噪声吗)，01至32</li>
<li><4> 第2信道正在使用的卫星PRN码编号</li>
<li><5> 第3信道正在使用的卫星PRN码编号</li>
<li><6> 第4信道正在使用的卫星PRN码编号</li>
<li><7> 第5信道正在使用的卫星PRN码编号</li>
<li><8> 第6信道正在使用的卫星PRN码编号</li>
<li><9> 第7信道正在使用的卫星PRN码编号</li>
<li><10> 第8信道正在使用的卫星PRN码编号</li>
<li><11> 第9信道正在使用的卫星PRN码编号</li>
<li><12> 第10信道正在使用的卫星PRN码编号</li>
<li><13> 第11信道正在使用的卫星PRN码编号</li>
<li><14> 第12信道正在使用的卫星PRN码编号</li>
<li><15> PDOP综合位置精度因子（0.5 - 99.9）</li>
<li><16> HDOP水平精度因子（0.5 - 99.9）</li>
<li><17> VDOP垂直精度因子（0.5 - 99.9）</li>
<li><18> 校验和</li>
</ol>
</li>
<li>GPGSV：可视卫星状态输出语句

<ol>
<li>格式：：$GPGSV, <1>,<2>,<3>,<4>,<5>,<6>,<7>,&hellip;,<4>,<5>,<6>,<7>*<8><CR><LF></li>
<li>例子：$GPGSV,3,1,10,23,38,230,44,29,71,156,47,07,29,116,41,08,09,081,36*7F</li>
<li><1> 总的GSV语句电文数</li>
<li><2> 当前GSV语句号</li>
<li><3> 可视卫星总数，00至12</li>
<li><4> 卫星编号，01至32</li>
<li><5> 卫星仰角，00至90度</li>
<li><6> 卫星方位角，000至359度。实际值</li>
<li><7> 信噪比（C/No），00至99dB；无表示未接收到讯号</li>
<li><8> 校验和。</li>
<li>每条语句最多包括四颗卫星的信息，每颗卫星的信息有四个数据项，即：卫星编号，卫星仰角，卫星方位角，信噪比</li>
</ol>
</li>
<li>GPRMC：推荐最小数据量的GPS信息

<ol>
<li>格式：$GPRMC,<1>,<2>,<3>,<4>,<5>,<6>,<7>,<8>,<9>,<10>,<11>,<12>*<13><CR><LF></li>
<li>例子：$GPRMC,083559.00,A,4717.11437,N,00833.91522,E,0.004,77.52,091202,,,A*57</li>
<li><1> UTC（Coordinated Universal Time）时间，hhmmss（时分秒）格式</li>
<li><2> 定位状态，A=有效定位，V=无效定位</li>
<li><3> Latitude，纬度ddmm.mmmm（度分）格式（前导位数不足则补0）</li>
<li><4> 纬度半球N（北半球）或S（南半球）</li>
<li><5> Longitude，经度dddmm.mmmm（度分）格式（前导位数不足则补0</li>
<li><6> 经度半球E（东经）或W（西经）</li>
<li><7> 地面速率（000.0~999.9节，Knot，前导位数不足则补0）</li>
<li><8> 地面航向（000.0~359.9度，以真北为参考基准，前导位数不足则补0）</li>
<li><9> UTC日期，ddmmyy（日月年）格式</li>
<li><10> Magnetic Variation，磁偏角（000.0~180.0度，前导位数不足则补0）</li>
<li><11> Declination，磁偏角方向，E（东）或W（西）</li>
<li><12> Mode Indicator，模式指示（仅NMEA0183 3.00版本输出，A=自主定位，D=差分，E=估算，N=数据无效）</li>
<li><13> 校验和。</li>
</ol>
</li>
<li>GPVTG：地面速度信息

<ol>
<li>格式：$GPVTG,<1>,<2>,<3>,<4>,<5>,<6>,<7>,<8>,<9>*<10><CR><LF></li>
<li>例子：$GPVTG,77.52,T,,M,0.004,N,0.008,K,A*06</li>
<li><1> 以真北为参考基准的地面航向</li>
<li><2> T，表示“真”</li>
<li><3> 以磁北为参考基准的地面航向</li>
<li><4> M，表示“磁场”</li>
<li><5> 地面速率</li>
<li><6> N，表示“节”</li>
<li><7> 地面速率</li>
<li><8> K，表示“千米/小时”</li>
<li><9> 模式指示（A=自主定位，D=差分，E=估算，N=数据无效）</li>
<li><10> 校验和</li>
</ol>
</li>
<li>GPGLL：定位地理信息

<ol>
<li>格式：$GPGLL,<1>,<2>,<3>,<4>,<5>,<6>,<7>*<8><CR><LF></li>
<li>例子：$GPGLL,4717.11364,N,00833.91565,E,092321.00,A,A*60</li>
<li><1> 纬度 ddmm.mmmmm（度分）</li>
<li><2> 纬度半球 N（北半球）或 S（南半球）</li>
<li><3> 经度 dddmm.mmmmm（度分）</li>
<li><4> 经度半球 E（东经）或 W（西经）</li>
<li><5> UTC 时间：hhmmss（时分秒）</li>
<li><6> 定位状态，A=有效定位，V=无效定位</li>
<li><7> 模式指示（A=自主定位，D=差分，E=估算，N=数据无效）</li>
<li><8> 校验和</li>
</ol>
</li>
<li>GPZDA：当前时间信息

<ol>
<li>格式：$GPZDA,<1>,<2>,<3>,<4>,<5>,<6>*<7><CR><LF></li>
<li>例子：$GPZDA,082710.00,16,09,2002,00,00*64</li>
<li><1> UTC 时间：hhmmss（时分秒，格林威治时间）</li>
<li><2> 日</li>
<li><3> 月</li>
<li><4> 年</li>
<li><5> 本地区域小时（NEO-6M 不支持，为 00）</li>
<li><6> 本地区域分钟（NEO-6M不支持，为 00）</li>
<li><7> 校验和</li>
</ol>
</li>
</ol>


<h2>NMEA解码库</h2>

<ol>
<li><a href="http://nmea.sourceforge.net/">下载地址</a></li>
<li>支持解析GPGGA，GPGSA，GPGSV，GPRMC，GPVTG这五种语句，解析得到的GPS数据信息以结构体存储，附加地理学相关功能，可支持导航等数据工作，除了解析NMEA语句，它还可以根据随机数产生NMEA语句，方便模拟</li>
<li>结构体：

<ol>
<li>nmeaINFO：保存GPS解码后得到的信息,结构成员介绍

<ol>
<li>smask（int类型）接收到的GPS信息包类型</li>
<li>utc（nmeaTIME结构）包含年、月、日、时、分、秒信息，格林威治时间</li>
<li>sig（int类型）定位质量，0-无效，1-标准定位，2-差分定位</li>
<li>fix（int类型）导航模式，1-无效，2-2D,3-3D</li>
<li>PDOP（double类型）位置精度因子</li>
<li>HDOP（double类型）水平精度因子</li>
<li>VDOP（double类型）垂直精度因子</li>
<li>lat（double类型）纬度</li>
<li>lon（double类型）经度</li>
<li>elv（double类型）海拔，单位m</li>
<li>speed（double类型）速度，单位km/h</li>
<li>direction（double类型）航向，单位：度2</li>
<li>satinfo（nameSATINFO结构）包含了可见卫星，正在使用的卫星，卫星信号等信息</li>
</ol>
</li>
<li>nmeaPARSER：解码时使用的缓冲区数据结构。它是一个链表，在解码时，NMEA库会把输入的GPS原始数据压入到nmeaPARSE结构的链表中</li>
</ol>
</li>
<li>函数：

<ol>
<li>nmea_zero_INFO(&amp;info);初始化解码后的数据</li>
<li>nmea_parse_init(&amp;parser);初始化解析使用的数据结构</li>
<li>nmea_parse(&amp;parser,&amp;buff[0],size,&amp;info);</li>
<li>GMTconvert(&amp;info.utc,&amp;beiJingTime,8,1);</li>
<li>nmea_parser_destory(&amp;parser);释放GPS数据结构</li>
</ol>
</li>
</ol>


<h2>u-center软件</h2>

<ol>
<li>具有配置模块工作方式的功能，方便开发调试</li>
<li>对GPS模块进行性能测试</li>
<li>更新GPS模块固件</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[微纳加工技术]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/11/micro-fabrication/"/>
    <updated>2015-10-11T16:59:33+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/11/micro-fabrication</id>
    <content type="html"><![CDATA[<h2>信息时代</h2>

<ol>
<li>微电子产业是信息时代的基础</li>
<li>基于硅的晶体管是最基本的信息载体</li>
<li>以硅/半导体为基础的微纳加工技术是信息时代的材料技术基础</li>
</ol>


<h2>IC制造高度专业化</h2>

<ul>
<li>设计->制造->测试->封装</li>
</ul>


<h2>芯片制造工艺</h2>

<ul>
<li>芯片制造工艺是指由“硅片”到“集成电路结构晶圆”之间的工艺步骤</li>
</ul>


<h2>二氧化硅在半导体制造中的作用以原因</h2>

<ol>
<li>作用

<ol>
<li>层间隔离</li>
<li>器件隔离</li>
<li>屏蔽层</li>
</ol>
</li>
<li>原因

<ol>
<li>电阻率高，大于10MΩ·cm</li>
<li>击穿场强大，大于10MV/cm</li>
<li>禁带宽度较宽，越9eV</li>
</ol>
</li>
</ol>


<h2>微纳加工技术的使用场合</h2>

<ol>
<li>集成电路领域</li>
<li>MEMS传感器（如用在投影机里面的DLP芯片)</li>
<li>医疗微电子（如使用带摄像头的胶囊来看人体内的情况，通过一个微系统控制药释放的速度）</li>
<li>平板显示行业</li>
<li>太阳能电池行业</li>
</ol>


<h2>微纳加工技术的特点</h2>

<ol>
<li>资本密集。超净间和设备需要大量资金投入</li>
<li>分批工艺。单个晶元上有上亿的晶体管</li>
<li>杰出的可生产性。良率控制在95%以上,可靠性强（寿命要求不小于10年）</li>
<li>随着产品更新换代，成本更加低</li>
<li>技术渗透性强。集成电路，MEMS，太阳能电池，平板显示器，医疗微电子等领域都离不开微纳加工技术</li>
</ol>


<h2>微纳加工技术中选择Si作为常用材料的原因</h2>

<ol>
<li>Si是人类能做的最纯净、没有缺陷、最完美的材料</li>
<li>Si资源丰富，是地壳中第二大丰富的化学元素</li>
<li>Si形成的SiO2界面性好，Si材料提供了可控、稳定且可重复生产的表面SiO2钝化层，从而使现代集成电路技术真正可以实现</li>
<li>在众多半导体中，Si是唯一能够通过氧化形成稳定绝缘层的材料</li>
</ol>


<h2>集成电路发展历程</h2>

<ol>
<li>历史上第一个晶体管(点接触)是1947年在美国贝尔实验室研制出来；1956年获得了诺贝尔奖，发明人是：威廉·肖克利，约翰·巴丁和沃尔特·布拉顿</li>
<li>1949年第一个面结型晶体管诞生</li>
<li>1958年第一个集成电路只有一个晶体管加3个电阻和1个电容,基片用的材质是锗；获得了2000年的诺贝尔奖；器件之间的连线就是简单的用焊接实现的</li>
<li>1959第一个硅基集成电路实现，也只有4个晶体管加2个电阻</li>
<li>1960年平面工艺技术诞生,塑造了现代IC制造的基本特征</li>
<li>1960年MOSFET诞生，从此MOSFET成为成为构建集成电路的主要器件。相对于BJT，MOS具有更高的集成密度，更低的功耗以及更好的电路设计灵活性</li>
</ol>


<h2>平面工艺</h2>

<ol>
<li>定义：在Si半导体上通过氧化、光刻、扩散、离子注入等一系列流程，制作出晶体管和集成电路的工艺；器件和电路都是在芯片表面一层附近处，整个芯片基本上保持是平坦的</li>
<li>特征：批量生产，成本低廉</li>
</ol>


<h2>摩尔定律</h2>

<ol>
<li>当价格不变时，集成电路上晶体管的数目，约每隔18~24个月便会增加一倍，性能也将提升一倍</li>
<li>摩尔定律是一个<strong>经济学定律</strong></li>
<li>在摩尔定律下，新一代产品的的体积缩小30%(实现相同功能的前提下)，晶体管密度增加一倍，开关管开关速度增加0.5倍，功耗降低，成本降低，功能增加</li>
<li>More than Moore&rsquo;s Law(MtM):更加注重系统集成而不是增加晶体管数量</li>
<li>SoC(System on Chip)片上系统;SiP(System in Package)系统级封装</li>
<li>特征尺寸每两年缩小0.7倍，0.7≈1/根号二</li>
</ol>


<h2>微电子工艺综述</h2>

<ol>
<li>微纳加工工艺技术分类：

<ol>
<li>光刻：在硅片上图上光刻胶，然后通过曝光显影的办法把集成电路版图投影到硅片上的光刻胶上</li>
<li>刻蚀:除去裸露部分的硅或者介质材料，从而把光刻胶上的图形转移到硅片上，具体工艺手段分为：

<ol>
<li>湿法腐蚀</li>
<li>干法刻蚀</li>
</ol>
</li>
<li>掺杂：分为离子注入和热扩散</li>
<li>热处理：包括热氧化来制备介质膜，杂质的热扩散，离子注入后的热退火以及硅化物形成过程中的热处理</li>
<li>介质膜的沉积：微电子器件和集成电路中需要大量的各种介质层和隔离结构，制作方法是化学气相沉积(CVD)</li>
<li>化学机械抛光（CMP）：这是一种平坦化的技术，在现代集成电路的布线中，也用它来做图形加工，就是所谓的大马士革工艺</li>
<li>金属化：形成器件的引出电极以及电路的互连线，实现手段主要是：溅射和电镀</li>
</ol>
</li>
<li>加工步骤：
<img src="http://i.imgur.com/Frmykaj.png" alt="加工步骤" />

<ul>
<li>通过氧化，在晶元上长一层很厚的氧化层（场氧化层），这个氧化就是得到二氧化硅材料</li>
<li>旋转涂胶的方法涂上一层光刻胶，光刻胶是一种有机物，起到图形转移的作用</li>
<li>曝光，激光通过掩膜版，将图形照到了光刻胶上</li>
<li>显影，将已经曝光的光刻胶移除</li>
<li>刻蚀，将没有光刻胶保护的二氧化硅的部分移出</li>
<li>将光刻胶移出</li>
<li>再一次进行氧化，生长出高质量的栅极介质氧化层，也是二氧化硅</li>
<li>沉淀一层多晶硅材料</li>
<li>图形化方式将栅极图形转移到删介质层的二氧化硅上面</li>
<li>通过离子注入的方式将掺杂给加入进去</li>
<li>沉积氮化硅</li>
<li>包含了接触口的图形化</li>
</ul>
</li>
<li>在集成电路工艺制备过程中，就是加材料，图形化，减材料的过程不断循环，在每一循环中，后一次的图形需要和前一次的图形对准</li>
</ol>


<h2>超净间简介</h2>

<ol>
<li>为了保证零缺陷需要：避免引入颗粒，避免金属离子；颗粒引起成品率和可靠性问题，金属离子沾污会引起电性能和可靠性问题</li>
<li>超净间的净化级别：典型的IC Fab为光刻10级（每立方英尺中直径超过0.5um的颗粒不大于10个），其它工艺操作区为100级，“灰区”为1000级或者10000级</li>
<li>0.1~0.3um的颗粒最棘手：更大的颗粒容易沉淀，更小的颗粒容易凝结到更大的颗粒中</li>
<li>人员是一个重要的污染源，所以应当尽量采用SMIF(Standard Mechanical interface)和自动传输系统

<ul>
<li>SMIF是一个具有标准接口的盒子，可以与各个工艺设备来对接</li>
</ul>
</li>
<li>人员需要穿戴特制的超净服，经过封磷才能进入超净间</li>
<li>超纯水：IC制造中用的超纯水电阻率必须超过18MΩ·cm，制备过程包括多级数值过滤以及反渗透离子过滤；超纯水的输运需要通过特殊的聚四氟管道进行</li>
<li>标准的硅片的清洗流程叫做RCA清洗

<ol>
<li>浓硫酸+双氧水去除有机物，H2SO4碳化有机物，H2O2使C氧化成CO2</li>
<li>氢氟酸去除二氧化硅</li>
<li>氨水+双氧水去除可能的重金属离子沾污</li>
<li>盐酸去除碱金属离子沾污</li>
<li>超纯水漂洗</li>
</ol>
</li>
<li>超净间净化级别（最新的级别定义规范是Fed.Std.209E）

<ol>
<li>英制： CLASS（X）：单位立方英尺中的空气中，直径超过0.5um的颗粒不超过X个，1英尺=12英寸=30.48厘米</li>
<li>公制： M(X):单位立方米的空气中，直径超过0.5um的颗粒不超过10<sup>M</sup>个</li>
</ol>
</li>
<li>超净间的“无尘”的原因：

<ol>
<li>层层筛选滤除空气中的颗粒物，大颗粒使用超细纤维过滤，小颗粒使用静电吸附</li>
<li>空气流动采用层流的方式</li>
<li>设备使用无尘的材料制造</li>
<li>晶元在迷你工作台之间转移使用SMIF</li>
</ol>
</li>
<li>超净间温度要求：20~22℃，湿度要求：40~46%RH</li>
<li>超净间着装要求：

<ol>
<li>佩戴帽子，护目镜，面罩，手套，超净服和靴子</li>
<li>超净服由合成纤维制作，里面有一层是聚四氟乙烯材料。超净服是导电的，因此不会积累电荷产生静电发电或者吸附颗粒</li>
</ol>
</li>
</ol>


<h2>集成电路工艺用到的材料</h2>

<ol>
<li>单晶材料：结构晶体内部的微粒在三维空间呈有规律地，周期性的排列。整个晶体中质点在空间的排列短程有序，而且长程有序。单晶整个晶格是连续的</li>
<li>多晶材料：多晶是众多取向晶体的单晶的集合，短程有序，长程无序</li>
<li>非晶材料：短程长程均无序</li>
</ol>


<h2>单晶硅的特性及生长方法</h2>

<ol>
<li>熔融的单质硅在凝固时，硅原子以金刚石晶格结构，排列成许多晶核，如果这些晶核长成晶面取向相同的晶粒，则这些晶粒平行结合起来便结晶成单晶硅。单晶硅具有准金属的物理特性，有较弱的导电性，其电导率随温度升高而增加</li>
<li>单晶硅英文：Monocrystallinesilicon/Single Crystal Silicon</li>
<li>制备单晶硅的原材料是高纯度的多晶硅材料</li>
<li>多晶硅原料的制备：

<ol>
<li>从石英砂中提炼冶金级硅（纯度98%）</li>
<li>用冶金级的硅粉提炼电子级的硅（纯度9~11个“9”）</li>
</ol>
</li>
<li>单晶硅的生长：

<ol>
<li>直拉法（CZ）（生长单晶硅的棒材），切克劳斯基发明，

<ul>
<li>在一个直筒型的热系统里面，用石墨电阻加热，将装在高纯度石英坩埚中的多晶硅熔化，然后将籽晶插入熔体表面进行熔接，同时转动籽晶，再反转坩埚，籽晶缓慢向上提升，经过引晶，放大，转肩，等径生长，收尾等过程，一支单晶硅就能生长出来</li>
</ul>
</li>
<li>区熔法（FZ）（生长单晶硅的棒材）</li>
<li>外延法（生长单晶硅薄膜）</li>
</ol>
</li>
<li>在集成电路中主要用的是CZ的抛光片或者是外延片</li>
<li>直拉法生长机理：

<ol>
<li>可生产大直径单晶，是目前IC用Si单晶的主流拉制方法</li>
<li>将电子级多晶硅原料在石英坩埚中加温至Si的熔点以上使其熔化，“拉制”是溶液在籽晶上冷凝并规则排布的过程，采用单晶籽晶作为起始材料，籽晶的晶向决定着所拉出单晶的晶向</li>
<li>核心问题是温度场的控制，拉晶速度决定了单晶棒的直径，而单晶的晶格完整性，掺杂均匀性等也主要由冷凝过程的温度分布决定</li>
<li>直拉法中晶体在熔体表面处生长，而不与坩埚相接触，这样能显著地减小晶体的应力，并防止锅壁的寄生成核</li>
<li>高温下石英晶坩埚中的O、C等杂质会进入Si溶液，如何处理这些杂质也是一个关键问题</li>
</ol>
</li>
<li>单晶硅棒通过切片得到硅片，硅片尺寸一般有4寸，6寸，8寸或者12寸，通过化学机械抛光磨平表面，再在化学溶液中腐蚀，获得表面非常光整的单晶硅片（厚度约0.5mm，直径约300mm）</li>
<li>几种常见的半导体化学性质比较

<ol>
<li>禁带宽度：GaAs(砷化镓)>Si>Ge,因此Si的PN结反向电流比Ge小</li>
<li>禁带类型，Si和Ge都是间接带隙，GaAs是直接带隙，因此光电器件采用GaAs</li>
<li>电子迁移率：Si&lt;Ge&lt;GaAs,因此Si不适于在高频下工作，高频高速以及微波器件多采用GaAs</li>
</ol>
</li>
</ol>


<h2>集成电路和其它微结构器件中需要多种多样的薄膜</h2>

<ol>
<li>介质膜：高质量的超薄氧化层薄膜，绝缘性能好，包括MOS器件的栅氧化薄膜

<ol>
<li>超薄，1~3nm；很低的界面态；很好的绝缘性，约9eV bandgap，击穿场强需要7~15MV/cm；能够阻止硼（B）穿过</li>
<li>包括高质量超薄介质层和低热预算介质薄膜</li>
<li>制备技术：

<ol>
<li>热氧化和ALD(Atomic Layer Deposition，原子级沉积)技术</li>
<li>CVD(Chemical Vapor Deposition)技术：在器件形成或者金属互联之后淀积介质膜，要求低的热预算（thermal budget，温度与时间的乘积），使得在淀积薄膜的工艺下，不对已经形成的器件的杂质分布或者已经形成的金属互联网络产生不好的影响</li>
</ol>
</li>
<li>氧化的速率受温度和氧化时间的影响很大。当氧气浓度很丰富时，二氧化硅的生长速度由硅键断裂速度决定，而此过程大部分取决于温度的高低。为了得到致密的氧化层，必须使反应炉内的温度保持恒定</li>
<li>二氧化硅在整个工艺流程中多次用来作为硅衬底保护层和连个电极之间的隔离层</li>
<li>氮化硅非常致密并且比其他材料更能抵抗杂质扩散</li>
</ol>
</li>
<li>金属膜

<ol>
<li>布线层数和总长度：10层布线，最细线宽在45nm左右，而布线总长度可达到5公里量级</li>
<li>包括用于金属半导体接触的和用于金属互联网络的</li>
<li>制备技术：

<ol>
<li>溅射，蒸发，电镀</li>
</ol>
</li>
</ol>
</li>
<li>单晶态的半导体薄膜

<ol>
<li>制备技术：外延</li>
</ol>
</li>
<li>为了满足不同的应用场景的要求，对薄膜的要求也是不同的，制备技术的选择和优化要针对应用的需求：应力，附着性，化学稳定性，化学腐蚀的选择性和可加工性，保角性(conformation)

<ol>
<li>保角性：在图形的面上，沉积的速度大致相同</li>
</ol>
</li>
<li>二氧化硅的应用

<ol>
<li>在MOSFET中

<ol>
<li>栅极氧化</li>
<li>绝缘层</li>
<li>钝化层</li>
</ol>
</li>
<li>在IC中

<ol>
<li>器件隔离</li>
<li>层间介质</li>
<li>掩蔽层</li>
</ol>
</li>
</ol>
</li>
<li>IC中使用的SiO2是非晶体，即短程无序，长程也无序。晶体二氧化硅的密度2.65g/cm3,非晶体二氧化硅的密度2.2g/cm3</li>
</ol>


<h2>CVD技术</h2>

<ol>
<li>过程：气态反应物在沉底反应生成固态的薄膜，例如siH4(g)+O2(g)->SiO2(g)+2H2(g)[400℃],3SiH4(g)+4NH3(g)->Si3N4(s)+12H2(g)[750℃],其中SiH4称为硅烷,SiH4(g)->Si(s)+2H2(650℃),WF6(g)+3H2(g)->W(s)+6HF(g)</li>
<li>工艺步骤：

<ol>
<li>反应物运输到淀积区域</li>
<li>反应物从主气流穿过边界层运输到晶片表面</li>
<li>反应物吸附在晶片表面</li>
<li>表面作用，包括化学分解或反应，在表面迁移向吸附位置</li>
<li>副产物的吸解</li>
<li>副产物穿过边界层回到主气流中</li>
<li>副产物离开淀积区域排走</li>
</ol>
</li>
<li>CVD技术分类及设备简介

<ol>
<li>常压化学气相沉积（APCVD），激励源：温度；特点：产能(throughput)大,但是台阶覆盖性不好</li>
<li>低压化学气相沉积（LPCVD），激励源：温度；特点：气体稀薄，自由程大，硅片可以紧密排列，可以批量加工，并且保角性比较好，但是工艺温度比较高，石英管壁上的沉积物成为后续工艺中的颗粒；

<ol>
<li>栅极氧化使用的是LPCVD技术，温度在560~650之间</li>
</ol>
</li>
<li>等离子体增强化学气相沉积（PECVD），激励源：等离子体，温度；特点：沉积温度低，但是沉积物的致密性较差，工艺可控性差，台阶覆盖性较差</li>
</ol>
</li>
<li>几种最常见的CVD实例

<ol>
<li>W plug（钨塞），用于集成电路互联线层间连通金属，需要优化CVD工艺，提高保角性</li>
</ol>
</li>
<li>ClusterTools设备使得硅片在不同的反应腔中传输时不出真空环境，大大减少了环境影响因素，提高了工艺成品率</li>
<li>对下层非平面形貌的覆盖，包括台阶覆盖和孔的填充问题，通过控制反应气体理化特性和各种工艺条件，达到：

<ol>
<li>适当的粘附系数</li>
<li>主要由反应控制决定薄膜生长有利于台阶覆盖</li>
</ol>
</li>
</ol>


<h2>ALD(Atomic layer deposition)原子层沉积</h2>

<ol>
<li>原子层沉积是一种可以将物质以单原子膜形式一层一层的镀在基底表面的方法</li>
<li>通常用来制作MOS器件的栅氧化层(又薄质量又高的氧化层)</li>
<li>不是靠衬底（Si）氧化，而是靠化学气相沉积，可用于制备非SiO2系列的high-k(高介电常数)介质</li>
</ol>


<h2>热氧化过程</h2>

<ol>
<li>氧化气氛

<ol>
<li>干氧：O2;干氧能够提供更好的氧化质量和Si/SiO2界面，良好的界面性使得Si超越别的半导体材料，成为半导体工艺中最受欢迎的一种</li>
<li>湿氧：O2和H2O；需要注意，水汽在二氧化硅中的扩散速度远远大于氧气在二氧化硅中的扩散速度，可以形成厚的氧化层</li>
<li>其他添加元素：H（H2），Cl（TCA或者TCE），N（NH3或者N2O）。其中含氯氧化目的在于去除金属离子</li>
<li>实际生产中会采用dry-wet-dry-anneal的组合形式来进行氧化。anneal即退火，可以促进原子重排，将未反应的Si离子氧化，并减少界面缺陷</li>
</ol>
</li>
<li><img src="http://i.imgur.com/oqKEncN.png" alt="热氧化过程" /></li>
<li>Deal-Grove模型
<img src="http://i.imgur.com/KaExFIC.png" alt="Deal-Grove" /></li>
<li>氧化工艺中应注意的其他问题：

<ol>
<li>Na、K等碱金属离子在SiO2中是块扩散杂质，将在SiO2中起移动电荷作用，引起MOS器件阈值电压漂移。因此要严格栅氧化前的硅片清洗和氧化环节的污染控制。氧化气氛中通少量HCl气氛也是控制金属离子沾污的一个办法</li>
<li>Si/SiO2界面的缺陷将成为MOS器件栅下的界面态，也会引起MOS器件阈值电压漂移。需要优化氧化前的硅片表面处理，优化氧化工艺，尽量减少Si/SiO2界面缺陷</li>
<li>后续的家文过程中可能会引起多晶硅删中的B参杂穿透SiO2层进入沟道（B在SiO2中是快扩散杂质），从而改变沟道内的杂质分布；应对办法：提高SiO2的致密性，如采用氧化时加少量NO，形成更致密的SiON；采用尽可能厚的栅介质；不采用参杂的多晶硅栅</li>
</ol>
</li>
<li>氧化层质量的影响因素：

<ol>
<li>衬底洁净度</li>
<li>气体的纯净度</li>
<li>氧化过程</li>
</ol>
</li>
<li>反应扩散模型，可以有效解释氧化膜厚度大于20nm的时候，超薄氧化层不适用此模型，如栅氧
<img src="http://i.imgur.com/FAQ8O9b.png" alt="基础公式" />
<img src="http://i.imgur.com/uMbHfM7.png" alt="反应扩散模型" />

<ol>
<li>氧化层很薄的时候，氧化速率由反应速率控制；氧化层很厚的时候，氧化速率由扩散速率控制</li>
<li>k是反应速率常数，D是扩散系数，C0是氧化剂在SiO2中的固溶度，N是单位体积二氧化硅中氧分子数，x0表示t=0时刻氧化膜厚度。其中k，D和C0均与温度有关，C0还与压强有关，可以增大压强提高C0</li>
</ol>
</li>
<li>影响氧化反应速率的因素：

<ol>
<li>温度</li>
<li>压强</li>
<li>重掺杂削弱Si-Si键，提高了反应速率</li>
<li>含氯氧化，cl能与绝大多数金属反应，生成的氯化物易挥发，提高了反应质量。反应副产品H2O的加入加快了反应速率</li>
<li>不同的晶向反应速率不同，原因在于晶面之间的距离不同，111面最快，100面最慢</li>
</ol>
</li>
</ol>


<h2>干氧湿氧法的特点及原因</h2>

<ol>
<li>干氧：氧化层质量高，Si/SiO2界面特性更好，但是反应速率较慢</li>
<li>湿氧：氧化层较稀疏，通常适合生长较厚的氧化层，反应速率较快</li>
<li>原因：水分子比氧分子小，更容易在SiO2中扩散，水分子在SiO2中的溶解度大于氧分子</li>
</ol>


<h2>RTO（Rapid Thermal Oxidation）</h2>

<ol>
<li>超薄氧化膜（如栅极氧化膜）在低温或者低压下很难操控 ，不易生长</li>
<li>RTO技术能够生长1.8nm的氧化膜，氧化硅片的使用高功率的碘钨灯加热硅片以降低Thermal Budget，反应温度在1000℃左右，反应时间是毫秒级，更高的反应温度能够生长高质量的薄膜。RTO工艺只能单片操作，但是每一片消耗的时间很短。RTO技术的缺点在于，温度均匀性很难保证</li>
</ol>


<h2>Si/SiO2表面的杂质分离</h2>

<p><img src="http://i.imgur.com/xYRtMeX.png" alt="分离系数" /></p>

<ol>
<li>参杂的硅片在氧化和退火过程中，杂质会重分布，因为杂质在Si和SiO2中的平衡浓度不同</li>
<li>氧化过程中，新生长的SiO2会吸引受体，如硼（B），并且排斥施主，如磷（P）和砷（As）</li>
<li>杂质在SiO2中没有电学活性</li>
</ol>


<h2>热氧化前的清洗</h2>

<ol>
<li>SC1标准清洗，去除有机物和金属，使用氨水，80摄氏度</li>
<li>SC2标准清洗，去除离子，使用盐酸，80摄氏度</li>
<li>自然氧化层去除，使用HF，室温，几十秒时间就完成</li>
<li>评估清洗干净的标准是检测清洗后的水的电阻率是否超过18MΩ·cm</li>
</ol>


<h2>Si/SiO2氧化层电荷</h2>

<ol>
<li>评价界面的好坏

<ol>
<li>氧化层中的电荷越少越好</li>
<li>界面缺陷越少越好，即界面上Si的断键（悬挂键）越少越好</li>
</ol>
</li>
<li>可移动离子

<ol>
<li>阳离子Na会在氧化层中移动</li>
<li>氧化前的清洗非常重要，可以减少离子污染</li>
</ol>
</li>
<li>固定氧化电荷

<ol>
<li>在Si片表面的传输去区域由于最后停止O的输送导致Si与O没有形成完全的Si-O键（未完成的氧化反应）</li>
<li>可以通过后续的退火进行原子重排来减少，但是无法避免，因为与工艺相关</li>
</ol>
</li>
<li>氧化层内部残留电荷

<ol>
<li>由非桥氧所致，可正可负</li>
</ol>
</li>
<li>表面残留电荷

<ol>
<li>Si/SiO2表面原子级突变，形成缺陷</li>
<li>晶格不对齐导致的悬挂键</li>
<li>可以通入H2与Si形成Si-H键来降低缺陷态，但是不如Si-O稳定，在高压大电流，有应力的情况下，Si-H键容易断裂，影响器件特性</li>
</ol>
</li>
</ol>


<h2>LOCOS &amp; STI</h2>

<ol>
<li>LOCOS（Local Oxidation of Silicon，局部氧化隔离）是硅的选择性氧化，SiN作为扩散掩膜层，绝大多数分子很难扩散穿过SiN。先在有源区覆盖一层SiN，接着在暴露的隔离区通过湿氧氧化生长一层较厚的氧化层，最后去除SiN层，形成有源区，在有源区中制作器件。</li>
<li>SiN可以防止O2或者H2O扩散至底层与Si发生氧化反应，但是SiN无法防止气体从侧面扩散，导致横向氧化，因此会形成鸟嘴（bird&rsquo;s beak），鸟嘴处应力较大，易形成缺陷</li>
<li>STI即浅沟槽隔离，先淀积氧化硅，然后在隔离区腐蚀出一定深度的沟槽，再进行侧墙氧化，用CVD的方法在沟槽中淀积SiO2，最后通过CMP法平坦化，形成沟槽隔离区和有源区。与LOCOS相比较，更有效地隔离了器件，表面非常平坦，有利于下一代工艺的加工。但是STI工艺贵且复杂
<img src="http://i.imgur.com/kTy6eoo.png" alt="LOCOS" /></li>
</ol>


<h2>氧化膜厚度测量</h2>

<ol>
<li>椭偏仪，可以同时测量厚度与折射率，精度达到1nm，原理是光的偏振，可以测量介质膜</li>
<li>台阶仪，可以测量多种膜，但是需要 先刻蚀出一个台阶</li>
</ol>


<h2>外延</h2>

<ol>
<li>一种特殊的CVD过程三种外延过程，淀积产物呈单晶状态
<img src="http://i.imgur.com/Ce3SGrT.png" alt="外延技术" /></li>
<li>为了形成单晶，外延与普通CVD有两点主要不同：

<ol>
<li>衬底界面处理更加苛刻，需要利用衬底的晶格来引导薄膜的单晶生长</li>
<li>生长温度比普通CVD高很多</li>
</ol>
</li>
<li>典型应用：

<ol>
<li>功率器件：功率器件中耐压较高的器件需要在高阻的半导体上制备，同时为了使整体串联电阻很小，衬底需要低阻。整个wafer的上面是低参杂，下面高参杂，而且低参杂的厚度很厚，达到几十微米</li>
<li>改变硅的晶格常数，制备高迁移率应变沟道</li>
</ol>
</li>
</ol>


<h2>溅射、蒸发和电镀（制备金属薄膜）</h2>

<ol>
<li>集成电路对金属化的主要要求：

<ol>
<li>金属与半导体接触

<ol>
<li>肖特基接触</li>
<li>欧姆接触

<ol>
<li>高参杂后利用遂穿机制形成欧姆接触</li>
<li>硅化物的使用。在金属与半导体接触时，通常使用硅化物来作为接触层，避免金属和硅化物的共融体。主要采用钛硅化物，钴硅化物，镍硅化物</li>
</ol>
</li>
</ol>
</li>
<li>金属作为互连线。Al是目前集成电路工艺中最常用的金属链接材料，电阻率较低，工艺简单，易形成欧姆接触。但是铝容易形成电迁徙（高电流密度引发的电子风造成电迁徙），而且铝的RC延迟比较大。目前金属互联正从铝互联转向铜互联。但是铜的刻蚀比较困难，需要采用大马士革工艺。此外，为了简化工艺，在一些短距离的“局部互连”常使用多晶硅和硅化物。

<ol>
<li>有良好的导电性</li>
<li>容易与N型、P型硅形成低阻欧姆接触</li>
<li>与硅和二氧化硅等有良好的粘附性</li>
<li>易于淀积和刻蚀，便于键合</li>
<li>性能稳定可靠</li>
<li>互连线对台阶的覆盖性要好</li>
</ol>
</li>
</ol>
</li>
<li>蒸发：不易制备合金的膜</li>
<li>溅射（PVD）：可以制备合金膜，粘附性好，但是台阶覆盖性不太好
<img src="http://i.imgur.com/yaveWue.png" alt="溅射" /></li>
<li>电镀：台阶覆盖性最好</li>
<li>典型的经书画应用场合总结
<img src="http://i.imgur.com/Car7nUY.png" alt="金属化" /></li>
</ol>


<h2>光刻工艺综述</h2>

<ol>
<li>光刻常用在：有源区的图形化，栅极的图形化，接触孔的图形化，金属图形化</li>
<li>光刻过程的信息流：设计人员CAD设计->版图转移到掩膜版上MASK->通过光刻工艺在光刻胶表面的空中形成aerial image->转移到光刻胶表面real image->在1um的光刻胶里面形成Latent image->显影后形成Resist image->在器件上形成Device Layer；Each step can lose information, distoring device pattern</li>
<li>典型的图形化转移步骤：

<ol>
<li>旋转涂胶</li>
<li>曝光</li>
<li>显影</li>
<li>湿法刻蚀</li>
<li>去除光刻胶</li>
</ol>
</li>
</ol>


<h2>光刻工艺详解</h2>

<ol>
<li>MOS制备工艺中栅极的光刻步骤
<img src="http://i.imgur.com/fkNnt3m.png" alt="光刻步骤" /><img src="http://i.imgur.com/2hOh06Q.png" alt="光刻步骤" />

<ol>
<li>硅片清洗：将表面的颗粒和污染物去除，增强光刻胶和硅表面的附着力

<ol>
<li>化学清洗</li>
<li>去离子水漂净</li>
<li>甩干</li>
</ol>
</li>
<li>预烘及涂底胶

<ol>
<li>预烘在100℃左右，目的是去除硅片表面的水汽</li>
<li>涂底胶一般涂一层非常薄的HMDS，能够很好地促进光刻胶和硅片表面的结合</li>
</ol>
</li>
<li>涂光刻胶

<ol>
<li>光刻胶旋图的厚度影响因素：

<ol>
<li>光刻胶的种类</li>
<li>光刻胶的粘度</li>
<li>真空吸盘的转速</li>
</ol>
</li>
<li>光刻胶喷嘴在喷完光刻胶之后需要suck back（回吸）的动作，目的是避免悬在喷嘴口上的光刻胶掉落在硅片上</li>
<li>光刻胶旋涂后不仅覆盖硅片的正表面，还会覆盖边缘和背面一部分。边缘和背面的部分光刻胶称作Edge bead，需要去除（Edge bead removal，EBR），方法有化学EBR，曝光EBR</li>
</ol>
</li>
<li>软烤：将光刻胶里面80%的溶剂蒸发掉，提高光刻胶和硅片的粘附性

<ol>
<li>温度90℃~100℃</li>
<li>具体温度和软烤时间需要具体设置</li>
<li>方法：

<ol>
<li>烘箱退火</li>
<li>电炉烘烤</li>
</ol>
</li>
<li>过渡烘烤会降低光刻胶的光敏度</li>
</ol>
</li>
<li>对准：

<ol>
<li>这一步工艺决定了整个微纳加工的最小线宽</li>
<li>分类：接触式，接近式，投影式</li>
</ol>
</li>
<li>曝光

<ol>
<li>分为接触式，接近式和投影式</li>
</ol>
</li>
<li>后烤：停止光化学反应，让光刻胶的侧面光滑，提高精度，均匀驻波对光刻胶侧面带来的形貌的影响

<ol>
<li>温度高于软烤的温度，100℃，烘烤10分钟</li>
</ol>
</li>
<li>显影，硬烘和检测

<ol>
<li>在碱性溶液中显影，沉浸式或者喷雾，可以利用超声波来搅拌，让反应均匀</li>
<li>硬烤目的是将光刻胶中所有的溶剂都蒸发，光刻胶完成聚合化和剥离化，提供光刻胶抵抗刻蚀和注入的能力。同时在硬烤过程中，光刻胶内部的流动将内部的针孔给填满了</li>
</ol>
</li>
</ol>
</li>
<li>光刻机的原理：光的衍射

<ol>
<li>光刻机就是讲掩膜版上的图形与前次工序中已刻在硅片上的图形对准后，再将硅片表面的光刻胶进行曝光实现图形复制的设备</li>
<li>三个主要性能指标：

<ol>
<li>分辨率

<ul>
<li>是可以曝光出来的最小特征尺寸</li>
</ul>
</li>
<li>对准和套刻精度

<ul>
<li>是描述光刻机加工图形重复性能的一个指标，是层间套刻精度的度量，主要取决于掩膜版和硅片的支撑平台图形对准和移动控制精度性能</li>
</ul>
</li>
<li>产率

<ul>
<li>每个小时可加工的硅片的数目</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li>接触式光刻：掩膜版直接与光刻胶接触

<ol>
<li>优点：结构简单，成本低，光的衍射效应小，曝光出来的图形与掩膜版上的图形分辨率相当，设备简单</li>
<li>缺点：光刻胶污染掩膜版，产能低</li>
</ol>
</li>
<li>接近式光刻：掩膜版和光刻胶略微分开，越2~20μm

<ol>
<li>优点：可以避免与光刻胶的直接接触而引起的掩膜版损伤</li>
<li>缺点：引入了衍射效应，降低了分辨率</li>
</ol>
</li>
<li>投影式曝光：在掩膜版和光刻胶之间使用透镜聚集光实现曝光。一般掩膜版的尺寸会以需要转移图形的4倍制作

<ol>
<li>优点：提高了分辨率；掩膜版的制作更加容易；掩膜版上的缺陷影响减小</li>
<li>缺点：成本非常高，维护成本也很高</li>
<li>分类：

<ol>
<li>扫描投影曝光（Scanning Project Printing）

<ul>
<li>掩膜版1：1，全尺寸</li>
</ul>
</li>
<li>步进重复投影曝光

<ul>
<li>掩膜版缩小比例（4：1），曝光区域22X22mm</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li>掩膜版由石英作为基座，表面有一层50~500nm的铬层或者乳胶层，这层是带图形的

<ol>
<li>掩膜图形的制作方法有：镭射光刻写（不精确），电子束刻写（精确），两种方式都比较慢，需要几个小时</li>
</ol>
</li>
<li>光刻胶：光刻胶对光线敏感，所以需要在黄光下进行操作。光刻胶=基材+感光材料+溶剂

<ol>
<li>正性光刻胶：曝光区域更容易在显影液中溶解（光照破坏了聚合物链式结构）</li>
<li>负性光刻胶：曝光区域更不容易在显影液中溶解（光照促使产生了链式结构）</li>
<li>对光刻胶的要求：

<ol>
<li>旋涂方便</li>
<li>曝光性好</li>
<li>尺寸稳定</li>
<li>抗刻蚀</li>
</ol>
</li>
<li>光刻胶的清洗

<ol>
<li>浓硫酸+双氧水去除金属</li>
<li>使用有机溶剂清洗，但是很难去除硬化的光刻胶</li>
<li>氧的等离子体，将光刻胶燃烧</li>
</ol>
</li>
</ol>
</li>
<li>光线通过掩膜版后进入光刻胶，在硅片表面反射，与入射的光波产生干涉，形成驻波（standing wave），驻波的强光区域在显影时候溶解更多，驻波的弱光区域在显影的时候溶解更少，从而导致形成波浪状的侧面图形。避免形成驻波的方法：

<ol>
<li>在光刻胶里面加入吸收性更强的成分，削弱反射光</li>
<li>使用多层光刻胶</li>
<li>在硅片表面涂上一层防止反射的图层（bottom anti-reflection coating，BARC）。光刻胶不平整，底层反射会使被掩膜保护的光刻胶也得到了曝光，此时必须使用BARC材料。图形化工艺之前必须要平坦化工艺</li>
<li>PEB（后烤）均匀驻波对光刻胶侧面带来的形貌的影响</li>
</ol>
</li>
<li>多层对准（Overlay）产生的误差

<ol>
<li>掩膜版和硅片的热膨胀系数不同导致硅片上的图形与掩膜版上面的图形有误差，称为：Thermal run-in/run-out error</li>
<li>往同一个方向偏移（translation error）</li>
<li>旋转偏移（Rotational Error）</li>
<li>最大允许误差不能超过特征尺寸的1/3</li>
</ol>
</li>
<li>采用OPC（optical proximity correction）的方法对由于光学衍射和干涉带来的图形畸变</li>
<li>提高光刻分辨率的若干技术

<ol>
<li>更短波长的光源

<ol>
<li>汞灯G线波长436nm，H线405nm，I线365nm；KrF准分子激光波长248nm；ArF准分子激光波长193nm。进一步缩小波长，一方面受到没有足够功率和稳定性激光器的限制，另一方面也受到光线大气吸收的限制</li>
</ol>
</li>
<li>浸润式光刻技术

<ol>
<li>在光刻胶和投影镜头之间填充介电常数n大于1的物质，如水，等效波长就会减小为原来的1/n</li>
</ol>
</li>
<li>移相掩膜技术（光强不变，相位翻转，相长干涉变成相消干涉），移相子通常由透明的薄膜如SiO2来担任</li>
<li>DFM（Design For Manufacture）技术</li>
<li>EUV（Extreme Ultraviolet Lithography，极紫外光刻）使用波长非常小的紫外光来进行光刻，是一套光反射系统，波长11.2nm。目前EUV的瓶颈是光强</li>
<li>偏轴入射光，可以提高NA，原因是增加了高阶衍射的入射量（高阶衍射光中携带了精细图形的信息）</li>
</ol>
</li>
<li>光刻的非理想因素

<ol>
<li>光刻胶有厚度，上表面的光刻胶接收的光照比下表面强，显影过后，光刻胶的横截面呈现梯形。解决办法有：使用高对比度的光刻胶</li>
<li>光刻胶便面不平整，导致部分图形失焦，解决方案：平坦化工艺</li>
</ol>
</li>
</ol>


<h2>平坦化工艺对光刻的重要意义</h2>

<ol>
<li>随着光刻工艺分辨率的提高，DOF（焦深）在下降，对焦过程中很容易失焦，平坦化工艺可以避免</li>
<li>在不平坦的表面，由于光刻胶厚度不均匀，导致曝光不均匀</li>
<li>不平坦的表面会导致光的散射，使得曝光过程不受控制</li>
</ol>


<h2>分辨率与焦深</h2>

<ol>
<li>最小特征尺寸：W=k1λ/NA（瑞利判据）。k1是工艺决定的参数，约0.6~0.8，λ为波长，NA为光学系统的数值孔径NA=n0*sinα，n0为中间介质的折射率，NA代表光学系统收集光的能力。</li>
<li>焦深（景深）DOF=k2λ/(NA)<sup>2</sup>,k2也是工艺决定的参数。焦深越大，最小特征尺寸也越大，利用平坦化工艺可以解决焦深的问题</li>
</ol>


<h2>图形转移</h2>

<ol>
<li>图形转移就是利用光刻胶作为掩蔽，通过物理和化学的办法把下面的衬底或薄膜材料中没有被掩蔽的部分腐蚀掉。腐蚀的方式有：湿法腐蚀和干法刻蚀</li>
<li>湿法腐蚀：利用化学试剂进行腐蚀

<ol>
<li>通常是各向同性的，垂直和侧面刻蚀速率比约为1.2：1。但是KOH对Si的腐蚀与晶向有关，100面的腐蚀速率是111的一百倍</li>
<li>需要控制腐蚀液的浓度和腐蚀温度</li>
<li>不适合在更小尺度下进行刻蚀</li>
<li>只用于wafer的清洗和光刻胶的去除</li>
<li>温度敏感，工艺不好受控</li>
<li>均匀性不好，反应物在硅片表面运输受限</li>
<li>有时候与晶向相关</li>
</ol>
</li>
<li>干法刻蚀：在腐蚀气体的气氛下完成腐蚀。为了增强腐蚀气体的化学活性，通常需要将腐蚀气体激发成等离子体

<ol>
<li>为了形成等离子体，反应在低压下进行</li>
<li>反应生成物应该是易挥发性的</li>
<li>离子轰击：

<ul>
<li>电容极板的等离子状态下，等离子体与衬底表面会产生一个鞘层，鞘层产生的自电电势会加速这个离子轰击到衬底表面，离子轰击能量达到10~700eV。离子轰击增强腐蚀效果，腐蚀速率提高几到几十倍</li>
<li>所以Wafer放在阴极，离子轰击的效果更明显</li>
<li>离子轰击将被刻蚀材料表面的原子键破坏</li>
<li>将再沉淀于被刻蚀表面的产物或聚合物打掉，使被刻蚀表面能再与刻蚀气体接触</li>
<li>化学反应生成的聚合物淀积在侧壁，起到保护侧壁的作用，是的整个反应向下进行比较快</li>
</ul>
</li>
<li>增强等离子体离化的手段

<ol>
<li>用电感耦合产生高密度的等离子体。可单独调节轰击电压和等离子体密度</li>
<li>电子回旋共振</li>
<li>磁性增强RIE</li>
</ol>
</li>
<li>各向异性（Anisotropy）A=1-Vh/Vv,Vh表示水平刻蚀速度，Vv表示垂直刻蚀速度</li>
<li>选择性（Selectivity）Sab=Ea/Eb，Ea表示材料a的刻蚀速率，Eb表示材料b的刻蚀速率</li>
<li>影响干法刻蚀的因素：

<ol>
<li>压强</li>
<li>气体流量</li>
<li>射频功率</li>
<li>温度</li>
<li>腔体几何形状</li>
</ol>
</li>
</ol>
</li>
<li>各向同性刻蚀：以光刻胶的暴露的表面为起点，向下和向两侧的腐蚀速度相同</li>
<li>完全各向异性刻蚀：以光刻胶的暴露的表面为起点，腐蚀的放下仅仅向下进行，不向两侧扩展</li>
<li>部分各向异性刻蚀：腐蚀的过程向下推进，同时也向两侧扩展，但是速率不一样</li>
<li>刻蚀Si和SiO2

<ol>
<li>材料：CF4+O2，氧气是用来去除反应生成的聚合物</li>
<li>当氧气表较少的时候，随着氧气浓度的增加，刻蚀速率会增加；当氧气浓度高到一定程度，氧气浓度再上升，会导致刻蚀速率的下降</li>
<li>H2的存在会导致刻蚀速率下降，而且刻蚀Si的速度下降更快</li>
<li>通过通入O2和H2来调节刻蚀速度和选择比</li>
</ol>
</li>
<li>干法刻蚀的物理化学过程

<ol>
<li>化学腐蚀（中兴活性反应物参与）</li>
<li>等离子增强的化学腐蚀</li>
<li>离子轰击增强刻蚀</li>
<li>生成物的侧壁沉积</li>
</ol>
</li>
<li>刻蚀过程中需要over-etch，确保刻蚀的完全性，同时也需要很高的选择比，如果选择比达不到要求，又需要over-etch，这时候需要加一层etch-stop层。

<ol>
<li>刻蚀Si上面的氮氧化物，需要先在Si上加一层SiO2充当etch stop layer</li>
<li>如果etch-stop layer很薄，在工艺的最后阶段可以通过降低功率的方式来提高选择比</li>
</ol>
</li>
<li>湿法刻蚀机制：

<ol>
<li>固体与流体之间存在边界层，厚度在微米量级</li>
<li>反应物通过扩散穿过边界层到达wafer表面</li>
<li>热激发化学反应</li>
<li>反应物通过扩散穿过边界层离开</li>
</ol>
</li>
<li>湿法刻蚀SiO2

<ol>
<li>SiO2+6HF->2H2SiF6+2H2O</li>
<li>HF对Si，SiNx和光刻胶的选择比很高</li>
<li>反应生成的H2O降低了反应液的酸度，反应速率随之下降</li>
<li>通过加入NH4F可以保持溶液中HF浓度的稳定，因为NH4F+H2O->NH4OH+HF</li>
</ol>
</li>
<li>Si的氮化物湿法刻蚀

<ol>
<li>使用热磷酸H3PO4，温度150~160℃</li>
<li>对Si和氧化物有着高的选择比，但是对光刻胶和金属的选择比很低</li>
<li>所以需要加一层硬掩膜来提高对光刻胶的选择比，解决光刻胶不耐酸的问题。（选择比在下面很低用etch-stop layer，在光刻胶部分很低用Hard Mask）</li>
</ol>
</li>
<li>Si/Poly-Si的湿法刻蚀

<ol>
<li>各向同性：Si+HNO3+HF->H2SiF6+HNO2+H2+2H2O</li>
<li>KOH定向刻蚀Si的100面，保留111面不被刻蚀，得到原子级别的光滑面，倒金字塔形状</li>
</ol>
</li>
<li>Al的湿法刻蚀

<ol>
<li>氧化掉Al，然后用H3PO4刻蚀Al2O3，反应过程中会产生H2带来气泡，需要超声波辅助</li>
</ol>
</li>
<li>干法刻蚀的分类：

<ol>
<li>溅射：离子轰击靶表面，转移动量，表面几层原子的化学键断裂。溅射的各向异性好，选择性差</li>
<li>RIE（Reactive ion etch）：同时存在物理作用和化学反应，需要在各向异性和选择性之间权衡</li>
<li>化学干法刻蚀：各向异性差，更好的选择性
<img src="http://i.imgur.com/HWG5MZv.png" alt="不同材料的刻蚀" /></li>
</ol>
</li>
</ol>


<h2>等离子体</h2>

<ol>
<li>自然状态下，气体中会有一小部分分子由于热激发而离化，离化后的离子在内部复合地非常快。</li>
<li>等离子体就是被激发的电离气体，可看作是高度离化的气体，相比分子总数量，它包含了很少的离化分子。这些例子处于热激发态，并快速重组。整体表现为近似电中性的电离气体</li>
<li>常见的等离子体：太阳，闪电，汞灯H线，I线就是水银的等离子体从激发态转到基态而发出的光</li>
<li>等离子体内部组成：电子+离子+分子+自由基+激发态（快要离化的分子）

<ol>
<li>活化基（Radicals）：中性分子失去外围电子形成的非常有活性的化学物质，参与各向同性的化学反应，形成易挥发的物质</li>
<li>激发态物质：化学活性也很高</li>
<li>正电离子和自由电子：由被电离的物质形成，在电场作用下加速，能量高，各向异性好，参与刻蚀的物理作用：离子轰击，物理溅射</li>
</ol>
</li>
<li>举例：CF4

<ol>
<li>激发态：CF4*</li>
<li>自由基：CF3-，CF2&ndash;，F-</li>
<li>离子态：CF3+</li>
</ol>
</li>
</ol>


<h2>Plasma Etch与RIE</h2>

<ol>
<li>Plasma etch：Wafer 放在阳极（或者接地电极）一侧，属于各向同性刻蚀；避免了离子轰击，刻蚀主要依靠化学反应</li>
<li>RIE：Wafer放在阴极（或者功率电极）一侧，各向异性较好

<ol>
<li>离子朝着Wafer加速，促进了更多的各向异性刻蚀</li>
<li>同时存在化学反应和物理作用</li>
<li>离子轰击增强了化学作用，并且是各向异性的</li>
<li>实质上，垂直的物理刻蚀是微不足道的，因为离子的动量不大（气压高意味着自由程短，加速距离短）</li>
</ol>
</li>
</ol>


<h2>PID（Plasma Induced Damage）</h2>

<ul>
<li>表面损伤，缺陷和玷污</li>
<li>天线效应（金属、多晶硅刻蚀）。悬浮导体收集电荷，损伤下面的介质层</li>
</ul>


<h2>离子轰击可能的机制</h2>

<ol>
<li>离子轰击给Wafer表面造成的损伤对整个化学反应起到了催化作用</li>
<li>离子轰击直接分裂了反应物分子</li>
<li>离子轰击去除了那些抑制反应继续进行的不易挥发的物质</li>
</ol>


<h2>干法刻蚀与湿法刻蚀的比较</h2>

<p><img src="http://i.imgur.com/HkoqZ3w.png" alt="干湿法刻蚀的比较" /></p>

<h2>刻蚀的评价指标</h2>

<ol>
<li>选择比（有两个，膜与光刻胶，膜与下方一层的介质）</li>
<li>各向异性</li>
<li>均匀性</li>
</ol>


<h2>刻蚀中三个最重要的考虑要素</h2>

<ol>
<li>刻蚀的选择比</li>
<li>各向异性</li>
<li>离子轰击损伤</li>
</ol>


<h2>等离子体刻蚀的试剂中加入C、H、O的原因</h2>

<ul>
<li>C、H、O的有意引入目的在于使反应生成聚合物保护侧壁不被刻蚀，加强了各向异性的刻蚀</li>
</ul>


<h2>刻蚀的终点控制</h2>

<ol>
<li>干涉法，检测薄膜厚度</li>
<li>根据光发射谱，检测反应物浓度（最常用）</li>
<li>质谱法（最准确，最贵）</li>
</ol>


<h2>刻蚀中的若干问题</h2>

<ol>
<li>掩膜损失

<ol>
<li>刻蚀过程中光刻胶也会有所损失，使得光刻胶定义的窗口展宽，不利于定向腐蚀</li>
<li>解决办法：使用硬掩膜</li>
</ol>
</li>
<li>侧壁沉积物的控制

<ol>
<li>反应生成有机物在侧壁的沉积过多会使得光刻胶定义的窗口缩小</li>
<li>通过反应气氛中接入小量的O2去除适当的侧壁生成物，使之不产生大量的堆积</li>
</ol>
</li>
<li>侧壁堆积的聚合物对电路可靠性产生不利影响

<ol>
<li>刻蚀完成后需要加入阳等离子体的处理，去除侧壁聚合物，提高电路的可靠性</li>
</ol>
</li>
<li>负载效应（Loading effect）

<ol>
<li>刻蚀速率与被刻蚀材料的暴露表面积相关，表面积越大，刻蚀速率越慢，使得刻蚀均匀性受很大影响</li>
<li>解决方法：在图形稀疏区域加一些dummy pattern（加图形），使各个区域的图形密度大致相当</li>
</ol>
</li>
<li>天线效应

<ol>
<li>离子轰击是带电荷的，在对金属引线或者多晶硅的刻蚀过程中，金属对于器件来说相当于天线，收集了大量的电荷，这些电荷产生的电场有可能会击穿介质层</li>
<li>解决方法：工艺与设计相结合，设计时候避免较大较长的金属引线的刻蚀</li>
</ol>
</li>
</ol>


<h2>刻蚀过程中，由于几何表面不平整带来的影响（有好有坏）</h2>

<ol>
<li>光刻胶的重淀积，一方面保护了侧壁，另一方面会影响器件的性能</li>
<li>纵梁（stringer）效应：台阶处的薄膜厚度各不相同，各向异性刻蚀会在台阶侧壁形成一道“纵梁”，需要大量的over-etch才能消除纵梁效应</li>
</ol>


<h2>Blanket Metal Etch-back</h2>

<ul>
<li>填充连接孔（contact hole）&ndash;钨塞：首先用LPCVD 的方式淀积金属W，然后用RIE的方式刻蚀掉表面多余的W，只留下连接孔里面的金属W</li>
<li>回刻是不需要掩膜的</li>
</ul>


<h2>Lift-Off 工艺（剥离工艺）</h2>

<ul>
<li>如果薄膜在等离子体中刻蚀不能生成易挥发的化合物，比如刻蚀铜Cu，可以采用Lift-Off的方法

<ul>
<li>使用图形化的工艺淀积一层牺牲层（一般是光刻胶），只留下需要的图形没有淀积上光刻胶</li>
<li>淀积需要的金属铜Cu，此时没有覆盖光刻胶的部分就会淀积上一层Cu</li>
<li>使用简单的湿法刻蚀，去除掉光刻胶，最后剩下的就是需要的金属铜构成的图形</li>
</ul>
</li>
<li>低产量，低均匀性，不适用于量产</li>
</ul>


<h2>MOSFET多晶硅删的刻蚀</h2>

<p><img src="http://i.imgur.com/fHsTbdE.png" alt="MOSFET多晶硅删的刻蚀" /></p>

<h2>TSV（through silicon via）刻蚀</h2>

<p><img src="http://i.imgur.com/7CFMDkg.png" alt="TSV刻蚀" /></p>

<h2>掺杂</h2>

<ol>
<li>掺杂是将掺杂物替位式地引入半导体材料的晶体结构中以改变其电学特性</li>
<li>分类：

<ol>
<li>离子注入</li>
<li>热扩散</li>
<li>原位掺杂，用在单晶硅生长或者薄膜生长的过程中，例如拉单晶时候对硅进行磷或硼掺杂</li>
</ol>
</li>
<li>想要在掺杂区域获得良好的掺杂分布图需要对深度（depth）和浓度（concentration）有好的控制能力。离子注入方式在这方面做得比较好</li>
<li>参杂的来源可以是固体，气体，液体（BBr3，AsCl3，POCl3，在高温熔炉里此时都已称为蒸汽）和沉积源（如SOG，方法是让包含杂质的玻璃溶解）</li>
<li>固溶度（Solid solubility limit）：能够被热扩散进入Si的最大剂量。离子注入不受固溶度的限制</li>
<li>在氧化过程中将杂质引入，热扩散过程中伴随着Si的氧化

<ol>
<li>掺杂过程中有意引入氧气</li>
<li>掺杂B使用B2O3</li>
<li>掺杂P使用P2O5</li>
<li>掺杂As使用As2O3</li>
</ol>
</li>
<li>H,Li,Na,K,Ar等I，VIII族元素在Si的扩散属于<strong>间隙扩散</strong>，间隙扩散适用于原子半径小的元素。</li>
<li>替位扩散是一种空位扩散，依赖两种情况：

<ol>
<li>相邻位置有空位</li>
<li>杂质原子有足够的能量克服势垒</li>
</ol>
</li>
<li>替位式掺杂才有电学活性</li>
<li>间隙式扩散的激活能远远小于替位式扩散的激活能</li>
</ol>


<h2>扩散工艺综述</h2>

<p><img src="http://i.imgur.com/g7IMqR7.png" alt="扩散工艺介绍" /></p>

<ol>
<li>杂质在纵向扩散的同时，也进行横向扩散。一般横向扩散长度为纵向扩散深度的0.75~0.85，横向扩散是“设计规则”要考虑的重要因素，影响IC的集成度，也影响PN结电容</li>
<li><p>扩散系数D表征杂质在硅的晶体里面扩散的运动速率，不同的杂质在不同温度下有不同的扩散系数。
<img src="http://i.imgur.com/jcwfNB7.png" alt="扩散系数" /></p></li>
<li><p>Ea是原子扩散的激活能</p></li>
<li>在Si中，B和P的扩散属于替位式原子扩散，这种扩散需要通过晶体的热缺陷的产生和运动来实现，因此需要较高的温度</li>
<li>对于半径很小的原子，比如金原子，它在硅中是通过晶格间隙来扩散的，扩散温度比较低。</li>
<li>扩散中的掩膜使用SiO2，Si3N4这些耐高温的材质</li>
</ol>


<h2>两步扩散工艺</h2>

<p><img src="http://i.imgur.com/VI5ZUab.png" alt="两步扩散工艺" />
1. 预淀积（Predeposition），确定总体的掺杂数目，有两个影响因素：
    1. 杂质的扩散率
    2. 杂质的最大固溶度
2. 推进（Drive-in ），确定杂质的分布
3. 为什么要分成两步？
    * 因为需要控制浓度（剂量）和结深，很难在一步之内同时控制这两个参数
4. 使用SiO2扩散掩膜来实现选择性杂质扩散，SiO2膜需要一定的厚度以保证高的选择比
5. 多晶硅中的热扩散有一种效应叫做：晶界效应。即在晶粒内部的杂质扩散类似于单晶硅，但是在晶粒边界由于晶格缺陷造成大量空位，杂质的扩散速度大大加快</p>

<h2>菲克定律</h2>

<p><img src="http://i.imgur.com/9763hv6.png" alt="菲克定律" />
<img src="http://i.imgur.com/ACDN0b2.png" alt="菲克定律公式" />
<img src="http://i.imgur.com/CXbDq7g.png" alt="扩散过程计算" />
<img src="http://i.imgur.com/EPygnPf.png" alt="预淀积过程扩散浓度计算" />
<img src="http://i.imgur.com/OHhOG0Q.png" alt="推进过程的扩散浓度计算" />
1. 预淀积阶段，杂质分布服从余误差函数，扩散总量Q(t)=2Cs<em>sqrt(D</em>t)/sqrt(π)≈1.13<em>Cs</em>sqrt(D*t)
2. 热扩散的推进阶段，杂质分布服从半高斯分布，理论上中心点在0处；离子注入的杂质分布也服从高斯分布，中心在Rp（投影射程）处</p>

<h2>离子注入工艺</h2>

<ol>
<li>热扩散方法的缺陷

<ol>
<li>表面浓度和扩散深度相关</li>
<li>基本上只能获得高斯或余误差分布</li>
<li>受上述各种增强扩散因素的影响，实际上很难精确控制杂质浓度和深度</li>
</ol>
</li>
<li>离职注入可以精确地控制杂质数量和灵活的调节其分布，代价是晶格损伤。晶格损伤可以通过退火工艺来消除</li>
<li>离子注入设备

<ol>
<li>离子源：气态源或者固态源BF3，AsH3，PH3</li>
<li>放电室：低气压、分解离化气体，如BF3->B,B+,BF2+,F+等</li>
<li>引出狭缝：负电位，吸引出离子

<ol>
<li>离子束流量（最大mA量级）</li>
<li>吸极电压约为15~30KV,决定引出离子的能量</li>
</ol>
</li>
<li>质谱仪：选择注入所需的杂质成分

<ol>
<li>分析磁铁：磁场方向垂直于离子束的速度方向</li>
<li>出口狭缝：只允许一种(m/q)的离子离开分析仪</li>
</ol>
</li>
<li>加速管：加速离子，获得所需能量；高真空。最终获得动能和电压差，离子所带的电荷数有关</li>
<li>终端台：控制离子束扫描和剂量

<ol>
<li>法拉第杯：捕获进入的电荷，测量离子流</li>
</ol>
</li>
</ol>
</li>
<li>离子注入的优势

<ol>
<li>对剂量和杂质分布的精确控制，不受固溶度极限的限制</li>
<li>低温工艺，可以使用光刻胶作掩膜</li>
<li>更多的对掩膜材料的选择（如PR，SiO2，多晶硅，金属）</li>
<li>对表面清洁度不敏感</li>
<li>杂质有很少的横向扩散</li>
<li>可以穿过顶层对下层的材料进行掺杂</li>
<li>介质分布可以通过多次不同投影射程的离子注入来实现（如为了形成矩形分布）</li>
<li>杂质纯度非常高（因为使用了质谱仪将需要的杂质分离出来）</li>
</ol>
</li>
<li>离子注入关键的参数：

<ol>
<li>剂量（dose）：硅片上单位面积注入的离子数量，用法拉第杯测量注入的离子数量来控制束流大小</li>
<li>投影射程（project range）：指深度方向的延伸的距离。注入能量是决定注入深度的关键因素</li>
</ol>
</li>
<li>离子注入的局限性

<ol>
<li>难以得到B的浅结，或者As的深结，原因在于投影距离受到离子入射能量的限制（能量太高太低都不好做到）</li>
<li>离子注入损伤是无法避免的（部分Si晶格遭破坏，表面非晶化），需要后续高温热退火修复并且激活杂质</li>
<li>通常需要一层氧化层充当牺牲层，来保护衬底</li>
<li>有沟道效应
<img src="http://i.imgur.com/vw1Vg6s.png" alt="入射离子的分布" /></li>
</ol>
</li>
</ol>


<h2>溅射，散射与注入</h2>

<ol>
<li>当真空中有一束离子束摄像一块固体材料，离子束把固体材料的原子或者分子撞出固体材料的表面，这种现象叫做溅射</li>
<li>当离子束从固体表面反弹回来或者穿出固体材料而去，这种现象叫做散射</li>
<li>当离子束射到固体材料以后，受到固体材料的抵抗，速度慢慢降低，最终停留在固体材料中，这种现象叫做离子注入</li>
</ol>


<h2>影响离子注入的因数</h2>

<ol>
<li>横向偏差：入射离子的分布大于光刻胶开孔的区域</li>
<li>MASK的材料，很多情况下是图形化后的光刻胶，光刻胶的厚度要根据实际情况定</li>
<li>现代工艺需要浅结，一味降低加速电压会导致离子束流不稳定，为了实现离子的低能注入，可以采用分子注入的方法。如注入B+可以使用BF2+，B+的注入动能会降低为20%</li>
<li>沟道效应：一束准直带电粒子通单晶相互作用，当入射方向接近某一主晶轴方向，粒子射程明显增加。沟道效应会使注入注入分布产生很长的拖尾。解决方法是偏离轴注入，或者衬底表面非晶化处理。</li>
<li>注入损伤和退火。

<ol>
<li>注入损伤的形成：高能入射离子与靶原子核发生碰撞时，使靶原子离开初始晶格位置，并引发连续碰撞，引起大量靶原子跑哪里晶格位置，产生空位和填隙原子等晶格损伤。</li>
<li>注入损伤阈值剂量：超过某一剂量注入后，形成完全损伤，晶体的长程有序被破坏。离子越轻，阈值计量越高。温度越高，阈值计量越高。</li>
</ol>
</li>
</ol>


<h2>IC工艺中的热预算</h2>

<ol>
<li>IC制造过程中经过每一步高温工艺，都会对最终的杂质分布产生影响&ndash;杂质再分布</li>
<li>随着IC器件中尺寸的不断缩小，要求杂质的再分布要尽可能小，因此“Thermal Budget”称为工艺集成中要考虑的一个非常重要的概念，尽量减少采用高温工艺，采用RTA等</li>
<li>Rapid Thermal Process（RTP）和Rapid Thermal Annealing（RTA）成为常用工艺手段</li>
<li>RTA用来激活杂质，修复缺陷，并且能够防止杂质扩散，具有较低的热预算，在“浅结”器件的制作中不可缺少</li>
</ol>


<h2>浅结的制作</h2>

<ol>
<li>低能离子注入</li>
<li>分子注入代替离子注入</li>
<li>快速热退火RTA</li>
<li>表面非晶化</li>
<li>偏轴方向注入杂质</li>
</ol>


<h2>浅槽隔离（STI，Shallow Trench Isolation）</h2>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cortex-M0]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/06/cortex-m0/"/>
    <updated>2015-10-06T12:23:50+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/06/cortex-m0</id>
    <content type="html"><![CDATA[<h2>ARM体系变种</h2>

<ol>
<li>M变种：

<ol>
<li>长乘法操作：32位整数乘以32位整数，生成64位整数</li>
<li>长乘加操作：32位整数乘以32位整数，加上32位整数，生成64位整数</li>
</ol>
</li>
<li>T变种：

<ol>
<li>Thumb指令集是ARM指令集的一个子集重新编码而成的，它使ARM更加高效地进行运作</li>
</ol>
</li>
<li>E变种：

<ol>
<li>增加了新的16位数据乘法与乘加操作指令</li>
<li>实现饱和的带符号数的加减法操作指令</li>
<li>进行双字数据操作的指令，包含LDRD、STDR、MCRR\MRRC</li>
<li>cache预取指令PLD</li>
</ol>
</li>
<li>J变种：

<ol>
<li>Jazelle技术：将Java代码运行速度提高了8倍，功耗降低了80%</li>
</ol>
</li>
<li>SIMD变种：

<ol>
<li>可同时进行两个16位操作数或者4个8位操作数的运算</li>
<li>用户可以定义饱和运算模式</li>
<li>32位乘以32位的小数MAC</li>
<li>音频\视频处理性能提高了4倍</li>
<li>提供小数算数运算</li>
<li>两套16位操作数的乘加\乘减运算</li>
</ol>
</li>
</ol>


<h2>ARM处理器系列</h2>

<ol>
<li>ARM7系列

<ol>
<li>小型、快速、低能耗、集成式的RISC芯片</li>
<li>冯诺依曼体系结构</li>
<li>三级流水线制</li>
<li>优秀的调试机制</li>
</ol>
</li>
<li>ARM9、ARM9E系列

<ol>
<li>哈佛体系结构：这种体系结构是一种将程序指令存储和数据存储分开的存储器结构，是一种并行体系结构</li>
<li>支持32位的ARM指令和16位Thumb指令</li>
<li>支持一般的操作系统</li>
<li>五级流水处理及分离的Cache结构</li>
<li>ARM9E内核在ARM9内核的基础上增加了紧密耦合存储器的TCM及DSP部分</li>
</ol>
</li>
<li>ARM10E系列

<ol>
<li>支持AMBA总线接口（包含AHB，ASB总线）</li>
<li>六级流水线制</li>
<li>包含DSP指令集</li>
<li>可选浮点协处理器</li>
<li>统一的数据cache和指令cache</li>
<li>能够支持多种商用操作系统</li>
</ol>
</li>
<li>ARM11系列(ARM V6结构)

<ol>
<li>针对媒体处理的SIMD</li>
<li>用以提高安全性能的TrustZone技术</li>
<li>智能能源管理IEM</li>
<li>系统多处理技术</li>
</ol>
</li>
<li>SecurCore系列

<ol>
<li>采用软内核技术</li>
<li>提供面前智能卡和低成本的存储保护单元</li>
<li>可集成用户自己的安全特性和其他处理器</li>
<li>极具安全性</li>
</ol>
</li>
<li>Cortex系列处理器

<ol>
<li>ARM公司在经典处理器ARM11以后的产品改用Cortex命名，并分成A、R和M三类，旨在为各种不同的市场提供服务</li>
<li>A系列面向尖端的基于虚拟内存的操作系统和用户应用</li>
<li>R系列针对实时系统</li>
<li>M系列针对成本和功耗敏感的MCU和终端应用</li>
</ol>
</li>
</ol>


<h2>Cortex-M0/M0+</h2>

<ol>
<li>CortexM0/M0+均是ARMv6M架构,均支持Thumb指令集，支持NVIC和WIC，但不支持Thumb2指令集，其中M0是三级流水线架构，M0+是二级流水线架构</li>
<li>CortexM3，CortexM4均是ARMv7M架构，均支持Thumb，Thumb2指令集，支持NVIC和WIC；CortexA5，CortexA8，CortexA9均是ARMv7A架构</li>
<li>存储器模型：<img src="http://i.imgur.com/KKgz65f.png" alt="ARM CortexM存储器模型" />

<ol>
<li>4GB可寻址线性空间</li>
<li>标准实现，适用于所有Cortex-M系列</li>
<li>无须paging和banking</li>
<li>软件访问可访问性</li>
</ol>
</li>
<li>两种工作模式

<ol>
<li>Thread模式</li>
<li>Handler模式</li>
</ol>
</li>
<li>异常模型

<ol>
<li>异常发生->加载向量列表->异常处理->返回</li>
</ol>
</li>
</ol>


<h2>ARM Cortex-M0+寄存器</h2>

<ol>
<li>32位位宽寄存器：

<ol>
<li>13个通用寄存器：

<ol>
<li>R0-R7（Low registers）</li>
<li>R8-R12(High registers)</li>
</ol>
</li>
<li>3个特殊用处寄存器

<ol>
<li>SP-R13，初始值：0x00000000</li>
<li>LR-R14</li>
<li>PC-R15，初始值0x00000004,Bit[0]为1，表示当前为Thumb代码</li>
</ol>
</li>
<li>特殊寄存器

<ol>
<li>PSR（Program Status Register）</li>
<li>PRIMASK（Interrupt mask register），仅有Bit[0],值为1表示关闭所有中断，只有NMI和硬件错误才能被响应，缺省值为0</li>
<li>CONTROL（control register），只有Bit[0]（定义权限级别，0表示特权级线程模式，1表示普通线程模式，所有的Handler模式都是特权级模式）和Bit[1]（选择当前使用哪个栈指针，0表示选择主栈指针MSP，1表示选择进程栈指针PSP）</li>
</ol>
</li>
</ol>
</li>
<li>寄存器使用方法

<ol>
<li>R0-R3：传递函数参数，返回函数结果，因此也称为a1-a4；也可用于程序内部保存临时变量</li>
<li>R4-R11：保存程序内部的变量值，因此又称为v1-v8，其中r9是个平台相关的寄存器，需要半导体厂商自己定义</li>
<li>R12-R15：专门用途寄存器，R12-IP</li>
</ol>
</li>
<li>程序状态寄存器PSR

<ol>
<li>APSR(Application Program Status Register)，包括Negative，Zero，Carry和Overflow的标志位</li>
<li>IPSR(Interrupt Program Status Register)，包括Exception number(前6位)</li>
<li>EPSR(Execution Program Status Register)，包括Thumb code is executed的指示位</li>
<li>程序状态寄存器的访问指令：MSR和MRS</li>
</ol>
</li>
</ol>


<h2>ARM Cortex-M0+指令集</h2>

<ol>
<li>每条Thumb指令有相同处理器模型所对应的32位ARM指令，比如可以将Thumb指令ADD Rd，#immed_8转换为ARM指令ADD Rd，Rd，#immed_8</li>
<li>Thumb的56条指令分类：

<ol>
<li>存储器访问指令

<ol>
<li>ADR:Generate PC-relative address</li>
<li>LDM:Load Multiple registers</li>
<li>LDR{type}:Load Register using immediate offset</li>
<li>LDR{type}:Load Register using register offset</li>
<li>LDR:Load Register from PC-relative address</li>
<li>POP:Pop register from stack</li>
<li>PUSH:Push registers onto stack</li>
<li>STM:Store Multiple registers</li>
<li>STR{type}:Store Register using immediate offset</li>
<li>STR{type}:Store Register using register offset</li>
</ol>
</li>
<li>数据处理指令</li>
<li>分支和控制指令

<ol>
<li>B{cc}:Branch {conditionally},如果使用了条件执行，那么跳转范围在-256~254字节内；如果没有使用条件执行，那么跳转范围在±1M内</li>
<li>BL:Branch with Link,跳转范围±16MB</li>
<li>BLX:Branch indirect with Link</li>
<li>BX:Branch indirect</li>
</ol>
</li>
<li>杂项指令

<ol>
<li>MRS:Move from special register to register</li>
<li>MSR:Move from register to special register</li>
<li>CPSID:Change Processor State,Disable Interrupts,C语言操作函数:void __disable_irq(void);</li>
<li>CPSIE:Change Processor State,Enable Interrupts,C语言操作函数：void __enable_irq(void);</li>
<li>WFE:Wait For Event,C语言操作函数：void __WFE(void);</li>
<li>WFI:Wait For Interrupt,C语言操作函数：void __WFI(void);</li>
<li>NOP:No Operation,C语言操作函数：void __NOP(void);</li>
<li>SVC:Supervisor Call</li>
</ol>
</li>
</ol>
</li>
</ol>


<h2>ARM Cortex-M0+外设</h2>

<ol>
<li>外设的映射

<ol>
<li>Private Peripheral Bus（PPB）的映射(0xE0000000-0xE00FFFFF)</li>
<li>SysTick:24位计数器，扩展的NVIC特性</li>
<li>NVIC：中断设置与配置</li>
<li>SCB:提供系统实现和系统控制；包括配置、控制和上报系统异常</li>
<li>MPU（Memory Protection Unit）</li>
</ol>
</li>
<li>NVIC接口API：

<ol>
<li>void NVIC_EnableIRQ(IRQn_t IRQn);</li>
<li>void NVIC_DisableIRQ(IRQn_t IRQn);</li>
<li>uint32_t NVIC_GetPendingIRQ(IRQn_t IRQn);</li>
<li>void NVIC_SetPendingIRQ(IRQn_t IRQn);</li>
<li>void NVIC_ClearPendingIRQ(IRQn_t IRQn);</li>
<li>void NVIC_SetPriority(IRQn_t IRQn,uint32_t priority);</li>
<li>uint32_t NVIC_GetPriority(IRQn_t IRQn);</li>
<li>void NVIC_SystemReset(void);请求一次系统复位</li>
</ol>
</li>
</ol>


<h2>ARM Cortex-M0+可执行镜像</h2>

<ol>
<li>ELF：定义了对象文件的内容和格式</li>
<li>BIN：直接的内存镜像</li>
<li>HEX：包含了目标程序镜像的存储地址</li>
<li>AXF：ARM工具链产生，BIN文件内容+调试信息</li>
</ol>


<h2>WEAK和alias属性</h2>

<ol>
<li>当两个或者两个以上行数具有相同的名字，并其中之一声明为weak属性时，则不会引发重定义错误。连接器会忽略弱属性的函数，而使用普通的函数来解析所有对这些符号的引用</li>
<li>如果普通的函数不可用时，连接器会使用weak属性的函数</li>
<li>alias属性：声明别名，当weak和alias属性连用时，可以声明弱别</li>
</ol>


<h2>错误异常</h2>

<ol>
<li>优先级仅次于复位和NMI</li>
<li>引起错误异常的来源：

<ol>
<li>Memory访问异常</li>
<li>程序异常</li>
</ol>
</li>
<li>错误异常分析：<img src="http://i.imgur.com/DrQtd2F.png" alt="错误异常分析" />

<ol>
<li>当异常发生时，处理器首先会保护现场，因此可以得到当前寄存器的值，以及异常发生前被压栈的寄存器的值</li>
<li>判断PC的返回值是否合法，存储器的访问地址是否正确，栈地址是否正确以及是否出现了溢出</li>
<li>访问PSR寄存器来获取当前处理器的状态信息</li>
</ol>
</li>
</ol>


<h2>锁定</h2>

<ol>
<li>锁定（Lockup）的发生：

<ol>
<li>在处理NMI或者HardFault时产生错误异常</li>
<li>异常处理返回，当PSP出栈时，系统总线错误</li>
</ol>
</li>
<li>锁定的退出：

<ol>
<li>复位</li>
<li>Debugger</li>
</ol>
</li>
<li>锁定的预防：

<ol>
<li>尽量缩短NMI和HardFault异常的处理时间</li>
<li>在进入HardFault异常处理前，添加汇编代码，检查SP指针</li>
</ol>
</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Wizwiki_W7500]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/04/wizwiki-w7500/"/>
    <updated>2015-10-04T22:51:33+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/04/wizwiki-w7500</id>
    <content type="html"><![CDATA[<h2>WIZwiki-W7500平台介绍</h2>

<ol>
<li>W7500单芯片解决方案：ARM Cortex-M0，48MHz，128KB Flash，16KB RAM，硬件TCP/IP内核，32KB TCP/IP专属RAM，MII接口，8个socket</li>
<li>程序下载方法：

<ol>
<li>CMSIS-DAP USB下载</li>
<li>利用串口的ISP固件下载方式(按住boot键不放，按一下sw键进入boot模式)</li>
</ol>
</li>
<li>SWD(Serial Wire Debug)调试</li>
<li>2路SPI接口，2路I2C接口，3路UART接口，8路ADC(12bit，1Msps)，6路DMA控制器，1个32位的RNG（随机数生成器）</li>
<li>外部PHY芯片：IP101GA

<ol>
<li>支持自动MDI / MDIX功能以简化网络的安装以及降低系统维护成本，即自动识别交叉线与直连线</li>
<li>提供媒体独立接口（MII）或简化媒体独立接口（RMII）与不同类型的10/100Mbps的媒体访问控制器（MAC）连接</li>
<li>支持MDC和MDIO与MAC沟通</li>
</ol>
</li>
<li>CMSIS-DAP实现芯片：LPC11U35FHI33/501

<ol>
<li>CMSIS-DAP功能：

<ol>
<li>通过USB烧写固件到W7500</li>
<li>利用W7500的UART1，通过USB接口与外界进行串口通讯（PC端需要安装驱动，驱动安装成功后会虚拟出串口名如：mbed Seral Port(COMn)）</li>
</ol>
</li>
</ol>
</li>
<li>开发板框图：<img src="http://i.imgur.com/YbsZrdE.png" alt="板子框图" /></li>
<li>W7500芯片框图：<img src="http://i.imgur.com/pLcN78g.png" alt="W7500芯片框图" /></li>
</ol>


<h2>MII</h2>

<ol>
<li>MII即媒体独立接口，也叫介质无关接口，它是IEEE-802.3定义的以太网行业标准，它包括一个数据接口，以及一个MAC和PHY之间的管理接口,MAC与PHY间的管理接口一般是MDIO</li>
<li>数据接口包括分别用于发送器和接收器的两条独立信道，每条信道都有自己的数据、时钟和控制信号。</li>
<li>管理接口是个双信号接口：一个是时钟信号，另一个是数据信号。通过管理接口，上层能监视和控制PHY</li>
<li>MII数据接口总共需要16个信号：
<img src="http://i.imgur.com/WkMJaE8.jpg" alt="MII接口" />

<ol>
<li>Tx_CLK/Rx_CLK：分别是Tx和Rx的时钟信号。均由PHY驱动</li>
<li>TxD[0···3]/RxD[0···3]：分别是Tx和Rx的数据传输线。TxD是控制器驱动，RxD是PHY驱动</li>
<li>Tx_EN/Rx_DV：分别是Tx和Rx的开关。这两根线都是PHY驱动。只有在Tx_EN有效时，TxD才会被PHY接收；只有在Rx_DV有效时，RxD才会被控制器接收</li>
<li>Tx_ER/Rx_ER：分别是Tx和Rx的报错线。这两根线都是PHY驱动。即使是在Tx_EN或Rx_DV期间，只要此两根线有效，则出错的那个周期所传数据无效。10Mb以太网传输时，ER信号不影响正常传输，若不使用ER线，需将其接地</li>
<li>CRS/COL：监听介质是否空闲/监听是否有冲突发生。这两根线都是由PHY驱动，并且只在半双工模式下有效</li>
</ol>
</li>
<li>MII接口：MDC和MDIO。通过它，控制芯片可以访问PHY的寄存器(100M物理层芯片中介绍的寄存器组，但不仅限于100M物理层芯片，10M物理层芯片也可以拥有这些寄存器)，并通过这些寄存器来对物理层芯片进行控制和管理

<ol>
<li>MDC：管理接口时钟。它是由控制器驱动，与TX_CLK和RX_CLK无任何关系</li>
<li>MDIO：用来传送MAC层的控制信息和物理层的状态信息。它是一根双向的数据线。因MDIO在某个时钟周期内会空闲，呈高阻状态，故使用时须将其<strong>上拉</strong></li>
</ol>
</li>
<li>事实上，一个控制器，可以通过Management Interface来管理32个PHY。即，MDC和MDIO是可以复用的。</li>
<li>MAC主要是通过MDIO（以MDC为时钟）来读写PHY的寄存器，MDIO上数据帧的格式如下：
<img src="http://i.imgur.com/BTLzrtr.jpg" alt="MDIO上数据帧的格式" /></li>
<li>数据开始前，会发32个1，然后数据开始时先发送一个0，然后恢复到1；接下来两位，10表示读，01表示写；紧接着的5为是PHY地址；下面5位是寄存器地址；接下来两位表示状态转换域，若为读操作，则第一比特时MDIO为高阻态，第二比特时由物理层芯片使MDIO置“0”。若为写操作，则MDIO仍由MAC层芯片控制，其连续输出“10”两个比特。;接下来是16位的数据；空闲时线上为高阻</li>
<li>以前的10M的MAC层芯片和物理层芯片之间传送数据是通过一根数据线来进行的，其时钟是10M，在100M中，如果也用一根数据线来传送的话，时钟需要100M，这会带来一些问题，所以定义了MII接口，它是用4根数据线来传送数据的，这样在传送100M数据时，时钟就会由100M降低为25M，而在传送10M数据时，时钟会降低到2.5M，这样就实现了10M和100M的兼容。</li>
<li>MII接口的MAC模式定义：
<img src="http://i.imgur.com/e0vGKku.gif" alt="MII接口MAC模式" /></li>
<li>MII接口PHY模式定义：
<img src="http://i.imgur.com/wB70rjr.gif" alt="MII接口PHY模式" /></li>
<li>在MII接口的连线中，如果TX_ER信号线没有用到，必须将它下拉接地。</li>
<li>RXD_DV同步于RX_CLK，被PHY驱动，它的作用如同于发送通道中的TX_EN，不同的是在时序上稍有一点差别：为了让数据能够成功被RS接收，要求RXD_DV有效的时间必须覆盖整个FRAME的过程</li>
<li>MDC：管理接口的时钟，它是一个非周期信号，信号的最小周期（实际是正电平时间和负电平时间之和）为400ns，最小正电平时间和负电平时间为160ns，最大的正负电平时间无限制。它与TX_CLK和RX_CLK无任何关系。</li>
<li>MDIO是一根双向的数据线。用来传送MAC层的控制信息和物理层的状态信息。MDIO数据与MDC时钟同步，在MDC上升沿有效。</li>
<li>MDIO数据帧的时序关系：
<img src="http://i.imgur.com/S4p240T.gif" alt="MDIO数据帧的时序关系" /></li>
<li>MII接口也有一些不足之处，主要是其接口信号线很多，发送和接收和指示接口有14根数据线(不包括MDIO接口的信号线，因为其被所有MII接口所共享)，当交换芯片的端口数据较多时，会造成芯片的管脚数目很多的问题，这给芯片的设计和单板的设计都带来了一定的问题。为了解决这些问题，人们设计了两种新的MII接口，它们是RMII接口(Reduced MII接口)和SMII接口(StreamMII接口)。这两种接口都减少了MII接口的数据线，不过它们一般只用在以太网交换机的交换MAC芯片和多口物理层芯片中，而很少用于单口的MAC层芯片和物理层芯片中。RMII接口和SMII接口都可以用于10M以太网和100M以太网，但不可能用于1000M以太网，因为此时时钟频率太高，不可能实现。</li>
</ol>


<h2>中断和事件</h2>

<ol>
<li>W7500包含26路中断请求IRQ，一个非屏蔽中断NMI，一个事件信号</li>
<li>W7500可以处理内部事件以唤醒内核（WFE），唤醒事件可以通过如下方式产生：

<ol>
<li>DMA进程完成之后</li>
</ol>
</li>
</ol>


<h2>供电</h2>

<ol>
<li>W7500内部嵌入一个稳压器来提供内部1.5V的电压，稳压器没有掉电模式或者休眠模式</li>
<li>ADC参考电压和VDD相同</li>
<li>W7500在系统或电源复位后会处于工作模式，当CPU停止工作时可以采用两种低功耗模式(W7500没有掉电模式)：休眠模式(Sleep)和深度休眠(Deep Sleep)</li>
<li>休眠模式仅仅关闭了CPU时钟，总线时钟依旧开启，深度休眠模式中总线时钟和存储器时钟都被关闭</li>
</ol>


<h2>TOE</h2>

<ol>
<li>TCP/IP卸载引擎(TOE)是一个嵌入式全硬件TCP/IP以太网控制器，它可以提供更简洁的嵌入式网络接入方案。TOE提供WOL(网络唤醒)功能可以大大降低系统功耗</li>
<li>TOE框图：
<img src="http://i.imgur.com/Mvcx1hV.png" alt="TOE区域框图" /></li>
<li>NCONFLR（网络配置锁存寄存器）用来锁定和解锁对网络配置寄存器(SIR,SUBR,GAR和SHAR)的访问。当LOCK处于ON，受保护的寄存器无法进行配置，在这种情况下，写入NCONFLR寄存器的值是0x01ACCE55，当LOCK处于OFF，受保护的寄存器可以进行配置，这是该寄存器的值为非0x01ACCE55的其他任意值。</li>
<li>TCKCNTR(Ticker计数寄存器)，用于向TOE内部定时器提供100us的Ticker计数。Ticker计数器单元是HCLK</li>
</ol>


<h2>启动顺序</h2>

<ol>
<li>W7500有三种不同的启动模式，可以通过BOOT引脚和TEST引脚选定。TEST=0，BOOT=0，在主Flash存储器中执行用户代码；TEST=0，BOOT=1，W7500支持ISP功能以便于用串口控制flash</li>
</ol>


<h2>存储器</h2>

<ol>
<li>Flash存储器由长度为32为宽的存储单元构成，可以用于存储代码或者数据</li>
<li>存储器的构成基于一个主Flash存储器块，包含256字节的512扇区，或者4KB的32个块。块和扇区停工读/写保护</li>
</ol>


<h2>时钟复位发生器CRG</h2>

<ol>
<li>CRG包括PLL和POR</li>
<li>三种类型的复位：

<ol>
<li>外部复位，上电复位，系统复位</li>
<li>系统复位是当下面的情况发生时产生复位：

<ol>
<li>看门狗事件</li>
<li>重映射之后</li>
<li>软件复位(在Cortex-M0的SYSRESETREQ为)</li>
</ol>
</li>
</ol>
</li>
<li>两种时钟源可以用来驱动系统时钟：

<ol>
<li>外部振荡器时钟(8MHz~24MHz)(OCLK)</li>
<li>内部8MHz RC振荡器(RCLK)</li>
</ol>
</li>
<li>RNGCLK只有一个源(pll输出)并且没有预分频器</li>
<li>CRG框图：<img src="http://i.imgur.com/xZTW330.png" alt="CRG框图" /></li>
<li>监视时钟源：

<ol>
<li>监视引脚：PA_02</li>
<li>配置寄存器：MONCLK_SSR</li>
</ol>
</li>
</ol>


<h2>随机数发生器RNG</h2>

<ol>
<li>RNG是一个32位随机数发生器，当上电复位时，RNG会产生一个上电随机数，RNG可以通过软件来运行/停止。RNG的初始值和多项式值可以通过软件来更新</li>
</ol>


<h2>外部中断</h2>

<ol>
<li>不管任何功能引脚功能设置，功能引脚都可以被用作一个外部中断源</li>
<li>外部中断控制器的中断极性分为上升沿和下降沿</li>
</ol>


<h2>Pad控制器</h2>

<ol>
<li>W7500具有数字I/O功能引脚和数字/模拟多路复用I/O功能引脚，功能引脚的可控性特性包括上拉，下拉，驱动强度，输入开启和CMOS/Schmitt触发输入缓存</li>
</ol>


<h2>GPIO</h2>

<ol>
<li>屏蔽寄存器可将端口位视为整体而其他位不变</li>
<li>访问屏蔽功能允许一位或者多位在单向传输过程中读或写，这避免了基于软件的读-修改-写操作的非线程安全问题。有了访问屏蔽操作，16-bit I/O被分成两半，低字节和高字节，这个位被定义为两个数组，每一个包含256字节</li>
</ol>


<h2>UART</h2>

<ol>
<li>发送的数据存储在一个32字节的FIFO中，将需要发送的数据写入发送FIFO中，如果UART被启用，它会按照UARTxLCR_H只是的参数开始发送数据帧。数据会持续发送，直到发送FIFO为空。当有数据被写入发送FIFO或当前处于发送的过程中时，UARTxFR的BUSY位会保持为“1”，表示FIFO中有数据。</li>
<li>接收的数据存储在一个32字节的FIFO里面。当接收到一个起始位，它开始运行，并对UART模式中计数器的第8个周期进行采样。如果UARTRXD为“1”，证实接收到了有效的停止位。当一个完整的字符数据被接收到，数据会被存储在接收FIFO中。错误位会被存储在UARTxCR的【10：8】位置，溢出的被存储在UARTxCR的【11】位</li>
<li>更改UART控制寄存器的步骤：

<ol>
<li>禁用UART</li>
<li>等待接收到或者发送完最后的字符</li>
<li>设置行控制寄存器中FEN位为0，从而刷新发送FIFO</li>
<li>更改UARTCR寄存器</li>
<li>使能UART</li>
</ol>
</li>
<li>W7500有个Simple Uart，其实就是UART2，用来ISP烧写程序的，一般用户不直接拿来使用</li>
</ol>


<h2>uDMAC</h2>

<ol>
<li>共6个通道，每个通道用于管理来自某个或者多个外设的内存访问请求</li>
<li>不要给一个第优先级的 通道分配大不要给一个低优先级的通道分配大的R_power值，因为直到重仲裁之前来自控制器高优先级的请求都会被阻止</li>
<li>当N>2<sup>R</sup>，并且不是2<sup>R</sup>的整数倍时，控制器总是会执行2<sup>R</sup>的传输序列，直到N&lt;2<sup>R</sup>时再传输，控制器会在DMA周期的末尾，再执行剩余N次传输</li>
<li>DMA周期类型：

<ol>
<li>Invalid</li>
<li>Basic</li>
<li>Auto-request</li>
<li>ping-pong</li>
</ol>
</li>
<li>Ping-pong cycle

<ol>
<li>DMA控制器轮流切换主、副两个数据通道，直到接收到一个无效的数据结构或者是circle_type被设置成了basic模式，或者是控制器停止了该通道的工作</li>
<li>当DMA使用其中一个通道进行数据传输时候，处理器可以重新配置另外一个通道的参数</li>
</ol>
</li>
</ol>


<h2>SSP</h2>

<ol>
<li>SSP接口可以同具有以下接口的主句或者从机进行通讯

<ol>
<li>摩托罗拉SPI接口</li>
<li>TI的同步串行接口</li>
<li>国家半导体的Microware接口</li>
</ol>
</li>
<li>SSP接口可作为主机或者从机接口，支持2MHz甚至更高的位速率</li>
<li>PrimeCell SSP复位之后默认是禁用状态，需要按照以下步骤进行配置：

<ol>
<li>更改SSP控制器SSPCR0和SSPCR1来配置SSP接口外设的主从工作模式以及工作的协议标准：Motorola SPI，Texas Instruments SSP，National Semiconductor</li>
<li>通过更改时钟预分频寄存器SSPCRSR来将外部SSPCLK时钟进行分频，从而可以更改位速率</li>
</ol>
</li>
<li>有两种方法可以启动PrimeCell SSP：

<ol>
<li>激活发送FIFO：Prime Cell SSP禁用时，可以通过写入8个16位值发送FIFO</li>
<li>通过发送FIFO服务请求到CPU中断</li>
</ol>
</li>
<li>在从机模式的操作中，为了确保正确的操作，SSPCLK必须必预期的SSPCLKIN最快频率快12倍；在主机模式的操作中，为了确保正确的操作，SSPCLK必须为预期的SSPCLKOUT最快频率的2倍。</li>
<li>SSPCLK的最低频率可以通过下列公式计算，两个条件必须同时被满足：

<ol>
<li>FSSPCLK(min) >= 2 x FSSPCLKOUT(max), for master mode</li>
<li>FSSPCLK(min) >= 12 x FSSPCLKIN(max), for slave mode.</li>
</ol>
</li>
<li>SSPCLK的最高频率可以通过下列公式计算，两个条件必须被同时满足：

<ol>
<li>FSSPCLK(max) &lt;= 254 x 256 x FSSPCLKOUT(min), for master mode</li>
<li>FSSPCLK(max) &lt;= 254 x 256 x FSSPCLKIN(min), for slave mode.</li>
</ol>
</li>
<li>SSPCR0寄存器被用来：

<ol>
<li>编写穿行时钟速率</li>
<li>在三个协议模式中进行选择</li>
<li>选择合适的数据长度</li>
</ol>
</li>
<li>SSPCR1寄存器被用来：

<ol>
<li>选择主/从模式</li>
<li>启用loopback回环测试功能</li>
<li>启用PrimeCell SSP外设</li>
</ol>
</li>
<li>位速率的产生

<ol>
<li>串行位速率通过将输入时钟SSPCLK分频获得。首先，使用范围在2~254的偶数分频值CPSDVSR对输入时钟进行分频，CPSDVSR的值在SSPCPSR寄存器中设置。然后再使用1~256的其中一个值（即1+SCR）对时钟进一步分频T，此处SCR在SSI控制SSPCR0寄存器中设置。</li>
</ol>
</li>
<li>帧格式：根据所设置的数据大小，每个数据帧的长度均在4~16位之间，并且从最高有效位MSB开始发送。

<ol>
<li>德州仪器（TI）同步串行的帧格式

<ol>
<li>在该模式中，任何时候当SSP空闲时，SSPCLKOUT和SSPFSSOUT被强制为低电平，发送数据线SSPTx为三态。一旦发送FIFO的底部入口包含数据，SSPFSSOUT就会变为高电平并持续一个SSPCLKOUT周期。要发送的值也从发送FIFO传输到发送逻辑的穿行移位寄存器中</li>
</ol>
</li>
<li>Motorola SPI的帧格式

<ol>
<li>4线接口，其中SSPFSSOUT信号用作从机选择。Motorola SPI格式的主要特性为：SSPCLKOUT信号的不活动状态和相位均通过SSPSCR0控制寄存器中的SPO和SPH来设置。</li>
<li>SPO，时钟极性位。当SPO时钟极性控制位为低时，它在SSPCLKOUT管脚上产生稳定的低电平值。如果SPO位为高，则在没有进行数据传输的情况下，在SSPCLKPUT管脚上产生一个稳定的高电平值。</li>
<li>SPH，相位控制位。SPH相位控制位用来选择捕获数据的时钟边沿并允许边沿改变状态。SPH在第一个传输位上的影响最大，因为它可以在第一个数据捕获边沿之前允许或不允许一次时钟转换。当SPH相位控制位为低时，在第一个时钟边沿转换时捕获数据。如果SPH位为高，则在第二个时钟边沿转换时捕获数据</li>
</ol>
</li>
<li>National Semiconductor帧格式

<ol>
<li>National Semiconductor格式与SPI格式非常相似，不同的是其采用的是使用主-从消息传递技术的半双工模式而非全双工模式。</li>
<li>此穿行传输都由PrimeCell SSP向片外从器件发送8位控制字开始。在此传输过程中，PrimeCell SSP不会接收到输入的数据，在消息发送完毕后，片外从机对消息进行译码，并在PrimeCell SSP将8位控制消息的最后一位发送完成之后等待一个串行时钟周期，之后从机以请求的数据来响应。</li>
</ol>
</li>
</ol>
</li>
</ol>


<h2>I2C</h2>

<ol>
<li>支持标准模式100Kbps和高速模式400Kbps</li>
<li>SDA是双向的串行数据线，SCL是双向的串行时钟线。总线空闲时，这两根线都为高。每次操作都是9位，包括8个数据位和1个应答位，并且发送数据前必须先传输MSB</li>
<li>数据有效性：在时钟的高电平周期期间，SDA线上的数据必须保持稳定，SDA线上的数据仅可在时钟SCL为低电平时改变。</li>
<li>所有总线传输都带有所需的应答时钟周期，该时钟周期由主机产生。在相应周期内，发送器不能执行下一操作</li>
<li>I2C开始条件和结束条件

<ol>
<li>当SCL为高电平时，SDA线上由高到低的跳变被定义为开始条件，由低到高的跳变被定义为结束条件</li>
<li>开始条件和结束条件总是由主机产生</li>
<li>I2C总线在结束条件之后一段时间重新被释放。如果使用重新开始条件替代结束条件的话，I2C将会保持占用状态</li>
</ol>
</li>
<li>放到SDA线上的每个数据字节应该都是8位，每个字节之后跟随一个应答位。</li>
<li>7位地址之后的第8位是数据方向位（R/W）,0代表写操作，1代表读操作</li>
<li>每个字节之后都有一个应答位，应答位可以使接收者在成功接收到本字节之后，告诉发送者此数据已经被成功接收，可以发送下个字节。主机产生所有的时钟脉冲，包括应答位(第9位)的时钟脉冲</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Yeelink接入]]></title>
    <link href="http://suda-morris.github.io/blog/2015/10/02/yeelink/"/>
    <updated>2015-10-02T12:06:42+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/10/02/yeelink</id>
    <content type="html"><![CDATA[<h2>创建数据点</h2>

<ol>
<li>URL：   <a href="http://api.yeelink.net/v1.0/device/">http://api.yeelink.net/v1.0/device/</a><device_id>/sensor/<sensor_id>/datapoints</li>
<li>数据格式：JSON</li>
<li>Method：POST</li>
<li>返回：HTTP Headers only</li>
<li>一个datapoint是由key和value组成的键值对：

<ol>
<li><strong>数值型传感器</strong>key为timestamp, value为数值;</li>
<li><strong>gps型传感器</strong>key为timestamp, value为JSON格式, 由经度、纬度、速度等GPS信息组成; 同时可以指定是否修正地图上显示的偏移</li>
<li><strong>泛型传感器</strong>key为用户自定义字符串, 大小限定为128个字符; value为JSON格式,由用户自定义具体内容, 大小限定为1024个字符</li>
<li><strong>图像型传感器</strong>key为timestamp, value为图像二进制信息</li>
<li>timestamp为ISO 8601标准时间格式(默认时区为中国标准时间CST), 例如：2012-03-15T16:13:14.</li>
<li>对于数值型传感器和gps型传感器, 如果上传的数据和历史数据的timestamp相同, 则会被丢弃. 若未指定timestamp, 服务器会自动加上当前时间.</li>
</ol>
</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JavaScript知识清单]]></title>
    <link href="http://suda-morris.github.io/blog/2015/09/28/javascript/"/>
    <updated>2015-09-28T12:20:50+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/09/28/javascript</id>
    <content type="html"><![CDATA[<h2>==与===的区别</h2>

<ol>
<li>对于string,number等基础类型，==和===是有区别的

<ol>
<li>不同类型间比较，==之比较“转化成同一类型后的值”看“值”是否相等，===如果类型不同，其结果就是不等</li>
<li>同类型比较，直接进行“值”比较，两者结果一样</li>
</ol>
</li>
<li>对于Array,Object等高级类型，==和===是没有区别的

<ul>
<li>进行“指针地址”比较</li>
</ul>
</li>
<li>基础类型与高级类型，==和===是有区别的

<ol>
<li>对于==，将高级转化为基础类型，进行“值”比较</li>
<li>因为类型不同，===结果为false</li>
</ol>
</li>
</ol>


<h2>事件</h2>

<ol>
<li>常用事件

<ul>
<li>onClick单击事件</li>
<li>onMouseOver鼠标经过事件</li>
<li>onMouseOut鼠标移出事件</li>
<li>onChange文本内容改变事件</li>
<li>onSelect文本框选中事件</li>
<li>onFocus光标聚集事件</li>
<li>onBlur移开光标事件</li>
<li>onLoad网页加载事件</li>
<li>onUnload关闭网页事件</li>
</ul>
</li>
<li>事件冒泡

<ul>
<li>由最具体的元素接收，然后逐级向上传播至最不具体的元素的节点(文档)</li>
</ul>
</li>
<li>事件捕获

<ul>
<li>最不具体的节点先接收事件，而最具体的节点应该是最后接收事件</li>
</ul>
</li>
<li>事件处理

<ol>
<li>HTML事件处理

<ul>
<li>直接添加到HTML结构中</li>
</ul>
</li>
<li>DOM0级事件处理

<ul>
<li>把一个函数赋值给一个事件处理程序</li>
<li>同一个元素多个事件会被覆盖，只有最后一个事件起作用</li>
</ul>
</li>
<li>DOM2级事件处理

<ul>
<li>addEventListener(“事件名”，“事件处理函数”，“布尔值”)；</li>
<li>true：事件捕获</li>
<li>false：事件冒泡</li>
<li>removeEventListen();</li>
</ul>
</li>
<li>IE事件处理程序(IE8及以下)

<ul>
<li>attachEvent</li>
<li>detachEvent</li>
</ul>
</li>
</ol>
</li>
<li>事件对象

<ol>
<li>在触发DOM事件的时候都会产生一个对象</li>
<li>事件对象event

<ol>
<li>type：获取事件类型</li>
<li>target：获取事件目标</li>
<li>stopPropagation()；阻止事件冒泡</li>
<li>preventDefault()；阻止事件默认行为(比如超链接)</li>
</ol>
</li>
</ol>
</li>
</ol>


<h2>DOM对象</h2>

<ol>
<li>当网页被加载时，浏览器会创建页面的文档对象模型(Document Object Model)
<img src="http://i.imgur.com/EwSndVS.png" alt="DOM对象模型" /></li>
<li>DOM操作HTML

<ol>
<li>改变HTML输出流：

<ul>
<li>注意，绝对不要在文档加载完成后使用document.write(),这会覆盖该文档</li>
</ul>
</li>
<li>寻找元素：

<ul>
<li>通过id找到HTML元素,document.getElementById();</li>
<li>通过标签名找到HTML元素,document.getElementByTagName();</li>
</ul>
</li>
<li>改变HTML内容

<ul>
<li>使用属性：innerHTML</li>
</ul>
</li>
<li>改变HTML属性

<ul>
<li>使用属性：attribute，例如：<code>document.getElementById("aid").href="http://www.baid.com";</code></li>
</ul>
</li>
<li>常用方法：

<ol>
<li>getElementsByName();获取name</li>
<li>getElementsByTagName();获取元素</li>
<li>getAttribute();获取元素属性</li>
<li>setAttribute();设置元素属性</li>
<li>childNodes();访问子节点</li>
<li>parentNode();访问父节点</li>
<li>createElement();创建元素节点</li>
<li>createTextNode();创建文本节点</li>
<li>insertBefore();插入节点</li>
<li>removeChild();删除节点</li>
<li>offsetHeight;网页尺寸,例如：<code>var width=document.body.offsetWidth;</code></li>
<li>crollHeight;网页尺寸</li>
</ol>
</li>
<li>创建节点示例
 <code>var body=document.body;var input=document.creatElement("input");input.type="button";input.value="按钮"；body.appendChild(input);</code></li>
</ol>
</li>
<li>DOM操作CSS

<ol>
<li>基本语法：<code>document.getElementById(id).style.property=new style;</code></li>
</ol>
</li>
<li>DOM操作事件句柄

<ol>
<li>addEventListener();向指定元素添加事件句柄</li>
<li>removeEventListener();移出方法添加的事件句柄</li>
</ol>
</li>
</ol>


<h2>内置对象</h2>

<ol>
<li>String对象

<ol>
<li>字符串可以使用使用单引号或者双引号</li>
<li>获取字符串长度：length属性</li>
<li>在字符串中查找字符串的方法：indexOf(),成功返回位置，失败返回-1</li>
<li>内容匹配的方法：match(),成功返回匹配成功的字符串，失败返回空</li>
<li>替换内容的方法：replace()</li>
<li>字符串大小写转换：toUpperCase()/toLowerCase()</li>
<li>字符串转为数组：split</li>
</ol>
</li>
<li>Date对象

<ol>
<li>常用方法：

<ol>
<li>getFullYear():获取年份</li>
<li>getTime():获取毫秒</li>
<li>setFullYear():设置具体的日期</li>
<li>getDay():获取星期</li>
</ol>
</li>
</ol>
</li>
<li>Array数组对象

<ol>
<li>数组的创建

<ul>
<li><code>var myArray=["Hello","iwen","ime"];</code></li>
</ul>
</li>
<li>数组的访问

<ul>
<li>通过指定数组名以及索引号码(下标从0开始)，可以访问某个特定的元素</li>
</ul>
</li>
<li>常用方法

<ul>
<li>concat();合并数组</li>
<li>sort();排序</li>
<li>push();末尾追加元素</li>
<li>reverse();数组元素翻转</li>
</ul>
</li>
</ol>
</li>
<li>Math对象

<ol>
<li>常用方法

<ul>
<li>round():四舍五入;例如Math.round(2.5)等于3</li>
<li>random();返回0~1之间的随机数;例如parseInt(Math.random()*10);</li>
<li>max();返回最高值</li>
<li>min();返回最低值</li>
<li>abs();返回绝对值</li>
</ul>
</li>
</ol>
</li>
</ol>


<h2>浏览器对象</h2>

<ol>
<li>Window对象

<ul>
<li>window对象时BOM的核心，window对象指当前的浏览器窗口。所有JavaScript全局对象，函数以及变量均自动成为window对象的成员；全局变量是window对象的属性，全局函数是window对象的方法，甚至HTML DOM的document也是window对象的属性之一</li>
<li>window.innerHeight:浏览器窗口的内部高度</li>
<li>window.innerWidth:浏览器窗口的内部宽度</li>
<li>window.open(&ldquo;url"，“windowname”，“style”):打开新的网页</li>
</ul>
</li>
<li>计时器

<ol>
<li>方法

<ol>
<li>setInterval();间隔指定的好描述不同的执行指定的代码</li>
<li>clearInterval();停止setInterval()方法执行的函数代码</li>
<li>setTimeout();暂停指定的毫秒数后执行指定的代码</li>
<li>clearTimeout();停止之慈宁宫setTimeout()方法的函数代码</li>
</ol>
</li>
</ol>
</li>
<li>History对象

<ol>
<li>history.back()与在浏览器中点击后退按钮相同</li>
<li>history.forward()与在浏览器中点击向前按钮相同</li>
<li>history.go()进入历史中的某个页面</li>
</ol>
</li>
<li>Location对象

<ol>
<li>location对象用于获得当前页面的地址(URL)，并把浏览器重定向到新的页面</li>
<li>属性与方法

<ol>
<li>location.hostname返回web主机的域名</li>
<li>location.pathname返回当前页面的路径和文件名</li>
<li>location.port返回web主机的端口</li>
<li>location.protocol返回所使用的web协议(<a href="http://%E6%88%96https://">http://%E6%88%96https://</a>)</li>
<li>location.href返回当前页面的URL</li>
<li>location.assign()加载新的文档</li>
</ol>
</li>
</ol>
</li>
<li>Screen对象

<ol>
<li>属性

<ol>
<li>screen.availWidth可用的屏幕宽度</li>
<li>screen.availHeight可用的屏幕高度</li>
<li>screen.Height屏幕高度</li>
<li>screen.Width屏幕宽度</li>
</ol>
</li>
</ol>
</li>
</ol>


<h2>面向对象</h2>

<figure class='code'><figcaption><span>使用闭包以及function来模拟类</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">People</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_age</span> <span class="o">=</span> <span class="nx">age</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">People</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;People:Hello &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_name</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_age</span> <span class="o">+</span> <span class="s2">&quot; years old&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">People</span> <span class="o">=</span> <span class="nx">People</span><span class="p">;</span>
</span><span class='line'><span class="p">}());</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">Student</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">,</span> <span class="nx">grade</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_grade</span> <span class="o">=</span> <span class="nx">grade</span><span class="p">;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_age</span> <span class="o">=</span> <span class="nx">age</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">Student</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">People</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_name</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_age</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">superSay</span> <span class="o">=</span> <span class="nx">Student</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">Student</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">superSay</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Student:Hello &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_name</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_age</span> <span class="o">+</span> <span class="s2">&quot; years old&quot;</span> <span class="o">+</span> <span class="s2">&quot;,Grade: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_grade</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">Student</span> <span class="o">=</span> <span class="nx">Student</span><span class="p">;</span>
</span><span class='line'><span class="p">}());</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">stu</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Student</span><span class="p">(</span><span class="s2">&quot;morris&quot;</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="s2">&quot;one&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">stu</span><span class="p">.</span><span class="nx">say</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h2>AJAX</h2>

<ol>
<li>AJAX(Asynchronous Javascript And XML)</li>
<li>编程模板

<ol>
<li>创建XMLHttpRequest对象</li>
<li>open操作初始化请求信息</li>
<li>监听事件处理响应结果</li>
<li>send操作发出请求</li>
</ol>
</li>
<li>创建各浏览器兼容的XMLHttpRequest对象</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='JS'><span class='line'><span class="kd">function</span> <span class="nx">creatXHR</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ActiveXObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s1">&#39;Msxml2.XMLHTTP&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s1">&#39;Microsoft.XMLHTTP&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">xhr</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>发送请求信息

<ol>
<li>get方法

<ul>
<li><code>xhr.open("GET","http://test/keyword/hit?keyword=c",true);</code></li>
<li><code>xhr.send();</code></li>
</ul>
</li>
<li>post方法

<ul>
<li><code>xhr.open("POST","http://test/keyword/hit",true);</code></li>
<li><code>xhr.send("keyword=c")</code>;</li>
</ul>
</li>
</ol>
</li>
<li>设置请求头信息

<ol>
<li><code>xhr.setRequestHeader("Content-Type","application/json");</code></li>
<li><code>xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");</code></li>
</ol>
</li>
<li>响应的接收与请求</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='JS'><span class='line'><span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span><span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">getAllResponseHeaders</span><span class="p">());</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">getResponseHeader</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">));</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>将Json字符串转换成Json对象：

<ol>
<li>JSON.parse(xhr.responseText);</li>
<li>eval(xhr.responseText);</li>
</ol>
</li>
</ol>


<h2>设计模式</h2>

<ol>
<li>设计原则

<ol>
<li>开闭原则：对扩展开放，对修改关闭</li>
<li>里氏转换原则：子类继承父类，单独调用完全可以运行</li>
<li>依赖倒转原则：引用一个对象，如果这个对象有底层类型，直接饮用底层</li>
<li>接口隔离原则：每一个接口应该是一种角色</li>
<li>合成/聚合复用原则：新的对象应使用一些已有的对象，使之成为新对象的一部分</li>
<li>迪米特原则：一个对象应对其他对象有尽可能少的了解</li>
</ol>
</li>
<li>单例模式</li>
</ol>


<h2>jQuery</h2>

<ol>
<li>jQuery库可以通过一行简单的标记被添加到网页中</li>
<li>jQuery是一个JavaScript函数库</li>
<li>jQuery库包含的功能:

<ol>
<li>HTML元素选取</li>
<li>HTML元素操作</li>
<li>CSS操作</li>
<li>HTML事件函数</li>
<li>JavaScript特效和动画</li>
<li>HTML DOM遍历和修改</li>
<li>AJAX</li>
<li>Utilities</li>
</ol>
</li>
<li>从CDN中载入jQuery，例如：<a href="http://libs.baidu.com/jquery/1.10.1/jquery.min.js">http://libs.baidu.com/jquery/1.10.1/jquery.min.js</a></li>
<li>基础语法：

<ol>
<li>$(selector).action()

<ul>
<li>美元符号定义jQuery</li>
<li>选择符selector“查询”和“查找”HTML元素</li>
<li>jQuery的action()执行对元素的操作</li>
<li>例如：

<ul>
<li>$(this).hide()隐藏当前元素</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CSS样式知识清单]]></title>
    <link href="http://suda-morris.github.io/blog/2015/09/27/css/"/>
    <updated>2015-09-27T10:51:10+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/09/27/css</id>
    <content type="html"><![CDATA[<h2>基础语法</h2>

<blockquote><p>selector{
property:value
}
其中selector有派生选择器，id选择器，类选择器，属性选择器</p></blockquote>

<h2>头部声明</h2>

<p><code>&lt;link href="MyCSS.css" type="text/css" rel="stylesheet"&gt;</code></p>

<h2>id选择器</h2>

<ol>
<li>id选择器可以为标有id的HTML元素指定特定的样式</li>
<li>id选择器以“#”来定义</li>
</ol>


<h1>类选择器</h1>

<ol>
<li>类选择器以一个点来定义</li>
</ol>


<h2>属性选择器</h2>

<ol>
<li><code>&lt;style type="text/css"&gt; [title=te]{color:blue}&lt;/style&gt;</code></li>
<li><code>&lt;p title="te"&gt;属性选择器&lt;/p&gt;</code></li>
</ol>


<h2>CSS背景</h2>

<ul>
<li>background-attachment:背景图像是否固定或者随着页面的其余部分滚动</li>
<li>background-color:设置元素的背景颜色</li>
<li>background-image:把图片设置为背景，url(&ldquo;bg.jpg&rdquo;)</li>
<li>background-position:设置背景图片的起始位置</li>
<li>background-repeat:设置背景图片是否及如何重复</li>
<li>background-size:规定背景图片的尺寸</li>
<li>background-origin:规定背景图片的定位区域</li>
<li>background-clip:规定背景的绘制区域</li>
</ul>


<h2>CSS文本</h2>

<ul>
<li>color：文本颜色</li>
<li>direction：文本方向</li>
<li>line-height：行高</li>
<li>letter-spacing：字符间距</li>
<li>text-align：对齐元素中的文本</li>
<li>text-decoration：向文本中添加修饰</li>
<li>text-indent：缩进元素中文本的首行</li>
<li>text-transform：元素中的字母</li>
<li>unicode-bidi：设置文本方向</li>
<li>white-space：元素中空白的处理方式</li>
<li>word-spacing：字间距</li>
<li>text-shadow:文本阴影</li>
<li>word-wrap:规定文本的换行规则</li>
</ul>


<h2>CSS字体</h2>

<ul>
<li>font-family:设置字体系列</li>
<li>font-size:设置字体的尺寸</li>
<li>font-style:设置字体风格</li>
<li>font-variant:以小型大写字体或正常字体显示文本</li>
<li>font-weight:设置字体的粗细</li>
</ul>


<h2>CSS链接</h2>

<ol>
<li>CSS链接的四种状态：

<ul>
<li>a:link 普通的、未被访问的链接</li>
<li>a:visited 用户已经访问的链接</li>
<li>a:hover 鼠标指针位于链接的上方</li>
<li>a:active 链接被点击的时刻</li>
</ul>
</li>
<li>常见的链接样式：

<ul>
<li>text-decoration属于大多用于去掉链接中的下划线</li>
</ul>
</li>
</ol>


<h2>CSS列表</h2>

<ul>
<li>list-style简写列表项</li>
<li>list-style-image列表项图像</li>
<li>list-style-position列表标志位置</li>
<li>list-style-type列表类型</li>
</ul>


<h2>CSS表格</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nf">#tb</span><span class="p">{</span>
</span><span class='line'>  <span class="k">border-collapse</span><span class="o">:</span><span class="k">collapse</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">500px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nf">#tb</span> <span class="nt">td</span><span class="o">,</span><span class="nf">#tb</span> <span class="nt">th</span><span class="p">{</span>
</span><span class='line'>  <span class="k">border</span><span class="o">:</span><span class="m">1px</span> <span class="k">solid</span> <span class="nb">bisque</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding</span><span class="o">:</span><span class="m">5px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nf">#tb</span> <span class="nt">th</span><span class="p">{</span>
</span><span class='line'>  <span class="k">text-align</span><span class="o">:</span><span class="k">right</span><span class="p">;</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span><span class="nb">aqua</span><span class="p">;</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span><span class="m">#FFFFFF</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nf">#tb</span> <span class="nt">tr</span><span class="nc">.alt</span> <span class="nt">td</span><span class="p">{</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span><span class="nb">black</span><span class="p">;</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span><span class="nb">aquamarine</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>CSS轮廓</h2>

<ul>
<li>outline设置轮廓属性</li>
<li>outline-color设置轮廓的颜色</li>
<li>outline-style设置轮廓的样式</li>
<li>outline-width设置轮廓的宽度</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HTML5知识点清单]]></title>
    <link href="http://suda-morris.github.io/blog/2015/09/25/html5-introduce/"/>
    <updated>2015-09-25T22:26:10+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/09/25/html5-introduce</id>
    <content type="html"><![CDATA[<h2>基础</h2>

<ol>
<li>声明：&lt;!DOCTYPE>

<ul>
<li>HTML有多个不同版本，只有完全明白页面中使用的确切的HTML版本，浏览器才能完全正确地显示出HTML页面</li>
<li>HTML5：

<ul>
<li>&lt;!DOCTYPE html></li>
</ul>
</li>
</ul>
</li>
<li>元素：指的是从开始标签到结束标签的所有代码

<ul>
<li><code>&lt;p&gt; this is my web page &lt;/p&gt;</code>中的<code>this is my web page</code>就是元素内容</li>
<li><code>&lt;br/&gt;</code>表示不含任何元素的空标签，即换行</li>
<li>空元素在开始标签中进行关闭</li>
<li>大多数的HTML元素可拥有属性</li>
</ul>
</li>
<li>属性

<ul>
<li>属性以键值对的形式出现</li>
<li>常用标签属性

<ul>
<li><code>&lt;h1&gt;:align对齐方式</code></li>
<li><code>&lt;body&gt;:bgcolor背景颜色</code></li>
<li><code>&lt;a&gt;:target规定在何处打开连接</code></li>
</ul>
</li>
<li>通用属性

<ul>
<li><code>class：规定元素的类名</code></li>
<li><code>id：规定元素唯一ID</code></li>
<li><code>style：规定元素的样式</code></li>
<li><code>title：规定元素的额外信息</code></li>
</ul>
</li>
</ul>
</li>
<li>格式化

<ul>
<li><code>&lt;b&gt;定义粗体文字</code></li>
<li><code>&lt;big&gt;定义大号文字</code></li>
<li><code>&lt;em&gt;定义着重文字</code></li>
<li><code>&lt;i&gt;定义斜体文字</code></li>
<li><code>&lt;small&gt;定义小号文字</code></li>
<li><code>&lt;strong&gt;定义加重语气</code></li>
<li><code>&lt;sub&gt;定义下标文字</code></li>
<li><code>&lt;sup&gt;定义上标文字</code></li>
<li><code>&lt;ins&gt;定义插入字</code></li>
<li><code>&lt;del&gt;定义删除字</code></li>
</ul>
</li>
<li>样式

<ol>
<li>标签

<ul>
<li><code>&lt;style&gt;:样式定义</code></li>
<li><code>&lt;link&gt;:资源引用</code></li>
</ul>
</li>
<li>属性

<ul>
<li><code>rel="stylesheet"：外部样式表</code></li>
<li><code>type="text/css":引入文档的类型</code></li>
<li><code>margin-left:边距</code></li>
</ul>
</li>
<li>三种样式表插入方法：

<ol>
<li>外部样式表：<code>&lt;link rel="stylesheet" type="text/css" href="mystyle.css"&gt;</code></li>
<li>内部样式表：<code>&lt;style type="text/css"&gt;body{background-color:red} p{margin-left:20px}&lt;/style&gt;</code></li>
<li>内联样式表：<code>&lt;p style="color:red"&gt;</code></li>
</ol>
</li>
</ol>
</li>
<li>链接

<ol>
<li>标签：<a></a></li>
<li>连接数据：文本链接，图片链接</li>
<li>属性：

<ol>
<li>href属性：指向另一个文档的链接</li>
<li>name属性：创建文档内的链接

<ul>
<li><code>&lt;a name="tips"&gt;hello&lt;/a&gt;</code></li>
<li><code>&lt;a href="#tips"&gt;跳转&lt;/a&gt;</code></li>
</ul>
</li>
</ol>
</li>
<li>img标签属性

<ol>
<li>alt：替换文本属性</li>
<li>width：宽</li>
<li>height：高</li>
</ol>
</li>
</ol>
</li>
<li>表格

<ol>
<li>标签

<ul>
<li><code>&lt;table&gt;：定义表格</code>,属性border定义边框大小，属性cellpadding定义单元格边距，属性cellspacing定义单元格间距，属性bgcolor定义表格背景色，属性background定义表格图片</li>
<li><code>&lt;caption&gt;：定义表格标题</code></li>
<li><code>&lt;th&gt;：定义表格表头</code></li>
<li><code>&lt;tr&gt;：定义表格的行</code></li>
<li><code>&lt;td&gt;：定义表格的单元</code>,属性colspan的值定义了要合并的单元格数目</li>
<li><code>&lt;thead&gt;：定义表格的页眉</code></li>
<li><code>&lt;tbody&gt;：定义表格的主题</code></li>
<li><code>&lt;tfoot&gt;：定义表格的页脚</code></li>
<li><code>&lt;col&gt;：定义表格的列属性</code></li>
</ul>
</li>
</ol>
</li>
<li>列表

<ol>
<li>标签

<ul>
<li><code>&lt;ol&gt;：有序列表</code>，type属性值A,a,I ,i,start</li>
<li><code>&lt;ul&gt;：无序列表</code>，type属性值disc,circle,square</li>
<li><code>&lt;li&gt;：列表项</code></li>
<li><code>&lt;dl&gt;：自定义列表</code></li>
<li><code>&lt;dt&gt;：自定义列表项</code></li>
<li><code>&lt;dd&gt;：自定义列表描述</code></li>
</ul>
</li>
</ol>
</li>
<li>块

<ol>
<li>HTML块元素

<ul>
<li>块元素在显示时，通常会以新行开始，比如<code>&lt;h1&gt;,&lt;p&gt;,&lt;ul&gt;</code></li>
</ul>
</li>
<li>HTML内联元素

<ul>
<li>内联元素通常不会以新行开始，比如<code>&lt;b&gt;,&lt;a&gt;,&lt;img&gt;</code></li>
</ul>
</li>
<li><code>HTML&lt;div&gt;</code>元素

<ul>
<li><code>&lt;div&gt;</code>元素也被称称为块元素，其主要是组合HTML元素的容器</li>
</ul>
</li>
<li><code>HTML&lt;span&gt;</code>元素

<ul>
<li><code>&lt;span&gt;</code>元素是内联元素，可作为文本的容器</li>
</ul>
</li>
</ol>
</li>
<li>使用div元素布局</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>html布局测试<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">body</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">div</span><span class="nf">#page</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">background-color</span><span class="o">:</span> <span class="nb">gray</span><span class="p">;</span>
</span><span class='line'>            <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">height</span><span class="o">:</span> <span class="m">950px</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">div</span><span class="nf">#head</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">background-color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
</span><span class='line'>            <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">height</span><span class="o">:</span> <span class="m">10%</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">div</span><span class="nf">#left</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">background-color</span><span class="o">:</span> <span class="nb">greenyellow</span><span class="p">;</span>
</span><span class='line'>            <span class="k">width</span><span class="o">:</span> <span class="m">20%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">height</span><span class="o">:</span> <span class="m">80%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">div</span><span class="nf">#middle</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">background-color</span><span class="o">:</span> <span class="nb">gray</span><span class="p">;</span>
</span><span class='line'>            <span class="k">width</span><span class="o">:</span> <span class="m">60%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">height</span><span class="o">:</span> <span class="m">80%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">div</span><span class="nf">#right</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">background-color</span><span class="o">:</span> <span class="nb">cornflowerblue</span><span class="p">;</span>
</span><span class='line'>            <span class="k">width</span><span class="o">:</span> <span class="m">20%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">height</span><span class="o">:</span> <span class="m">80%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">div</span><span class="nf">#foot</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">background-color</span><span class="o">:</span> <span class="nb">blue</span><span class="p">;</span>
</span><span class='line'>            <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">height</span><span class="o">:</span> <span class="m">10%</span><span class="p">;</span>
</span><span class='line'>            <span class="k">clear</span><span class="o">:</span> <span class="k">both</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="nt">&lt;/style&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;head&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        head
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;left&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        main_L
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;middle&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        main_M
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;right&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        main_R
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;foot&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        foot
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><p>表单</p>

<ol>
<li>标签

<ul>
<li><code>&lt;form&gt;表单</code>，属性值有action，method</li>
<li><code>&lt;input&gt;输入域</code>，属性type的值有：text，password，checkbox，radio(需要和name属性搭配使用),button(需要和value属性搭配使用),submit(需要和value属性搭配使用)</li>
<li><code>&lt;textarea&gt;文本域</code>，属性有cols,rows</li>
<li><code>&lt;label&gt;控制标签</code></li>
<li><code>&lt;fieldset&gt;定义域</code></li>
<li><code>&lt;legend&gt;域的标题</code></li>
<li><code>&lt;select&gt;选择列表</code></li>
<li><code>&lt;optgroup&gt;选项组</code></li>
<li><code>&lt;option&gt;下拉列表中的选项</code>,需要被<code>&lt;select&gt;</code>包围</li>
<li><code>&lt;button&gt;按钮</code></li>
</ul>
</li>
</ol>
</li>
<li><p>框架</p>

<ol>
<li>框架标签<code>&lt;frame?</code></li>
<li>框架集标签<code>&lt;frameset&gt;</code></li>
<li>常用标签

<ul>
<li>noresize:固定框架大小</li>
<li>cols:列</li>
<li>rows:行</li>
</ul>
</li>
<li>内联框架<code>&lt;iframe&gt;</code>,属性src指名引用的框架路径，属性frameborder指名是否需要边框</li>
</ol>
</li>
<li><p>实体</p>

<ul>
<li>HTML中预留字符串必须被替换成字符实体，如&lt;（小于号），>（大于号）</li>
<li>常用的字符实体

<ul>
<li>空格：&amp;nbsp</li>
<li>小于号：&amp;lt</li>
<li>大于号：&amp;gt</li>
<li>和号：&amp;amp</li>
<li>引号：&amp;quot</li>
<li>撇号：&amp;apos</li>
<li>分：&amp;cent</li>
<li>镑：&amp;pound</li>
<li>元：&amp;yen</li>
<li>欧元：&amp;euro</li>
<li>小节：&amp;sect</li>
<li>版权：&amp;copy</li>
<li>注册商标：&amp;reg</li>
<li>商标：&amp;trade</li>
<li>乘号：&amp;times</li>
<li>除号：&amp;divide</li>
</ul>
</li>
</ul>
</li>
</ol>


<h2>HTML5 Web Storage</h2>

<ol>
<li>Web Storage功能就是在Web上存储数据的功能，这里的储存是针对客户端本地而言的，具体分为两种：

<ul>
<li>sessionStorage：将数据保存在session对象中，session是指用户在浏览某个网站时，从进入网站到浏览器关闭所经过的这段时间，也就是用户浏览这个网站所花费的时间。session对象可以用来保存在这段时间内所要求保存的任何数据</li>
<li>localStorage：将数据保存在客户端本地的硬件设备中，即使浏览器被关闭了，该数据任然存在，下一次打开浏览器访问网站时仍然可以继续使用</li>
</ul>
</li>
</ol>


<figure class='code'><figcaption><span>sessionStorage</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">saveStorage</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="nx">str</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">loadStorage</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>localStorage</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">saveStorage</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="nx">str</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">loadStorage</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>HTML5 本地数据库</h2>

<ol>
<li>HTML5中内置了两种本地数据库，一种为SQLite，一种为indexedDB</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[系统集成项目管理]]></title>
    <link href="http://suda-morris.github.io/blog/2015/09/23/project-manager/"/>
    <updated>2015-09-23T13:23:26+08:00</updated>
    <id>http://suda-morris.github.io/blog/2015/09/23/project-manager</id>
    <content type="html"><![CDATA[<h2>信息系统集成基础知识</h2>

<ol>
<li>信息系统集成是指将计算机软件、硬件、网络通信等技术和产品集成成为能够满足用户特定需求的信息系统，包括总体策划、设计、开发、实施、服务及保障</li>
<li>信息系统集成的<strong>本质</strong>是实现优化的综合统筹设计</li>
<li>信息系统集成要以满足用户需求为<strong>根本出发点</strong></li>
<li>信息系统集成的核心是<strong>软件</strong></li>
<li>信息系统集成是一项综合性的系统工程，<strong>技术</strong>是系统集成工作的的核心，<strong>管理和商务</strong>活动是系统集成项目成功实施的保障</li>
<li>信息系统集成实现的<strong>关键</strong>在于解决各子系统之间的互联和互操作问题</li>
<li>信息系统集成主要分为<strong>设备系统集成</strong>（即硬件系统集成，或弱电系统集成）和<strong>应用系统集成</strong>（也称行业信息化解决方案集成）两大类。设备系统集成又可分为智能建筑系统集成、计算机网络系统集成和安防系统集成</li>
</ol>


<h2>信息系统集成资质管理</h2>

<ol>
<li>信息系统集成的资质是指从事计算机信息系统集成的综合能力，包括技术水平、管理水平、服务水平、质量保证能力、技术装备、系统建设质量、人员构成与素质、经营业绩、资产状况等要素</li>
<li>凡是从事计算机信息系统集成业务的单位，必须经过资质认证并取得《计算机信息系统集成资质证书》</li>
<li>凡是要建设计算机信息系统的单位，应选择具有相应等级《资质证书》的计算机信息系统集成单位来承建计算机信息系统</li>
<li><strong>工业和信息化</strong>部负责计算机信息系统集成资质认证管理工作</li>
<li>计算机信息系统集成资质等级分一、二、三、四级</li>
<li>资质监督管理是指对获证单位资质保持的<strong>监督检查</strong>和<strong>资质变更</strong>的管理</li>
<li>《资质证书》有效期<strong>3年</strong>，获证单位应每年进行一次<strong>自查</strong>（自查时间是每年2月1日至4月30日），并将自查结果报资质认证工作办公室备案；资质认证工作办公室对获证单位每四年进行一次换证检查。</li>
<li>计算机信息系统集成资质认证工作根据<strong>认证和审批分离</strong>的原则，按照先由认证机构认证，再由信息产业主管部门审批的工作程序进行</li>
<li>获证单位应提前做好换证工作准备，最迟应在《资质证书》有效期满<strong>前3个月</strong>，向相应的资质认证工作办公室提出更换证书申请</li>
<li>获证单位原则上在获证<strong>一年以后</strong>如果达到更高级别的资质评定条件，可以像相应的认证机构提出比原资质更高级的升级认证申请</li>
<li>系统集成一、二级资质证书由<strong>工业和信息化部</strong>审批，三、四级由<strong>地方信息产业主管部门</strong>审批，报工业和信息化部备案</li>
<li>计算机信息系统集成企业资质等级评定条件主要从综合条件、财务状况、信誉、业绩、管理能力、技术实力和人才实力7个方面进行考核</li>
<li>企业资质等级评定条件：

<ol>
<li>特一级资质

<ul>
<li>取得一级资质不少于三年</li>
<li>注册资本和实收资本均不少于2亿元</li>
<li>固定资产中电子设备的净值不少于1000万元，无形资产中软件的账面净值不少于1000万元</li>
<li>近三年系统集成年收入均不少于5亿元</li>
</ul>
</li>
<li>一级资质

<ul>
<li>取得二级资质不少于两年</li>
<li>主业是计算机信息系统集成，近三年的系统集成收入总额占营收入总额的比例不低于70%，且近三年系统集成收入总额不少于5亿元</li>
<li>注册资本和实收资本均不少于5000万元</li>
<li>近三年至少完成4个合同额不少于1500万元的系统集成项目</li>
<li>企业的主要负责人从事信息技术领域企业管理的经历不少于5年</li>
<li>从事软件开发与系统集成相关工作的人员不少于220人，其中大学本科以及以上学历人员所占比例不低于80%；具有计算机信息系统集成项目管理人员资质的人数不少于30名，其中高级项目经理人数不少于10名</li>
</ul>
</li>
<li>二级资质

<ul>
<li>取得三级资质不少于一年</li>
<li>主业是计算机信息系统集成，近三年的系统集成收入总额占营收入总额的比例不低于60%，且近三年系统集成收入总额不少于2.5亿元</li>
<li>注册资本和实收资本均不少于2000万元</li>
<li>近三年至少完成3个合同额不少于1000万元的系统集成项目</li>
<li>企业的主要负责人从事信息技术领域企业管理的经历不少于4年</li>
<li>从事软件开发与系统集成相关工作的人员不少于150人，其中大学本科以及以上学历人员所占比例不低于80%；具有计算机信息系统集成项目管理人员资质的人数不少于18名，其中高级项目经理人数不少于4名</li>
</ul>
</li>
<li>三级资质

<ul>
<li>取得四级资质不少于一年</li>
<li>主业是计算机信息系统集成，近三年的系统集成收入总额占营收入总额的比例不低于50%，且近三年系统集成收入总额不少于5000万元</li>
<li>注册资本和实收资本均不少于200万元</li>
<li>近三年至少完成1个合同额不少于300万元的系统集成项目</li>
<li>企业的主要负责人从事信息技术领域企业管理的经历不少于3年</li>
<li>从事软件开发与系统集成相关工作的人员不少于50人，其中大学本科以及以上学历人员所占比例不低于60%；具有计算机信息系统集成项目管理人员资质的人数不少于6名，其中高级项目经理人数不少于1名</li>
</ul>
</li>
<li>四级资质

<ul>
<li>注册资本和实收资本均不少于30万元</li>
<li>企业的主要负责人从事信息技术领域企业管理的经历不少于2年</li>
<li>从事软件开发与系统集成相关工作的人员不少于15人，其中大学本科以及以上学历人员所占比例不低于60%；具有计算机信息系统集成项目管理人员资质的人数不少于2名</li>
</ul>
</li>
</ol>
</li>
<li><strong>中国软件测评中心</strong>和<strong>广州赛宝认证中心服务有限公司</strong>两家评审机构承担<strong>特一级资质</strong>认定的第三方评审工作</li>
<li>一级资质企业获得特一级资质后其拥有的一级资质任然有效，企业必须按照相关规定参与一级资质的年度监督检查和到期换证等工作</li>
<li>项目经理资质管理

<ol>
<li>系统集成项目经理分为项目经理、高级项目经理和资深项目经理3个级别</li>
<li>项目经理

<ol>
<li>需要获得软考证书（系统集成项目管理工程师或者信息系统项目管理师）</li>
<li>至少有两项合同额在200万元以上的系统集成项目</li>
<li>完成系统集成项目总额500万以上</li>
</ol>
</li>
<li>高级项目经理

<ol>
<li>获得项目经理资质不少于3年</li>
<li>至少有一项合同额在1200万元以上的系统集成项目</li>
<li>完成系统集成项目总额3000万以上</li>
</ol>
</li>
<li>资深项目经理

<ol>
<li>获得高级项目经理资质不少于5年</li>
<li>具有硕士以上学位</li>
<li>至少有两项合同额在3000万元以上的系统集成项目或者至少有四项合同额在1500万元以上的系统集成项目</li>
</ol>
</li>
</ol>
</li>
<li><strong>项目经理</strong>可承担合同额在5000万元以下的系统集成项目，<strong>高级项目经理</strong>可承担合同额在5000万以下的系统集成项目，<strong>资深项目经理</strong>可承担各种规模的系统集成项目</li>
<li>系统集成项目经理资质证书有工业和信息化部统一印制</li>
<li>每<strong>两年</strong>对系统集成项目经理资质进行一次<strong>年审</strong>，年审结论分为<strong>合格</strong>、<strong>不合格</strong>、<strong>不在岗</strong>3种</li>
<li>计算机信息系统集成企业资质的三、四级证书应有工业和信息化部印制，由各省市系统集成企业资质主管部门颁发</li>
<li>企业拥有1个信息技术发明专利可等同于3个软件产品登记</li>
</ol>


<h2>信息化概论</h2>
]]></content>
  </entry>
  
</feed>
