
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>WenRis Blog</title>
	<meta name="author" content="suda-morris">

	
	<meta name="description" content="WenRis Blog">
	<meta name="keywords" content="C/C++,Python,Lua">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="WenRis Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">WenRis Blog</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/blog/categories">Categories</a></li>
	<li><a href="/aboutme">About</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/blog/categories">Categories</a></li>
	<li><a href="/aboutme">About</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.baidu.com" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:suda-morris.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/Morris1106com" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/suda-morris" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.baidu.com" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:suda-morris.github.io">
	</form>
</nav>

</header>
	
		
	

	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/06/14/raw-machine-code/">
		
			Raw_machine_code</a>
	</h2>
	<div class="entry-content">
		<h3>把外设的基地址告诉CPU</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x70000000</span>                     <span class="c1">//对于6410来说,内存(0x00000000～0x60000000),外设(0x70000000-0x7fffffff)</span>
</span><span class='line'><span class="n">orr</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x13</span>                     <span class="c1">//外设大小:256M</span>
</span><span class='line'><span class="n">mcr</span> <span class="n">p15</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">r0</span><span class="p">,</span><span class="n">c15</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">4</span>                   <span class="c1">//把r0的值(包括了外设基地址+外设大小)告诉cpu</span>
</span></code></pre></td></tr></table></div></figure>


<h3>关看门狗</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x7E004000</span>
</span><span class='line'><span class="n">mov</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span>
</span><span class='line'><span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>死循环</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="nl">halt</span><span class="p">:</span>
</span><span class='line'>  <span class="n">b</span> <span class="n">halt</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>b与bl都是跳转指令，但是bl会把下一条指令的地址保存到寄存器lr中</p>

<h3>Makefile</h3></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="n">led</span><span class="p">.</span><span class="nl">bin</span> <span class="p">:</span> <span class="n">start</span><span class="p">.</span><span class="n">o</span>
</span><span class='line'>  <span class="n">arm</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">ld</span> <span class="o">-</span><span class="n">Ttext</span> <span class="mi">0</span> <span class="o">-</span><span class="n">o</span> <span class="n">led</span><span class="p">.</span><span class="n">elf</span> <span class="n">start</span><span class="p">.</span><span class="n">o</span>
</span><span class='line'>  <span class="n">arm</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">objcopy</span> <span class="o">-</span><span class="n">O</span> <span class="n">binary</span> <span class="n">led</span><span class="p">.</span><span class="n">elf</span> <span class="n">led</span><span class="p">.</span><span class="n">bin</span>
</span><span class='line'>  <span class="n">arm</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">objdump</span> <span class="o">-</span><span class="n">D</span> <span class="n">led</span><span class="p">.</span><span class="n">elf</span> <span class="o">&gt;</span> <span class="n">led</span><span class="p">.</span><span class="n">dis</span>
</span><span class='line'><span class="n">start</span><span class="p">.</span><span class="nl">o</span> <span class="p">:</span> <span class="n">start</span><span class="p">.</span><span class="n">S</span>
</span><span class='line'>  <span class="n">arm</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gcc</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">O</span> <span class="n">start</span><span class="p">.</span><span class="n">o</span> <span class="n">start</span><span class="p">.</span><span class="n">S</span>
</span><span class='line'><span class="nl">clean</span><span class="p">:</span>
</span><span class='line'>  <span class="n">rm</span> <span class="o">*</span><span class="p">.</span><span class="n">o</span> <span class="n">led</span><span class="p">.</span><span class="n">elf</span> <span class="n">led</span><span class="p">.</span><span class="n">bin</span> <span class="n">led</span><span class="p">.</span><span class="n">dis</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><ol>
<li>6410一上电后，nandflash前8K内容会被硬件原原本本地复制到片内的一个叫stepping stone的区域，该区域被映射到CPU内存地址0处</li>
<li>在ARM中，pc:r15,lr:r14,ip:r12,fp:r11</li>
</ol>
</blockquote>

<h3>CPU时钟设置</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="nl">clock_init</span><span class="p">:</span>
</span><span class='line'>  <span class="c1">// 1. 设置各PLL的LOCK_TIME,使用默认值  </span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x7E00F000</span>                         <span class="c1">// APLL_LOCK，供cpu使用 </span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x0000FFFF</span>
</span><span class='line'>  <span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>                          <span class="c1">// MPLL_LOCK，供AHB(存储/中断/lcd等控制器)/APB(看门狗，定时器，SD等)总线上的设备使用 </span>
</span><span class='line'>  <span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">8</span><span class="p">]</span>                          <span class="c1">// EPLL_LOCK，供UART,IIS,IIC使用 </span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// 2. 设置为异步模式(Asynchronous mode)  </span>
</span><span class='line'><span class="cp">#define OTHERS   0x7E00F900</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="n">OTHERS</span>                              <span class="c1">// OTHERS</span>
</span><span class='line'>                                              <span class="c1">// 《linux installation for u-boot》3.7中：用MPLL作为HCLK和PCLK的Source是异步(ASYNC)模式</span>
</span><span class='line'>                                              <span class="c1">// 用APLL是同步(SYNC)模式</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span><span class='line'>  <span class="n">bic</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc0</span>                           <span class="c1">// bit[6:7]清0,即SYNCMODE=0/SYNCMUXSEL=0</span>
</span><span class='line'>  <span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span><span class='line'><span class="nl">loop</span><span class="p">:</span>          
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x7E00F900</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span><span class='line'>  <span class="n">and</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xf00</span>                  
</span><span class='line'>  <span class="n">cmp</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span>
</span><span class='line'>  <span class="n">bne</span> <span class="n">loop</span>      
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// 3. 设置分频系数  </span>
</span><span class='line'><span class="cp">#define ARM_RATIO    0                           </span><span class="c1">// ARMCLK   = DOUTAPLL / (ARM_RATIO + 1)    = 532/(0+1) = 532  MHz</span>
</span><span class='line'><span class="cp">#define MPLL_RATIO   0                           </span><span class="c1">// DOUTMPLL = MOUTMPLL / (MPLL_RATIO + 1)   = 532/(0+1) = 532  MHz</span>
</span><span class='line'><span class="cp">#define HCLKX2_RATIO 1                           </span><span class="c1">// HCLKX2   = HCLKX2IN / (HCLKX2_RATIO + 1) = 532/(1+1) = 266  MHz</span>
</span><span class='line'><span class="cp">#define HCLK_RATIO   1                           </span><span class="c1">// HCLK     = HCLKX2   / (HCLK_RATIO + 1)   = 266/(1+1) = 133  MHz</span>
</span><span class='line'><span class="cp">#define PCLK_RATIO   3                           </span><span class="c1">// PCLK     = HCLKX2   / (PCLK_RATIO + 1)   = 266/(3+1) = 66.5 MHz</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x7E00F020</span>                         <span class="c1">// CLK_DIV0</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="p">(</span><span class="n">ARM_RATIO</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">MPLL_RATIO</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">HCLK_RATIO</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">HCLKX2_RATIO</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">PCLK_RATIO</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span>
</span><span class='line'>  <span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// 4. 设置PLL,放大时钟  </span>
</span><span class='line'>  <span class="c1">// 4.1 配置APLL  </span>
</span><span class='line'><span class="cp">#define APLL_CON_VAL  ((1&lt;&lt;31) | (266 &lt;&lt; 16) | (3 &lt;&lt; 8) | (1))</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x7E00F00C</span>                         <span class="c1">// APLL_CON</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="n">APLL_CON_VAL</span>                        <span class="c1">// FOUT = MDIV X FIN / (PDIV X 2SDIV) = 266*12/(3*2^1) = 532MHz</span>
</span><span class='line'>  <span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>      
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// 4.2 配置MPLL  </span>
</span><span class='line'><span class="cp">#define MPLL_CON_VAL  ((1&lt;&lt;31) | (266 &lt;&lt; 16) | (3 &lt;&lt; 8) | (1))</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x7E00F010</span>                         <span class="c1">// MPLL_CON</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="n">MPLL_CON_VAL</span>                        <span class="c1">// FOUT = MDIV X FIN / (PDIV X 2SDIV) = 266*12/(3*2^1) = 532MHz</span>
</span><span class='line'>  <span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>      
</span><span class='line'>
</span><span class='line'><span class="cp">#define MPLL_SEL 1</span>
</span><span class='line'><span class="cp">#define APLL_SEL 1   </span>
</span><span class='line'>  <span class="c1">// 5.选择PLL的输出作为时钟源  </span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x7E00F01C</span>                         <span class="c1">// CLK_SRC</span>
</span><span class='line'>  <span class="n">ldr</span> <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="p">(</span><span class="n">MPLL_SEL</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">APLL_SEL</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="n">str</span> <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">mov</span> <span class="n">pc</span><span class="p">,</span> <span class="n">lr</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-06-14T19:39:49+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/s3c6410/'>s3c6410</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/06/13/start-dot-s/">
		
			start.S</a>
	</h2>
	<div class="entry-content">
		<figure class='code'><figcaption><span>start.S</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
<span class='line-number'>421</span>
<span class='line-number'>422</span>
<span class='line-number'>423</span>
<span class='line-number'>424</span>
<span class='line-number'>425</span>
<span class='line-number'>426</span>
<span class='line-number'>427</span>
<span class='line-number'>428</span>
<span class='line-number'>429</span>
<span class='line-number'>430</span>
<span class='line-number'>431</span>
<span class='line-number'>432</span>
<span class='line-number'>433</span>
<span class='line-number'>434</span>
<span class='line-number'>435</span>
<span class='line-number'>436</span>
<span class='line-number'>437</span>
<span class='line-number'>438</span>
<span class='line-number'>439</span>
<span class='line-number'>440</span>
<span class='line-number'>441</span>
<span class='line-number'>442</span>
<span class='line-number'>443</span>
<span class='line-number'>444</span>
<span class='line-number'>445</span>
<span class='line-number'>446</span>
<span class='line-number'>447</span>
<span class='line-number'>448</span>
<span class='line-number'>449</span>
<span class='line-number'>450</span>
<span class='line-number'>451</span>
<span class='line-number'>452</span>
<span class='line-number'>453</span>
<span class='line-number'>454</span>
<span class='line-number'>455</span>
<span class='line-number'>456</span>
<span class='line-number'>457</span>
<span class='line-number'>458</span>
<span class='line-number'>459</span>
<span class='line-number'>460</span>
<span class='line-number'>461</span>
<span class='line-number'>462</span>
<span class='line-number'>463</span>
<span class='line-number'>464</span>
<span class='line-number'>465</span>
<span class='line-number'>466</span>
<span class='line-number'>467</span>
<span class='line-number'>468</span>
<span class='line-number'>469</span>
<span class='line-number'>470</span>
<span class='line-number'>471</span>
<span class='line-number'>472</span>
<span class='line-number'>473</span>
<span class='line-number'>474</span>
<span class='line-number'>475</span>
<span class='line-number'>476</span>
<span class='line-number'>477</span>
<span class='line-number'>478</span>
<span class='line-number'>479</span>
<span class='line-number'>480</span>
<span class='line-number'>481</span>
<span class='line-number'>482</span>
<span class='line-number'>483</span>
<span class='line-number'>484</span>
<span class='line-number'>485</span>
<span class='line-number'>486</span>
<span class='line-number'>487</span>
<span class='line-number'>488</span>
<span class='line-number'>489</span>
<span class='line-number'>490</span>
<span class='line-number'>491</span>
<span class='line-number'>492</span>
<span class='line-number'>493</span>
<span class='line-number'>494</span>
<span class='line-number'>495</span>
<span class='line-number'>496</span>
<span class='line-number'>497</span>
<span class='line-number'>498</span>
<span class='line-number'>499</span>
<span class='line-number'>500</span>
<span class='line-number'>501</span>
<span class='line-number'>502</span>
<span class='line-number'>503</span>
<span class='line-number'>504</span>
<span class='line-number'>505</span>
<span class='line-number'>506</span>
<span class='line-number'>507</span>
<span class='line-number'>508</span>
<span class='line-number'>509</span>
<span class='line-number'>510</span>
<span class='line-number'>511</span>
<span class='line-number'>512</span>
<span class='line-number'>513</span>
<span class='line-number'>514</span>
<span class='line-number'>515</span>
<span class='line-number'>516</span>
<span class='line-number'>517</span>
<span class='line-number'>518</span>
<span class='line-number'>519</span>
<span class='line-number'>520</span>
<span class='line-number'>521</span>
<span class='line-number'>522</span>
<span class='line-number'>523</span>
<span class='line-number'>524</span>
<span class='line-number'>525</span>
<span class='line-number'>526</span>
<span class='line-number'>527</span>
<span class='line-number'>528</span>
<span class='line-number'>529</span>
<span class='line-number'>530</span>
<span class='line-number'>531</span>
<span class='line-number'>532</span>
<span class='line-number'>533</span>
<span class='line-number'>534</span>
<span class='line-number'>535</span>
<span class='line-number'>536</span>
<span class='line-number'>537</span>
<span class='line-number'>538</span>
<span class='line-number'>539</span>
<span class='line-number'>540</span>
<span class='line-number'>541</span>
<span class='line-number'>542</span>
<span class='line-number'>543</span>
<span class='line-number'>544</span>
<span class='line-number'>545</span>
<span class='line-number'>546</span>
<span class='line-number'>547</span>
<span class='line-number'>548</span>
<span class='line-number'>549</span>
<span class='line-number'>550</span>
<span class='line-number'>551</span>
<span class='line-number'>552</span>
<span class='line-number'>553</span>
<span class='line-number'>554</span>
<span class='line-number'>555</span>
<span class='line-number'>556</span>
<span class='line-number'>557</span>
<span class='line-number'>558</span>
<span class='line-number'>559</span>
<span class='line-number'>560</span>
<span class='line-number'>561</span>
<span class='line-number'>562</span>
<span class='line-number'>563</span>
<span class='line-number'>564</span>
<span class='line-number'>565</span>
<span class='line-number'>566</span>
<span class='line-number'>567</span>
<span class='line-number'>568</span>
<span class='line-number'>569</span>
<span class='line-number'>570</span>
<span class='line-number'>571</span>
<span class='line-number'>572</span>
<span class='line-number'>573</span>
<span class='line-number'>574</span>
<span class='line-number'>575</span>
<span class='line-number'>576</span>
<span class='line-number'>577</span>
<span class='line-number'>578</span>
<span class='line-number'>579</span>
<span class='line-number'>580</span>
<span class='line-number'>581</span>
<span class='line-number'>582</span>
<span class='line-number'>583</span>
<span class='line-number'>584</span>
<span class='line-number'>585</span>
<span class='line-number'>586</span>
<span class='line-number'>587</span>
<span class='line-number'>588</span>
<span class='line-number'>589</span>
<span class='line-number'>590</span>
<span class='line-number'>591</span>
<span class='line-number'>592</span>
<span class='line-number'>593</span>
<span class='line-number'>594</span>
<span class='line-number'>595</span>
<span class='line-number'>596</span>
<span class='line-number'>597</span>
<span class='line-number'>598</span>
<span class='line-number'>599</span>
<span class='line-number'>600</span>
<span class='line-number'>601</span>
<span class='line-number'>602</span>
<span class='line-number'>603</span>
<span class='line-number'>604</span>
<span class='line-number'>605</span>
<span class='line-number'>606</span>
<span class='line-number'>607</span>
<span class='line-number'>608</span>
<span class='line-number'>609</span>
<span class='line-number'>610</span>
<span class='line-number'>611</span>
<span class='line-number'>612</span>
<span class='line-number'>613</span>
<span class='line-number'>614</span>
<span class='line-number'>615</span>
<span class='line-number'>616</span>
<span class='line-number'>617</span>
<span class='line-number'>618</span>
<span class='line-number'>619</span>
<span class='line-number'>620</span>
<span class='line-number'>621</span>
<span class='line-number'>622</span>
<span class='line-number'>623</span>
<span class='line-number'>624</span>
<span class='line-number'>625</span>
<span class='line-number'>626</span>
<span class='line-number'>627</span>
<span class='line-number'>628</span>
<span class='line-number'>629</span>
<span class='line-number'>630</span>
<span class='line-number'>631</span>
<span class='line-number'>632</span>
<span class='line-number'>633</span>
<span class='line-number'>634</span>
<span class='line-number'>635</span>
<span class='line-number'>636</span>
<span class='line-number'>637</span>
<span class='line-number'>638</span>
<span class='line-number'>639</span>
<span class='line-number'>640</span>
<span class='line-number'>641</span>
<span class='line-number'>642</span>
<span class='line-number'>643</span>
<span class='line-number'>644</span>
<span class='line-number'>645</span>
<span class='line-number'>646</span>
<span class='line-number'>647</span>
<span class='line-number'>648</span>
<span class='line-number'>649</span>
<span class='line-number'>650</span>
<span class='line-number'>651</span>
<span class='line-number'>652</span>
<span class='line-number'>653</span>
<span class='line-number'>654</span>
<span class='line-number'>655</span>
<span class='line-number'>656</span>
<span class='line-number'>657</span>
<span class='line-number'>658</span>
<span class='line-number'>659</span>
<span class='line-number'>660</span>
<span class='line-number'>661</span>
<span class='line-number'>662</span>
<span class='line-number'>663</span>
<span class='line-number'>664</span>
<span class='line-number'>665</span>
<span class='line-number'>666</span>
<span class='line-number'>667</span>
<span class='line-number'>668</span>
<span class='line-number'>669</span>
<span class='line-number'>670</span>
<span class='line-number'>671</span>
<span class='line-number'>672</span>
<span class='line-number'>673</span>
<span class='line-number'>674</span>
<span class='line-number'>675</span>
<span class='line-number'>676</span>
<span class='line-number'>677</span>
<span class='line-number'>678</span>
<span class='line-number'>679</span>
<span class='line-number'>680</span>
<span class='line-number'>681</span>
<span class='line-number'>682</span>
<span class='line-number'>683</span>
<span class='line-number'>684</span>
<span class='line-number'>685</span>
<span class='line-number'>686</span>
<span class='line-number'>687</span>
<span class='line-number'>688</span>
<span class='line-number'>689</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="cp">#include &lt;config.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;version.h&gt;</span>
</span><span class='line'><span class="cp">#ifdef CONFIG_ENABLE_MMU</span>
</span><span class='line'><span class="cp">#include &lt;asm/proc/domain.h&gt;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="cp">#include &lt;regs.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifndef CONFIG_ENABLE_MMU</span>
</span><span class='line'><span class="cp">#ifndef CFG_PHY_UBOOT_BASE</span>
</span><span class='line'><span class="cp">#define CFG_PHY_UBOOT_BASE   CFG_UBOOT_BASE</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *************************************************************************</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * Jump vector table as in table 3.1 in [1]</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *************************************************************************</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="p">.</span><span class="n">globl</span> <span class="n">_start</span>
</span><span class='line'><span class="nl">_start</span><span class="p">:</span> <span class="n">b</span>   <span class="n">reset</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">_undefined_instruction</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">_software_interrupt</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">_prefetch_abort</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">_data_abort</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">_not_used</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">_irq</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">_fiq</span>
</span><span class='line'>
</span><span class='line'><span class="nl">_undefined_instruction</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">undefined_instruction</span>
</span><span class='line'><span class="nl">_software_interrupt</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">software_interrupt</span>
</span><span class='line'><span class="nl">_prefetch_abort</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">prefetch_abort</span>
</span><span class='line'><span class="nl">_data_abort</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">data_abort</span>
</span><span class='line'><span class="nl">_not_used</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">not_used</span>
</span><span class='line'><span class="nl">_irq</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">irq</span>
</span><span class='line'><span class="nl">_fiq</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">fiq</span>
</span><span class='line'><span class="nl">_pad</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="mh">0x12345678</span> <span class="cm">/* now 16*4=64 */</span>
</span><span class='line'><span class="p">.</span><span class="n">global</span> <span class="n">_end_vect</span>
</span><span class='line'><span class="nl">_end_vect</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">balignl</span> <span class="mi">16</span><span class="p">,</span><span class="mh">0xdeadbeef</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *************************************************************************</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * Startup Code (reset vector)</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * do important init only if we don&#39;t start from memory!</span>
</span><span class='line'><span class="cm"> * setup Memory and board specific bits prior to relocation.</span>
</span><span class='line'><span class="cm"> * relocate armboot to ram</span>
</span><span class='line'><span class="cm"> * setup stack</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *************************************************************************</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="nl">_TEXT_BASE</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">TEXT_BASE</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Below variable is very important because we use MMU in U-Boot.</span>
</span><span class='line'><span class="cm"> * Without it, we cannot run code correctly before MMU is ON.</span>
</span><span class='line'><span class="cm"> * by scsuh.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nl">_TEXT_PHY_BASE</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">CFG_PHY_UBOOT_BASE</span>
</span><span class='line'>
</span><span class='line'><span class="p">.</span><span class="n">globl</span> <span class="n">_armboot_start</span>
</span><span class='line'><span class="nl">_armboot_start</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">_start</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * These are defined in the board-specific linker script.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="p">.</span><span class="n">globl</span> <span class="n">_bss_start</span>
</span><span class='line'><span class="nl">_bss_start</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">__bss_start</span>
</span><span class='line'>
</span><span class='line'><span class="p">.</span><span class="n">globl</span> <span class="n">_bss_end</span>
</span><span class='line'><span class="nl">_bss_end</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">_end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_USE_IRQ</span>
</span><span class='line'><span class="cm">/* IRQ stack memory (calculated at run-time) */</span>
</span><span class='line'><span class="p">.</span><span class="n">globl</span> <span class="n">IRQ_STACK_START</span>
</span><span class='line'><span class="nl">IRQ_STACK_START</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="mh">0x0badc0de</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* IRQ stack memory (calculated at run-time) */</span>
</span><span class='line'><span class="p">.</span><span class="n">globl</span> <span class="n">FIQ_STACK_START</span>
</span><span class='line'><span class="nl">FIQ_STACK_START</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="mh">0x0badc0de</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * the actual reset code</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="nl">reset</span><span class="p">:</span>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">  * set the cpu to SVC32 mode</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="n">mrs</span>  <span class="n">r0</span><span class="p">,</span><span class="n">cpsr</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r0</span><span class="p">,</span><span class="n">r0</span><span class="p">,</span><span class="err">#</span><span class="mh">0x1f</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span><span class="n">r0</span><span class="p">,</span><span class="err">#</span><span class="mh">0xd3</span>
</span><span class='line'>  <span class="n">msr</span>  <span class="n">cpsr</span><span class="p">,</span><span class="n">r0</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *************************************************************************</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * CPU_init_critical registers</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * setup important registers</span>
</span><span class='line'><span class="cm"> * setup memory timing</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *************************************************************************</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>         <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * we do sys-critical inits only at reboot,</span>
</span><span class='line'><span class="cm">         * not when booting from ram!</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'><span class="nl">cpu_init_crit</span><span class="p">:</span>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">  * flush v4 I/D caches</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span>
</span><span class='line'>  <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="mi">0</span>    <span class="cm">/* flush v3/v4 cache */</span>
</span><span class='line'>  <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c8</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="mi">0</span>    <span class="cm">/* flush v4 TLB */</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">  * disable MMU stuff and caches</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="n">mrc</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00002300</span>    <span class="err">@</span> <span class="n">clear</span> <span class="n">bits</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">9</span><span class="o">:</span><span class="mi">8</span> <span class="p">(</span><span class="o">--</span><span class="n">V</span><span class="o">-</span> <span class="o">--</span><span class="n">RS</span><span class="p">)</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00000087</span>    <span class="err">@</span> <span class="n">clear</span> <span class="n">bits</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="mi">0</span> <span class="p">(</span><span class="n">B</span><span class="o">---</span> <span class="o">-</span><span class="n">CAM</span><span class="p">)</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00000002</span>    <span class="err">@</span> <span class="n">set</span> <span class="n">bit</span> <span class="mi">2</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="n">Align</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00001000</span>    <span class="err">@</span> <span class="n">set</span> <span class="n">bit</span> <span class="mi">12</span> <span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="n">I</span><span class="o">-</span><span class="n">Cache</span>
</span><span class='line'>  <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Peri port setup */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x70000000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x13</span>
</span><span class='line'>    <span class="n">mcr</span>    <span class="n">p15</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">r0</span><span class="p">,</span><span class="n">c15</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">4</span>       <span class="err">@</span> <span class="mi">256</span><span class="n">M</span><span class="p">(</span><span class="mh">0x70000000</span><span class="o">-</span><span class="mh">0x7fffffff</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_BOOT_ONENAND</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x70000000</span>        <span class="err">@</span> <span class="n">onenand</span> <span class="n">controller</span> <span class="n">setup</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x100000</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x4000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xe0</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#if defined(CONFIG_S3C6410) || defined(CONFIG_S3C6430)</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">300</span>       <span class="err">@</span> <span class="n">disable</span> <span class="n">watchdog</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mi">1</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x23000000</span>      <span class="err">@</span> <span class="n">start</span> <span class="n">buffer</span> <span class="k">register</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x30000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc800</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x20000000</span>        <span class="err">@</span> <span class="n">start</span> <span class="n">buffer</span> <span class="k">register</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc30000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc800</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0400</span>        <span class="err">@</span> <span class="n">start</span> <span class="n">address1</span> <span class="k">register</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x84</span><span class="p">]</span>      <span class="err">@</span> <span class="n">ecc</span> <span class="n">bypass</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x100</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x84</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0</span>     <span class="err">@</span> <span class="n">DFS</span><span class="p">,</span> <span class="n">FBA</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00</span><span class="p">]</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x04</span><span class="p">]</span>      <span class="err">@</span> <span class="n">select</span> <span class="n">dataram</span> <span class="k">for</span> <span class="n">DDP</span> <span class="n">as</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r4</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x104</span>       <span class="err">@</span> <span class="n">interrupt</span> <span class="k">register</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r5</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0002</span>      <span class="err">@</span> <span class="n">FPA</span><span class="p">,</span> <span class="n">FSA</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r6</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0800</span>      <span class="err">@</span> <span class="n">BSA</span>
</span><span class='line'>
</span><span class='line'><span class="nl">onenand_bl1_load</span><span class="p">:</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r5</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1c</span><span class="p">]</span>      <span class="err">@</span> <span class="n">save</span> <span class="n">FPA</span><span class="p">,</span> <span class="n">FSA</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r6</span><span class="p">,</span> <span class="n">r6</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x02</span>      <span class="err">@</span> <span class="n">BSC</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r6</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00</span><span class="p">]</span>      <span class="err">@</span> <span class="n">save</span> <span class="n">BSA</span><span class="p">,</span> <span class="n">BSC</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="n">r4</span><span class="p">]</span>       <span class="err">@</span> <span class="n">clear</span> <span class="n">interrupt</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x80</span><span class="p">]</span>      <span class="err">@</span> <span class="n">write</span> <span class="n">load</span> <span class="n">command</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x100</span>       <span class="err">@</span> <span class="n">need</span> <span class="n">small</span> <span class="n">delay</span>
</span><span class='line'>
</span><span class='line'><span class="nl">onenand_wait_loop1</span><span class="p">:</span>
</span><span class='line'>  <span class="n">subs</span> <span class="n">r7</span><span class="p">,</span> <span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="n">onenand_wait_loop1</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r5</span><span class="p">,</span> <span class="n">r5</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x2</span>       <span class="err">@</span> <span class="n">next</span> <span class="n">FPA</span><span class="p">,</span> <span class="n">FSA</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r6</span><span class="p">,</span> <span class="n">r6</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x2</span>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r6</span><span class="p">,</span> <span class="n">r6</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x200</span>     <span class="err">@</span> <span class="n">next</span> <span class="n">BSA</span>
</span><span class='line'>  <span class="n">cmp</span>  <span class="n">r5</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x8</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="n">onenand_bl1_load</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">  * Go setup Memory and board specific bits prior to relocation.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">lowlevel_init</span>    <span class="cm">/* go setup pll,mux,memory */</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* when we already run in ram, we don&#39;t need to relocate U-Boot.</span>
</span><span class='line'><span class="cm">  * and actually, memory controller must be configured before U-Boot</span>
</span><span class='line'><span class="cm">  * is running in ram.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0xff000fff</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">pc</span><span class="p">,</span> <span class="n">r0</span>       <span class="cm">/* r0 &lt;- current base addr of code */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">_TEXT_BASE</span>     <span class="cm">/* r1 &lt;- original base addr in ram */</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r0</span>       <span class="cm">/* r0 &lt;- current base addr of code */</span>
</span><span class='line'>  <span class="n">cmp</span>     <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span>                  <span class="cm">/* compare r0, r1                  */</span>
</span><span class='line'>  <span class="n">beq</span>     <span class="n">after_copy</span>        <span class="cm">/* r0 == r1 then skip flash copy   */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_BOOT_NOR           </span><span class="cm">/* relocate U-Boot to RAM */</span><span class="cp"></span>
</span><span class='line'>  <span class="n">adr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">_start</span>     <span class="cm">/* r0 &lt;- current position of code   */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">_TEXT_PHY_BASE</span> <span class="cm">/* r1 &lt;- destination                */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">_armboot_start</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r3</span><span class="p">,</span> <span class="n">_bss_start</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="n">r2</span>       <span class="cm">/* r2 &lt;- size of armboot            */</span>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r2</span>       <span class="cm">/* r2 &lt;- source end address         */</span>
</span><span class='line'>
</span><span class='line'><span class="nl">nor_copy_loop</span><span class="p">:</span>
</span><span class='line'>  <span class="n">ldmia</span>    <span class="n">r0</span><span class="o">!</span><span class="p">,</span> <span class="p">{</span><span class="n">r3</span><span class="o">-</span><span class="n">r10</span><span class="p">}</span>       <span class="cm">/* copy from source address [r0]    */</span>
</span><span class='line'>  <span class="n">stmia</span>    <span class="n">r1</span><span class="o">!</span><span class="p">,</span> <span class="p">{</span><span class="n">r3</span><span class="o">-</span><span class="n">r10</span><span class="p">}</span>       <span class="cm">/* copy to   target address [r1]    */</span>
</span><span class='line'>  <span class="n">cmp</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r2</span>         <span class="cm">/* until source end addreee [r2]    */</span>
</span><span class='line'>  <span class="n">ble</span>  <span class="n">nor_copy_loop</span>
</span><span class='line'>  <span class="n">b</span>    <span class="n">after_copy</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_BOOT_NAND</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1000</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">copy_from_nand</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_BOOT_MOVINAND</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">_TEXT_PHY_BASE</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">movi_bl2_copy</span>
</span><span class='line'>  <span class="n">b</span>    <span class="n">after_copy</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_BOOT_ONENAND</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">sp</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x50000000</span>        <span class="err">@</span> <span class="n">temporary</span> <span class="n">stack</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_S3C6400</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x20000000</span>        <span class="err">@</span> <span class="n">start</span> <span class="n">buffer</span> <span class="k">register</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc30000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc800</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x23000000</span>      <span class="err">@</span> <span class="n">start</span> <span class="n">buffer</span> <span class="k">register</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x30000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc800</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x84</span><span class="p">]</span>      <span class="err">@</span> <span class="n">ecc</span> <span class="n">bypass</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x100</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x84</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0400</span>        <span class="err">@</span> <span class="n">start</span> <span class="n">address1</span> <span class="k">register</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00</span><span class="p">]</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x04</span><span class="p">]</span>      <span class="err">@</span> <span class="n">select</span> <span class="n">dataram</span> <span class="k">for</span> <span class="n">DDP</span> <span class="n">as</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r4</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x104</span>       <span class="err">@</span> <span class="n">interrupt</span> <span class="k">register</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r6</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0c00</span>      <span class="err">@</span> <span class="n">fixed</span> <span class="n">dataram1</span> <span class="n">sector</span> <span class="n">number</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r6</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0</span>     <span class="err">@</span> <span class="n">DFS</span><span class="p">,</span> <span class="n">FBA</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r5</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0000</span>      <span class="err">@</span> <span class="n">FPA</span><span class="p">,</span> <span class="n">FSA</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r9</span><span class="p">,</span> <span class="o">=</span><span class="n">CFG_PHY_UBOOT_BASE</span> <span class="err">@</span> <span class="n">destination</span>
</span><span class='line'>
</span><span class='line'><span class="nl">onenand_bl2_load</span><span class="p">:</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00</span><span class="p">]</span>      <span class="err">@</span> <span class="n">save</span> <span class="n">DFS</span><span class="p">,</span> <span class="n">FBA</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r5</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1c</span><span class="p">]</span>      <span class="err">@</span> <span class="n">save</span> <span class="n">FPA</span><span class="p">,</span> <span class="n">FSA</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0</span>     <span class="err">@</span> <span class="n">clear</span> <span class="n">interrupt</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r7</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="n">r4</span><span class="p">]</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r7</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x80</span><span class="p">]</span>      <span class="err">@</span> <span class="n">write</span> <span class="n">load</span> <span class="n">command</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r8</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1000</span>
</span><span class='line'><span class="nl">onenand_wait_loop2</span><span class="p">:</span>
</span><span class='line'>  <span class="n">subs</span> <span class="n">r8</span><span class="p">,</span> <span class="n">r8</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="n">onenand_wait_loop2</span>
</span><span class='line'>
</span><span class='line'><span class="nl">onenand_wait_int</span><span class="p">:</span>          <span class="err">@</span> <span class="n">wait</span> <span class="n">INT</span> <span class="n">and</span> <span class="n">RI</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r7</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="n">r4</span><span class="p">]</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r8</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x8000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r8</span><span class="p">,</span> <span class="n">r8</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x80</span>
</span><span class='line'>  <span class="n">tst</span>  <span class="n">r7</span><span class="p">,</span> <span class="n">r8</span>
</span><span class='line'>  <span class="n">beq</span>  <span class="n">onenand_wait_int</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0</span>     <span class="err">@</span> <span class="n">clear</span> <span class="n">interrupt</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r7</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="n">r4</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r8</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc00</span>       <span class="err">@</span> <span class="n">source</span> <span class="n">address</span> <span class="p">(</span><span class="n">dataram1</span><span class="p">)</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r10</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x40</span>       <span class="err">@</span> <span class="n">copy</span> <span class="n">loop</span> <span class="n">count</span> <span class="p">(</span><span class="mi">64</span> <span class="o">=</span> <span class="mi">2048</span> <span class="o">/</span> <span class="mi">32</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">stmia</span>    <span class="n">sp</span><span class="p">,</span> <span class="p">{</span><span class="n">r0</span><span class="o">-</span><span class="n">r7</span><span class="p">}</span>        <span class="err">@</span> <span class="n">backup</span>
</span><span class='line'>
</span><span class='line'><span class="nl">onenand_copy_to_ram</span><span class="p">:</span>
</span><span class='line'>  <span class="n">ldmia</span>    <span class="n">r8</span><span class="o">!</span><span class="p">,</span> <span class="p">{</span><span class="n">r0</span><span class="o">-</span><span class="n">r7</span><span class="p">}</span>
</span><span class='line'>  <span class="n">stmia</span>    <span class="n">r9</span><span class="o">!</span><span class="p">,</span> <span class="p">{</span><span class="n">r0</span><span class="o">-</span><span class="n">r7</span><span class="p">}</span>
</span><span class='line'>  <span class="n">subs</span> <span class="n">r10</span><span class="p">,</span> <span class="n">r10</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="n">onenand_copy_to_ram</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ldmia</span>    <span class="n">sp</span><span class="p">,</span> <span class="p">{</span><span class="n">r0</span><span class="o">-</span><span class="n">r7</span><span class="p">}</span>        <span class="err">@</span> <span class="n">restore</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r5</span><span class="p">,</span> <span class="n">r5</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x4</span>       <span class="err">@</span> <span class="n">next</span> <span class="n">FPA</span>
</span><span class='line'>  <span class="n">cmp</span>  <span class="n">r5</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x100</span>       <span class="err">@</span> <span class="n">last</span> <span class="n">FPA</span><span class="o">?</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="n">onenand_bl2_load</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* next block */</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r5</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0</span>     <span class="err">@</span> <span class="n">reset</span> <span class="n">FPA</span>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r3</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1</span>       <span class="err">@</span> <span class="n">next</span> <span class="n">FBA</span>
</span><span class='line'>  <span class="n">cmp</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x2</span>     <span class="err">@</span> <span class="n">last</span> <span class="n">FBA</span><span class="o">?</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="n">onenand_bl2_load</span>
</span><span class='line'>  <span class="n">b</span>    <span class="n">after_copy</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_BOOT_ONENAND_IROM</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">_TEXT_PHY_BASE</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">onenand_bl2_copy</span>
</span><span class='line'>  <span class="n">b</span>    <span class="n">after_copy</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="nl">after_copy</span><span class="p">:</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="n">ELFIN_GPIO_BASE</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="mh">0xC00</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">GPPDAT_OFFSET</span><span class="p">]</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">GPFPUD_OFFSET</span><span class="p">]</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc0000000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x80000000</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">GPFPUD_OFFSET</span><span class="p">]</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">GPFDAT_OFFSET</span><span class="p">]</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x8000</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">GPFDAT_OFFSET</span><span class="p">]</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">GPFCON_OFFSET</span><span class="p">]</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0xc0000000</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x40000000</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">GPFCON_OFFSET</span><span class="p">]</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'><span class="cp">#ifdef CONFIG_ENABLE_MMU</span>
</span><span class='line'><span class="nl">enable_mmu</span><span class="p">:</span>
</span><span class='line'>  <span class="cm">/* enable domain access */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r5</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x0000ffff</span>
</span><span class='line'>  <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r5</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">0</span>        <span class="err">@</span> <span class="n">load</span> <span class="n">domain</span> <span class="n">access</span> <span class="k">register</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Set the TTB register */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">_mmu_table_base</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="o">=</span><span class="n">CFG_PHY_UBOOT_BASE</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r2</span><span class="p">,</span> <span class="o">=</span><span class="mh">0xfff00000</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r2</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span>
</span><span class='line'>  <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Enable the MMU */</span>
</span><span class='line'><span class="nl">mmu_on</span><span class="p">:</span>
</span><span class='line'>  <span class="n">mrc</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">1</span>         <span class="cm">/* Set CR_M to enable MMU */</span>
</span><span class='line'>  <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">nop</span>
</span><span class='line'>  <span class="n">nop</span>
</span><span class='line'>  <span class="n">nop</span>
</span><span class='line'>  <span class="n">nop</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="nl">skip_hw_init</span><span class="p">:</span>
</span><span class='line'>  <span class="cm">/* Set up the stack                            */</span>
</span><span class='line'><span class="nl">stack_setup</span><span class="p">:</span>
</span><span class='line'><span class="cp">#ifdef CONFIG_MEMORY_UPPER_CODE</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">sp</span><span class="p">,</span> <span class="o">=</span><span class="p">(</span><span class="n">CFG_UBOOT_BASE</span> <span class="o">+</span> <span class="n">CFG_UBOOT_SIZE</span> <span class="o">-</span> <span class="mh">0xc</span><span class="p">)</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">_TEXT_BASE</span>     <span class="cm">/* upper 128 KiB: relocated uboot   */</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">CFG_MALLOC_LEN</span> <span class="cm">/* malloc area                      */</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="n">CFG_GBL_DATA_SIZE</span> <span class="cm">/* bdinfo                        */</span>
</span><span class='line'><span class="cp">#ifdef CONFIG_USE_IRQ</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="p">(</span><span class="n">CONFIG_STACKSIZE_IRQ</span><span class="o">+</span><span class="n">CONFIG_STACKSIZE_FIQ</span><span class="p">)</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">12</span>        <span class="cm">/* leave 3 words for abort-stack    */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="nl">clear_bss</span><span class="p">:</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">_bss_start</span>     <span class="cm">/* find start of bss segment        */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">_bss_end</span>       <span class="cm">/* stop here                        */</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r2</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00000000</span>      <span class="cm">/* clear                            */</span>
</span><span class='line'>
</span><span class='line'><span class="nl">clbss_l</span><span class="p">:</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>     <span class="cm">/* clear loop...                    */</span>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span>
</span><span class='line'>  <span class="n">cmp</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span>
</span><span class='line'>  <span class="n">ble</span>  <span class="n">clbss_l</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">_start_armboot</span>
</span><span class='line'>
</span><span class='line'><span class="nl">_start_armboot</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">start_armboot</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_ENABLE_MMU</span>
</span><span class='line'><span class="nl">_mmu_table_base</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">mmu_table</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * copy U-Boot to SDRAM and jump to ram (from NAND or OneNAND)</span>
</span><span class='line'><span class="cm"> * r0: size to be compared</span>
</span><span class='line'><span class="cm"> * Load 1&#39;st 2blocks to RAM because U-boot&#39;s size is larger than 1block(128k) size</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>  <span class="p">.</span><span class="n">globl</span> <span class="n">copy_from_nand</span>
</span><span class='line'><span class="nl">copy_from_nand</span><span class="p">:</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r10</span><span class="p">,</span> <span class="n">lr</span>        <span class="cm">/* save return address */</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r9</span><span class="p">,</span> <span class="n">r0</span>
</span><span class='line'>  <span class="cm">/* get ready to call C functions */</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">_TEXT_PHY_BASE</span> <span class="cm">/* setup temp stack pointer */</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="mi">12</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span>           <span class="cm">/* no previous frame, so fp=0 */</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r9</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x1000</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">copy_uboot_to_ram</span>
</span><span class='line'>
</span><span class='line'><span class="mi">3</span><span class="o">:</span> <span class="n">tst</span>  <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="n">copy_failed</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="o">=</span><span class="mh">0x0c000000</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">_TEXT_PHY_BASE</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">ldr</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">],</span> <span class="err">#</span><span class="mi">4</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r4</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">],</span> <span class="err">#</span><span class="mi">4</span>
</span><span class='line'>  <span class="n">teq</span>  <span class="n">r3</span><span class="p">,</span> <span class="n">r4</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="n">compare_failed</span>   <span class="cm">/* not matched */</span>
</span><span class='line'>  <span class="n">subs</span> <span class="n">r9</span><span class="p">,</span> <span class="n">r9</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span>
</span><span class='line'>  <span class="n">bne</span>  <span class="mi">1</span><span class="n">b</span>
</span><span class='line'>
</span><span class='line'><span class="mi">4</span><span class="o">:</span> <span class="n">mov</span>  <span class="n">lr</span><span class="p">,</span> <span class="n">r10</span>        <span class="cm">/* all is OK */</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">lr</span>
</span><span class='line'>
</span><span class='line'><span class="nl">copy_failed</span><span class="p">:</span>
</span><span class='line'>  <span class="n">nop</span>          <span class="cm">/* copy from nand failed */</span>
</span><span class='line'>  <span class="n">b</span>    <span class="n">copy_failed</span>
</span><span class='line'>
</span><span class='line'><span class="nl">compare_failed</span><span class="p">:</span>
</span><span class='line'>  <span class="n">nop</span>          <span class="cm">/* compare failed */</span>
</span><span class='line'>  <span class="n">b</span>    <span class="n">compare_failed</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * we assume that cache operation is done before. (eg. cleanup_before_linux())</span>
</span><span class='line'><span class="cm"> * actually, we don&#39;t need to do anything about cache if not use d-cache in U-Boot</span>
</span><span class='line'><span class="cm"> * So, in this function we clean only MMU. by scsuh</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * void  theLastJump(void *kernel, int arch_num, uint boot_params);</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#ifdef CONFIG_ENABLE_MMU</span>
</span><span class='line'>  <span class="p">.</span><span class="n">globl</span> <span class="n">theLastJump</span>
</span><span class='line'><span class="nl">theLastJump</span><span class="p">:</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r9</span><span class="p">,</span> <span class="n">r0</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r3</span><span class="p">,</span> <span class="o">=</span><span class="mh">0xfff00000</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r4</span><span class="p">,</span> <span class="n">_TEXT_PHY_BASE</span>
</span><span class='line'>  <span class="n">adr</span>  <span class="n">r5</span><span class="p">,</span> <span class="n">phy_last_jump</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r5</span><span class="p">,</span> <span class="n">r5</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r5</span><span class="p">,</span> <span class="n">r5</span><span class="p">,</span> <span class="n">r4</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">r5</span>
</span><span class='line'><span class="nl">phy_last_jump</span><span class="p">:</span>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">  * disable MMU stuff</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="n">mrc</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00002300</span>    <span class="cm">/* clear bits 13, 9:8 (--V- --RS) */</span>
</span><span class='line'>  <span class="n">bic</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00000087</span>    <span class="cm">/* clear bits 7, 2:0 (B--- -CAM) */</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00000002</span>    <span class="cm">/* set bit 2 (A) Align */</span>
</span><span class='line'>  <span class="n">orr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x00001000</span>    <span class="cm">/* set bit 12 (I) I-Cache */</span>
</span><span class='line'>  <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">c8</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="mi">0</span>    <span class="cm">/* flush v4 TLB */</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">r9</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *************************************************************************</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * Interrupt handling</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *************************************************************************</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="err">@</span>
</span><span class='line'><span class="err">@</span> <span class="n">IRQ</span> <span class="n">stack</span> <span class="n">frame</span><span class="p">.</span>
</span><span class='line'><span class="err">@</span>
</span><span class='line'><span class="cp">#define S_FRAME_SIZE 72</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define S_OLD_R0 68</span>
</span><span class='line'><span class="cp">#define S_PSR        64</span>
</span><span class='line'><span class="cp">#define S_PC     60</span>
</span><span class='line'><span class="cp">#define S_LR     56</span>
</span><span class='line'><span class="cp">#define S_SP     52</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define S_IP     48</span>
</span><span class='line'><span class="cp">#define S_FP     44</span>
</span><span class='line'><span class="cp">#define S_R10        40</span>
</span><span class='line'><span class="cp">#define S_R9     36</span>
</span><span class='line'><span class="cp">#define S_R8     32</span>
</span><span class='line'><span class="cp">#define S_R7     28</span>
</span><span class='line'><span class="cp">#define S_R6     24</span>
</span><span class='line'><span class="cp">#define S_R5     20</span>
</span><span class='line'><span class="cp">#define S_R4     16</span>
</span><span class='line'><span class="cp">#define S_R3     12</span>
</span><span class='line'><span class="cp">#define S_R2     8</span>
</span><span class='line'><span class="cp">#define S_R1     4</span>
</span><span class='line'><span class="cp">#define S_R0     0</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define MODE_SVC 0x13</span>
</span><span class='line'><span class="cp">#define I_BIT     0x80</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * use bad_save_user_regs for abort/prefetch/undef/swi ...</span>
</span><span class='line'><span class="cm"> * use irq_save_user_regs / irq_restore_user_regs for IRQ/FIQ handling</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">macro</span>    <span class="n">bad_save_user_regs</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="n">S_FRAME_SIZE</span>       <span class="err">@</span> <span class="n">carve</span> <span class="n">out</span> <span class="n">a</span> <span class="n">frame</span> <span class="n">on</span> <span class="n">current</span> <span class="n">user</span> <span class="n">stack</span>
</span><span class='line'>  <span class="n">stmia</span>    <span class="n">sp</span><span class="p">,</span> <span class="p">{</span><span class="n">r0</span> <span class="o">-</span> <span class="n">r12</span><span class="p">}</span>         <span class="err">@</span> <span class="n">Save</span> <span class="n">user</span> <span class="n">registers</span> <span class="p">(</span><span class="n">now</span> <span class="n">in</span> <span class="n">svc</span> <span class="n">mode</span><span class="p">)</span> <span class="n">r0</span><span class="o">-</span><span class="n">r12</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">_armboot_start</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="err">#</span><span class="p">(</span><span class="n">CFG_MALLOC_LEN</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="err">#</span><span class="p">(</span><span class="n">CFG_GBL_DATA_SIZE</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="err">@</span> <span class="n">set</span> <span class="n">base</span> <span class="mi">2</span> <span class="n">words</span> <span class="n">into</span> <span class="n">abort</span> <span class="n">stack</span>
</span><span class='line'>  <span class="n">ldmia</span>    <span class="n">r2</span><span class="p">,</span> <span class="p">{</span><span class="n">r2</span> <span class="o">-</span> <span class="n">r3</span><span class="p">}</span>          <span class="err">@</span> <span class="n">get</span> <span class="n">values</span> <span class="k">for</span> <span class="s">&quot;aborted&quot;</span> <span class="n">pc</span> <span class="n">and</span> <span class="n">cpsr</span> <span class="p">(</span><span class="n">into</span> <span class="n">parm</span> <span class="n">regs</span><span class="p">)</span>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="n">S_FRAME_SIZE</span>       <span class="err">@</span> <span class="n">grab</span> <span class="n">pointer</span> <span class="n">to</span> <span class="n">old</span> <span class="n">stack</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r5</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="n">S_SP</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">lr</span>
</span><span class='line'>  <span class="n">stmia</span>    <span class="n">r5</span><span class="p">,</span> <span class="p">{</span><span class="n">r0</span> <span class="o">-</span> <span class="n">r3</span><span class="p">}</span>          <span class="err">@</span> <span class="n">save</span> <span class="n">sp_SVC</span><span class="p">,</span> <span class="n">lr_SVC</span><span class="p">,</span> <span class="n">pc</span><span class="p">,</span> <span class="n">cpsr</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">sp</span>             <span class="err">@</span> <span class="n">save</span> <span class="n">current</span> <span class="n">stack</span> <span class="n">into</span> <span class="n">r0</span> <span class="p">(</span><span class="n">param</span> <span class="k">register</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="n">endm</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">macro</span>    <span class="n">irq_save_user_regs</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="n">S_FRAME_SIZE</span>
</span><span class='line'>  <span class="n">stmia</span>    <span class="n">sp</span><span class="p">,</span> <span class="p">{</span><span class="n">r0</span> <span class="o">-</span> <span class="n">r12</span><span class="p">}</span>         <span class="err">@</span> <span class="n">Calling</span> <span class="n">r0</span><span class="o">-</span><span class="n">r12</span>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r8</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="n">S_PC</span>           <span class="err">@</span> <span class="o">!!!!</span> <span class="n">R8</span> <span class="n">NEEDS</span> <span class="n">to</span> <span class="n">be</span> <span class="n">saved</span> <span class="o">!!!!</span> <span class="n">a</span> <span class="n">reserved</span> <span class="n">stack</span> <span class="n">spot</span> <span class="n">would</span> <span class="n">be</span> <span class="n">good</span><span class="p">.</span>
</span><span class='line'>  <span class="n">stmdb</span>    <span class="n">r8</span><span class="p">,</span> <span class="p">{</span><span class="n">sp</span><span class="p">,</span> <span class="n">lr</span><span class="p">}</span><span class="o">^</span>           <span class="err">@</span> <span class="n">Calling</span> <span class="n">SP</span><span class="p">,</span> <span class="n">LR</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">lr</span><span class="p">,</span> <span class="p">[</span><span class="n">r8</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>         <span class="err">@</span> <span class="n">Save</span> <span class="n">calling</span> <span class="n">PC</span>
</span><span class='line'>  <span class="n">mrs</span>  <span class="n">r6</span><span class="p">,</span> <span class="n">spsr</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r6</span><span class="p">,</span> <span class="p">[</span><span class="n">r8</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>         <span class="err">@</span> <span class="n">Save</span> <span class="n">CPSR</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r0</span><span class="p">,</span> <span class="p">[</span><span class="n">r8</span><span class="p">,</span> <span class="err">#</span><span class="mi">8</span><span class="p">]</span>         <span class="err">@</span> <span class="n">Save</span> <span class="n">OLD_R0</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">sp</span>
</span><span class='line'>  <span class="p">.</span><span class="n">endm</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">macro</span>    <span class="n">irq_restore_user_regs</span>
</span><span class='line'>  <span class="n">ldmia</span>    <span class="n">sp</span><span class="p">,</span> <span class="p">{</span><span class="n">r0</span> <span class="o">-</span> <span class="n">lr</span><span class="p">}</span><span class="o">^</span>          <span class="err">@</span> <span class="n">Calling</span> <span class="n">r0</span> <span class="o">-</span> <span class="n">lr</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">lr</span><span class="p">,</span> <span class="p">[</span><span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="n">S_PC</span><span class="p">]</span>           <span class="err">@</span> <span class="n">Get</span> <span class="n">PC</span>
</span><span class='line'>  <span class="n">add</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="n">S_FRAME_SIZE</span>
</span><span class='line'>  <span class="n">subs</span> <span class="n">pc</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span>         <span class="err">@</span> <span class="k">return</span> <span class="o">&amp;</span> <span class="n">move</span> <span class="n">spsr_svc</span> <span class="n">into</span> <span class="n">cpsr</span>
</span><span class='line'>  <span class="p">.</span><span class="n">endm</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">macro</span> <span class="n">get_bad_stack</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r13</span><span class="p">,</span> <span class="n">_armboot_start</span>        <span class="err">@</span> <span class="n">setup</span> <span class="n">our</span> <span class="n">mode</span> <span class="n">stack</span> <span class="p">(</span><span class="n">enter</span> <span class="n">in</span> <span class="n">banked</span> <span class="n">mode</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r13</span><span class="p">,</span> <span class="n">r13</span><span class="p">,</span> <span class="err">#</span><span class="p">(</span><span class="n">CFG_MALLOC_LEN</span><span class="p">)</span>   <span class="err">@</span> <span class="n">move</span> <span class="n">past</span> <span class="n">malloc</span> <span class="n">pool</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r13</span><span class="p">,</span> <span class="n">r13</span><span class="p">,</span> <span class="err">#</span><span class="p">(</span><span class="n">CFG_GBL_DATA_SIZE</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="err">@</span> <span class="n">move</span> <span class="n">to</span> <span class="n">reserved</span> <span class="n">a</span> <span class="n">couple</span> <span class="n">spots</span> <span class="k">for</span> <span class="n">abort</span> <span class="n">stack</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">str</span>  <span class="n">lr</span><span class="p">,</span> <span class="p">[</span><span class="n">r13</span><span class="p">]</span>            <span class="err">@</span> <span class="n">save</span> <span class="n">caller</span> <span class="n">lr</span> <span class="n">in</span> <span class="n">position</span> <span class="mi">0</span> <span class="n">of</span> <span class="n">saved</span> <span class="n">stack</span>
</span><span class='line'>  <span class="n">mrs</span>  <span class="n">lr</span><span class="p">,</span> <span class="n">spsr</span>           <span class="err">@</span> <span class="n">get</span> <span class="n">the</span> <span class="n">spsr</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">lr</span><span class="p">,</span> <span class="p">[</span><span class="n">r13</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>            <span class="err">@</span> <span class="n">save</span> <span class="n">spsr</span> <span class="n">in</span> <span class="n">position</span> <span class="mi">1</span> <span class="n">of</span> <span class="n">saved</span> <span class="n">stack</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r13</span><span class="p">,</span> <span class="err">#</span><span class="n">MODE_SVC</span>            <span class="err">@</span> <span class="n">prepare</span> <span class="n">SVC</span><span class="o">-</span><span class="n">Mode</span>
</span><span class='line'>  <span class="err">@</span> <span class="n">msr</span>   <span class="n">spsr_c</span><span class="p">,</span> <span class="n">r13</span>
</span><span class='line'>  <span class="n">msr</span>  <span class="n">spsr</span><span class="p">,</span> <span class="n">r13</span>          <span class="err">@</span> <span class="k">switch</span> <span class="n">modes</span><span class="p">,</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">moves</span> <span class="n">will</span> <span class="n">execute</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">lr</span><span class="p">,</span> <span class="n">pc</span>             <span class="err">@</span> <span class="n">capture</span> <span class="k">return</span> <span class="n">pc</span>
</span><span class='line'>  <span class="n">movs</span> <span class="n">pc</span><span class="p">,</span> <span class="n">lr</span>             <span class="err">@</span> <span class="n">jump</span> <span class="n">to</span> <span class="n">next</span> <span class="n">instruction</span> <span class="o">&amp;</span> <span class="k">switch</span> <span class="n">modes</span><span class="p">.</span>
</span><span class='line'>  <span class="p">.</span><span class="n">endm</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">macro</span> <span class="n">get_bad_stack_swi</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r13</span><span class="p">,</span> <span class="n">r13</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span>           <span class="err">@</span> <span class="n">space</span> <span class="n">on</span> <span class="n">current</span> <span class="n">stack</span> <span class="k">for</span> <span class="n">scratch</span> <span class="n">reg</span><span class="p">.</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r0</span><span class="p">,</span> <span class="p">[</span><span class="n">r13</span><span class="p">]</span>            <span class="err">@</span> <span class="n">save</span> <span class="n">R0</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">value</span><span class="p">.</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">_armboot_start</span>     <span class="err">@</span> <span class="n">get</span> <span class="n">data</span> <span class="n">regions</span> <span class="n">start</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="p">(</span><span class="n">CFG_MALLOC_LEN</span><span class="p">)</span> <span class="err">@</span> <span class="n">move</span> <span class="n">past</span> <span class="n">malloc</span> <span class="n">pool</span>
</span><span class='line'>  <span class="n">sub</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="p">(</span><span class="n">CFG_GBL_DATA_SIZE</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="err">@</span> <span class="n">move</span> <span class="n">past</span> <span class="n">gbl</span> <span class="n">and</span> <span class="n">a</span> <span class="n">couple</span> <span class="n">spots</span> <span class="k">for</span> <span class="n">abort</span> <span class="n">stack</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">lr</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">]</span>         <span class="err">@</span> <span class="n">save</span> <span class="n">caller</span> <span class="n">lr</span> <span class="n">in</span> <span class="n">position</span> <span class="mi">0</span> <span class="n">of</span> <span class="n">saved</span> <span class="n">stack</span>
</span><span class='line'>  <span class="n">mrs</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">spsr</span>           <span class="err">@</span> <span class="n">get</span> <span class="n">the</span> <span class="n">spsr</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">lr</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>         <span class="err">@</span> <span class="n">save</span> <span class="n">spsr</span> <span class="n">in</span> <span class="n">position</span> <span class="mi">1</span> <span class="n">of</span> <span class="n">saved</span> <span class="n">stack</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="p">[</span><span class="n">r13</span><span class="p">]</span>            <span class="err">@</span> <span class="n">restore</span> <span class="n">r0</span>
</span><span class='line'>  <span class="n">add</span>  <span class="n">r13</span><span class="p">,</span> <span class="n">r13</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span>           <span class="err">@</span> <span class="n">pop</span> <span class="n">stack</span> <span class="n">entry</span>
</span><span class='line'>  <span class="p">.</span><span class="n">endm</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">macro</span> <span class="n">get_irq_stack</span>           <span class="err">@</span> <span class="n">setup</span> <span class="n">IRQ</span> <span class="n">stack</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">IRQ_STACK_START</span>
</span><span class='line'>  <span class="p">.</span><span class="n">endm</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">macro</span> <span class="n">get_fiq_stack</span>           <span class="err">@</span> <span class="n">setup</span> <span class="n">FIQ</span> <span class="n">stack</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">FIQ_STACK_START</span>
</span><span class='line'>  <span class="p">.</span><span class="n">endm</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * exception handlers</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">undefined_instruction</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_bad_stack</span>
</span><span class='line'>  <span class="n">bad_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_undefined_instruction</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">software_interrupt</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_bad_stack_swi</span>
</span><span class='line'>  <span class="n">bad_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_software_interrupt</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">prefetch_abort</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_bad_stack</span>
</span><span class='line'>  <span class="n">bad_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_prefetch_abort</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">data_abort</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_bad_stack</span>
</span><span class='line'>  <span class="n">bad_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_data_abort</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">not_used</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_bad_stack</span>
</span><span class='line'>  <span class="n">bad_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_not_used</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef CONFIG_USE_IRQ</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">irq</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_irq_stack</span>
</span><span class='line'>  <span class="n">irq_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_irq</span>
</span><span class='line'>  <span class="n">irq_restore_user_regs</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">fiq</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_fiq_stack</span>
</span><span class='line'>  <span class="cm">/* someone ought to write a more effiction fiq_save_user_regs */</span>
</span><span class='line'>  <span class="n">irq_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_fiq</span>
</span><span class='line'>  <span class="n">irq_restore_user_regs</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">irq</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_bad_stack</span>
</span><span class='line'>  <span class="n">bad_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_irq</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="nl">fiq</span><span class="p">:</span>
</span><span class='line'>  <span class="n">get_bad_stack</span>
</span><span class='line'>  <span class="n">bad_save_user_regs</span>
</span><span class='line'>  <span class="n">bl</span>   <span class="n">do_fiq</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span> <span class="mi">5</span>
</span><span class='line'><span class="p">.</span><span class="n">global</span> <span class="n">arm1136_cache_flush</span>
</span><span class='line'><span class="nl">arm1136_cache_flush</span><span class="p">:</span>
</span><span class='line'>      <span class="n">mcr</span>  <span class="n">p15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="mi">0</span>    <span class="err">@</span> <span class="n">invalidate</span> <span class="n">I</span> <span class="n">cache</span>
</span><span class='line'>      <span class="n">mov</span>  <span class="n">pc</span><span class="p">,</span> <span class="n">lr</span>         <span class="err">@</span> <span class="n">back</span> <span class="n">to</span> <span class="n">caller</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#if defined(CONFIG_INTEGRATOR) &amp;&amp; defined(CONFIG_ARCH_CINTEGRATOR)</span>
</span><span class='line'><span class="cm">/* Use the IntegratorCP function from board/integratorcp/platform.S */</span>
</span><span class='line'><span class="cp">#elif defined(CONFIG_S3C64XX)</span>
</span><span class='line'><span class="cm">/* For future usage of S3C64XX*/</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>  <span class="p">.</span><span class="n">align</span>    <span class="mi">5</span>
</span><span class='line'><span class="p">.</span><span class="n">globl</span> <span class="n">reset_cpu</span>
</span><span class='line'><span class="nl">reset_cpu</span><span class="p">:</span>
</span><span class='line'>  <span class="n">ldr</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">rstctl</span> <span class="cm">/* get addr for global reset reg */</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mh">0x2</span> <span class="cm">/* full reset pll+mpu */</span>
</span><span class='line'>  <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">]</span> <span class="cm">/* force reset */</span>
</span><span class='line'>  <span class="n">mov</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span>
</span><span class='line'><span class="nl">_loop_forever</span><span class="p">:</span>
</span><span class='line'>  <span class="n">b</span>    <span class="n">_loop_forever</span>
</span><span class='line'><span class="nl">rstctl</span><span class="p">:</span>
</span><span class='line'>  <span class="p">.</span><span class="n">word</span> <span class="n">PM_RSTCTRL_WKUP</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#endif</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://i.imgur.com/Nn7Krru.gif" alt="suda-morris" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-06-13T23:15:44+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/kdm/'>kdm</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/u-boot/'>u-boot</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/06/13/u-boot-dot-lds/">
		
			u-boot.lds</a>
	</h2>
	<div class="entry-content">
		<figure class='code'><figcaption><span>u-boot.lds</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="n">OUTPUT_FORMAT</span><span class="p">(</span><span class="s">&quot;elf32-littlearm&quot;</span><span class="p">,</span> <span class="s">&quot;elf32-littlearm&quot;</span><span class="p">,</span> <span class="s">&quot;elf32-littlearm&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">OUTPUT_ARCH</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
</span><span class='line'><span class="n">ENTRY</span><span class="p">(</span><span class="n">_start</span><span class="p">)</span>
</span><span class='line'><span class="n">SECTIONS</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">.</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">;</span>
</span><span class='line'>  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'>  <span class="p">.</span><span class="nl">text</span>      <span class="p">:</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">cpu</span><span class="o">/</span><span class="n">s3c64xx</span><span class="o">/</span><span class="n">start</span><span class="p">.</span><span class="n">o</span>  <span class="p">(.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>    <span class="n">cpu</span><span class="o">/</span><span class="n">s3c64xx</span><span class="o">/</span><span class="n">s3c6410</span><span class="o">/</span><span class="n">cpu_init</span><span class="p">.</span><span class="n">o</span> <span class="p">(.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>    <span class="n">cpu</span><span class="o">/</span><span class="n">s3c64xx</span><span class="o">/</span><span class="n">onenand_cp</span><span class="p">.</span><span class="n">o</span> <span class="p">(.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>    <span class="n">cpu</span><span class="o">/</span><span class="n">s3c64xx</span><span class="o">/</span><span class="n">nand_cp</span><span class="p">.</span><span class="n">o</span>    <span class="p">(.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>    <span class="n">board</span><span class="o">/</span><span class="n">samsung</span><span class="o">/</span><span class="n">mini6410</span><span class="o">/</span><span class="n">nand_6410</span><span class="p">.</span><span class="n">fo</span>
</span><span class='line'>    <span class="n">cpu</span><span class="o">/</span><span class="n">s3c64xx</span><span class="o">/</span><span class="n">movi</span><span class="p">.</span><span class="n">o</span> <span class="p">(.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>    <span class="o">*</span><span class="p">(.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>    <span class="n">lib_arm</span><span class="o">/</span><span class="n">div0</span><span class="p">.</span><span class="n">o</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'>  <span class="p">.</span><span class="nl">rodata</span> <span class="p">:</span> <span class="p">{</span> <span class="o">*</span><span class="p">(.</span><span class="n">rodata</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'>  <span class="p">.</span><span class="nl">data</span> <span class="p">:</span> <span class="p">{</span> <span class="o">*</span><span class="p">(.</span><span class="n">data</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'>  <span class="p">.</span><span class="nl">got</span> <span class="p">:</span> <span class="p">{</span> <span class="o">*</span><span class="p">(.</span><span class="n">got</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">__u_boot_cmd_start</span> <span class="o">=</span> <span class="p">.;</span>
</span><span class='line'>  <span class="p">.</span><span class="nl">u_boot_cmd</span> <span class="p">:</span> <span class="p">{</span> <span class="o">*</span><span class="p">(.</span><span class="n">u_boot_cmd</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">__u_boot_cmd_end</span> <span class="o">=</span> <span class="p">.;</span>
</span><span class='line'>  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'>  <span class="p">.</span><span class="nl">mmudata</span> <span class="p">:</span> <span class="p">{</span> <span class="o">*</span><span class="p">(.</span><span class="n">mmudata</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'>  <span class="n">__bss_start</span> <span class="o">=</span> <span class="p">.;</span>
</span><span class='line'>  <span class="p">.</span><span class="nl">bss</span> <span class="p">:</span> <span class="p">{</span> <span class="o">*</span><span class="p">(.</span><span class="n">bss</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">_end</span> <span class="o">=</span> <span class="p">.;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://i.imgur.com/Nn7Krru.gif" alt="suda-morris" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-06-13T23:06:13+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/kdm/'>kdm</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/u-boot/'>u-boot</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/06/08/kdm-devenv/">
		
			KDM-DevEnv</a>
	</h2>
	<div class="entry-content">
		<h2>需要知道的知识点</h2>

<ol>
<li>ext4文件系统是Linux在PC机上最常用的磁盘文件系统，在嵌入式设备上则常用jffs2文件系统和yaffs2文件系统</li>
<li>在Linux操作系统中。对于SCSI磁盘。用sd*来表示，第一个磁盘x为a，第二个磁盘x为b，以此类推。磁盘上的第1个分区编号为1，第2个分区编号为2，以此类推。</li>
<li>swap分区用于Linux在运行期间的虚拟内存使用，其作用类似Windows中的交换文件pagefile.sys</li>
<li>ARM core的CPU在复位时通常都从0地址取它的第一条指令

<h2>开发环境搭建</h2>

<blockquote><ol>
<li>所使用的虚拟机是VirtualBox4.3.12，安装的虚拟机是UbuntuMate14.04</li>
<li>使用的开发板是友善出品的Tiny6410</li>
<li>虚拟机网络设置成桥接模式(笔记本的以太网卡，切勿错选成无线网卡)</li>
<li>虚拟机ip地址：192.168.1.88，网关192.168.1.1</li>
</ol>
</blockquote></li>
</ol>


<h2>系统烧写</h2>

<ol>
<li>Uboot中开发板的IP地址:192.168.1.230,网关192.168.1.1</li>
<li>开发板设置从SD卡启动，需要确保有一张烧写好UBoot的SD卡或者SDHC卡，Linux中的烧写方法：</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>#for SDHC Card,total sectors=15523840
</span><span class='line'>#dd iflag=dsync oflag=dsync if=u-boot-sd.bin of=/dev/sdb bs=512 count=16 seek=15522798
</span><span class='line'>#dd iflag=dsync oflag=dsync if=u-boot-sd.bin of=/dev/sdb bs=512 count=512 seek=15522030
</span><span class='line'>
</span><span class='line'>#for SD Card,total sectors=1961984
</span><span class='line'>dd iflag=dsync oflag=dsync if=u-boot-sd.bin of=/dev/sdb bs=512 count=16 seek=1961966
</span><span class='line'>dd iflag=dsync oflag=dsync if=u-boot-sd.bin of=/dev/sdb bs=512 count=512 seek=1961198
</span><span class='line'>sync
</span><span class='line'>#BL1:total sectors - 2 - 1024(if your SD Card Size &gt; 2G) -16
</span><span class='line'>#BL2:total sectors - 2 - 1024(if your SD Card Size &gt; 2G) -16 - 512 - 256</span></code></pre></td></tr></table></div></figure>


<ol>
<li>进入Uboot后，测试能否ping通虚拟主机：ping 192.168.1.88。在这之前可以先看看开发板的IP地址是否与虚拟主机在一个网段内，使用UBoot下的命令：pri</li>
<li>使用nfs命令获取虚拟主机上的uboot二进制文件供烧写(次UBoot是用来从NandFlash启动的，不能错选从SD卡启动的UBoot),成功以后会提示用户该文件的大小，这里记为filesize(切记要使用十六进制表示的数字)

<ul>
<li>nfs 50000000 192.168.1.88:/embeded/KDM/images/v1/u-boot.bin</li>
</ul>
</li>
<li>烧写uboot至NandFlash中

<ul>
<li>nand write.i 50000000 0 $(filesize)   从0地址开始烧写UBoot</li>
</ul>
</li>
<li>使用nfs命令获取虚拟主机上的kernel文件，成功以后会提示用户该文件的大小，这里记为filesize((切记要使用十六进制表示的数字))

<ul>
<li>nfs 50000000 192.168.1.88:/embeded/KDM/images/v1/Image</li>
</ul>
</li>
<li>烧写kernel到NandFlash中

<ul>
<li>nand write.i 50000000 80000 $(filesize)</li>
</ul>
</li>
<li>使用nfs命令获取虚拟主机上的根文件系统文件，成功以后会提示用户该文件的大小，这里记为filesize((切记要使用十六进制表示的数字))

<ul>
<li>nfs 50000000 192.168.1.88:/embeded/KDM/images/v1/yaff2.img</li>
</ul>
</li>
<li>烧写根文件系统到NandFlash中

<ul>
<li>nand write.yaffs 50000000 580000 $(filesize)</li>
</ul>
</li>
<li>根据需要修改启动参数并保存,例如

<ul>
<li>setenv bootargs root=/dev/mtdblock2 console=ttySAC0,115200</li>
<li>saveenv</li>
</ul>
</li>
</ol>


<h2>测试图形界面程序</h2>

<ul>
<li>图形界面工具使用的触摸屏校准程序为tslib源码附带的校准程序ts_calibrate,所以如果触摸屏没有校准，可以在Linux系统启动后运行/usr/local/bin/ts_calibrate程序对触摸屏进行校准(通过删除/etc/pointercal文件，可以使得图形界面工具自动调用ts_calibrate程序)，校准完毕会在etc目录下生成pointercal标准文件，供触摸屏库程序转换成符合屏幕的坐标，从而达到校准目的。</li>
</ul>


<h2>交叉编译器</h2>

<ul>
<li>arm-linux-gcc是一个“集合命令”，它包含了4个步骤：预处理，汇编，编译和链接，通过链接阶段便生成ELF格式的可执行文件。4个步骤对应执行的程序为arm-linux-cpp，arm-linux-as，ccl，arm-linux-ld。前三个步骤对应的命令行选项为：-E,-S，-c，如果没有任何参数，则代表经过这4个步骤产生可执行文件。</li>
<li>ELF文件的not stripped属性告诉我们在编译的时候产生的编译阶段需要的符号没有被删除</li>
<li>通常被编译出的程序都会使用到系统的动态库，而这些基本的动态库大部分也都是glibc库中的。例如open,read,write,select,ioctl等应用程序中的函数都是libc.so动态库中提供的，而glibc还提供了libm.so(数学库)，libcrypt.so(安全库)，libld.so(加载库)等。其中libld.so作为加载库负责在应用程序运行时，加载程序所使用到的动态库文件。在我们移植系统的过程中，这些最基本的动态库也需要被移植到根文件系统中去，这样才能保证程序被正常启动。</li>
<li>arm-linux-strip test可以删除可执行文件中不需要的编译符号和段描述信息</li>
<li>arm-linux-objcopy -O binary -S test test.bin 通常被用来将生成的ELF格式的文件转化为只含有二进制指令和程序数据的文件test.bin.也只有这样的二进制指令文件才能直接被硬件执行。</li>
<li>arm-linux-dump -D test > test.dis则是反编译，将ELF格式的可执行文件反编译成汇编信息文件test.dis，有助于代码的查看和调试</li>
<li>arm-linux-readelf -a test | grep &lsquo;Shared'用来获取ELF的头信息，grep 'Shared'是获取头信息中test可执行文件调用到的动态文件</li>
<li>arm-linux-gcc 针对arm11的设置：

<ol>
<li>&ndash;with-cpu=arm1176jzf-s</li>
<li>&ndash;with-tune=arm1176jzf-s</li>
<li>&ndash;with-float=softfp</li>
</ol>
</li>
</ul>


<h2>bootloader</h2>

<ul>
<li>目标机上的Bootloader通过串口与主机之间进行文件传输，传输协议通常是xmodem/ymodem/zmodem协议中的一种，但是，串口传输速度有限，因此通过以太网连接并借助tftp或者nfs协议来下载文件是个更好的选择</li>
<li>bootloader的stage1通常包括的步骤：

<ol>
<li>硬件设备初始化

<ul>
<li>屏蔽所有中断</li>
<li>设置CPU的速度和时钟频率</li>
<li>RAM初始化</li>
<li>关闭CPU内部指令/数据cache</li>
</ul>
</li>
<li>为加载Bootloader的stage2准备RAM空间</li>
<li>复制bootloader的stage2到RAM空间</li>
<li>设置好堆栈指针sp</li>
<li>跳转到stage2的C入口点（修改PC寄存器为核实的地址来实现）</li>
</ol>
</li>
<li>bootloader的stage2通常包括的步骤：

<ol>
<li>初始化本阶段要使用到的硬件设备

<ul>
<li>至少一个串口用来和终端用户进行I/O输出信息</li>
</ul>
</li>
<li>检测系统内存映射</li>
<li>将kernel镜像和根文件系统镜像从Flash上读到RAM空间中(需要编写Nand Flash裸驱动)</li>
<li>为内核设置启动参数

<ul>
<li>linux2.4以后的内核都期望以标记列表的形式来传递启动参数，启动参数标记列表以标记ATAG_CORE尅是，以标记ATAG_NONE结束</li>
<li>每个标记由标识被传递参数的tag_header结构以及随后的参数值数据结构来组成，数据结构tag和tag_header定义在Linux内核源码的include/asm/setup.h头文件中</li>
<li>在嵌入式Linux系统中，通常需要由Bootloader设置的常见启动参数有：ATAG_CORE,ATAG_MEN,ATAG_CMDLINE</li>
</ul>
</li>
<li>调用内核，跳转到内核第一条指令处，跳转时要满足下列条件

<ol>
<li>CPU寄存器的设置

<ul>
<li>R0=0</li>
<li>R1=机器类型ID，关于Machine Type Number可以参见linux/arch/arm/tools/mach-types</li>
<li>R2=启动参数标记列表在RAM中的起始基地址</li>
</ul>
</li>
<li>CPU模式

<ul>
<li> 必须禁止中断(IRQs和FIQs)</li>
<li>CPU必须处于SVC模式</li>
</ul>
</li>
<li>Cache和MMU的设置

<ul>
<li>MMU必须关闭</li>
<li>指令Cache可以打开亦可以关闭</li>
<li>数据Cache必须关闭</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li>U-boot目录结构

<ol>
<li>与处理器体系结构或者开发板硬件直接相关</li>
<li>通用的函数或者驱动程序</li>
<li>U-Boot的应用程序、工具或者文档</li>
</ol>
</li>
</ul>


<h2>Qt</h2>

<ul>
<li>Qt支持的嵌入式Linux平台需要有frambuffer支持</li>
<li>编译Qt源码

<ol>
<li></li>
</ol>
</li>
</ul>


<h2>编译tslib</h2>

<ol>
<li><a href="http://download.csdn.net/detail/liuqiqi677/3177449">源码下载地址</a></li>
<li>解压缩，进入tslib源码文件夹</li>
<li><code>./autogen.sh</code>生成configure源代码配置文件</li>
<li><code>./configure --host=arm-linux --disable-h3600 --disable-arctic2 --disable-mk712 --disable-collie --disable-corgi --disable-ucb1x00 --with-gnu-ld --prefix=/embeded/tslib_install ac_cv_func_malloc_0_nonnull=yes</code> 这里，&ndash;host的含义是你要安装的目标系统，后面的&ndash;disable 是因为我们不编译对指定触摸屏的支持，我们选择支持的是Linux的input子系统，&ndash;with-gnu-ld是确认使用GNU的LD连接器，因为我们使用的就是GNU的编译器，所以选择这一项。&ndash;prefix选项是指定安装的位置。ac_cv_func_malloc_0_nonnull会在./configure执行阶段测试GNU内置的malloc函数的功能是否可用或者说是否兼容</li>
<li>进入安装目录，这里是/embeded/tslib_install,进入etc目录，打开ts.conf进行修改.其中pthres主要用于处理触摸屏的灵敏度，而variance和dejitter分别用于处理触摸屏的滤波和去噪的算法，linear是触摸屏的坐标变换。

<ul>
<li>module_raw input</li>
<li>module pthres pmin=1</li>
<li>module variance delta=30</li>
<li>module dejitter delta=100</li>
<li>module linear</li>
</ul>
</li>
</ol>


<p><img src="http://i.imgur.com/Nn7Krru.gif" alt="suda-morris" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-06-08T22:30:05+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/develop/'>develop</a>, <a class='category' href='/blog/categories/kdm/'>kdm</a>, <a class='category' href='/blog/categories/linux/'>linux</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/06/08/gns3-install/">
		
			GNS3_Install</a>
	</h2>
	<div class="entry-content">
		<h2>GNS3模拟器安装步骤</h2>

<ol>
<li><a href="https://community.gns3.com/community/software/download/">下载GNS3</a>，并且安装</li>
<li><a href="https://community.gns3.com/community/software/download/">下载GNS3 IOU VM虚拟机镜像</a></li>
<li>下载路由器和交换机的IOS镜像文件(百度搜索并下载)

<ul>
<li>i86bi-linux-l2-ipbasek9-15.1g.bin(交换机)</li>
<li>i86bi-linux-l3-adventerprisek9-15.4.1T.bin(路由器)</li>
</ul>
</li>
<li>安装virtualbox</li>
<li>导入步骤2中下载的GNS3虚拟机镜像，设置网卡为hostonly，并启动虚拟机</li>
<li>GNS3是基于linux系统的，root用户登录，密码为cisco，然后查看网卡ip地址ifconfig</li>
<li>在浏览器中输入刚才查找到的IP地址，并指名端口号8000下的upload，例如：<a href="http://192.168.172.101:8000/upload">http://192.168.172.101:8000/upload</a></li>
<li>打开GNS3软件，在edit->Preference->Server中添加虚拟机的IP地址以及端口(ip地址来自步骤6)</li>
<li>在edit->Preference->IOS on UNIX中，指名iourc.txt的路径</li>
<li>在edit->Preference->IOU devices中，添加switch和router镜像路径(路径为上传到虚拟机中的具体路径，例如：/home/gns3/GNS3/images/IOU/i86bi-linux-l2-ipbasek9-15.1g.bin)</li>
<li>启动设备</li>
</ol>


<p><img src="http://i.imgur.com/Nn7Krru.gif" alt="suda-morris" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-06-08T11:24:09+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gns3/'>gns3</a>, <a class='category' href='/blog/categories/study/'>study</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/28/python-baseknowledge/">
		
			Python-BaseKnowledge</a>
	</h2>
	<div class="entry-content">
		<h2>Python中的常量</h2>

<figure class='code'><figcaption><span>常量定义</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="k">class</span> <span class="nc">_const</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">ConstError</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span> <span class="k">pass</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
</span><span class='line'>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span class='line'>          <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConstError</span><span class="p">,</span><span class="s">&quot;Can&#39;t rebind const(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">name</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
</span><span class='line'>          <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConstError</span><span class="p">,</span><span class="s">&quot;Can&#39;t unbind const(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">name</span>
</span><span class='line'>      <span class="k">raise</span> <span class="ne">NameError</span><span class="p">,</span> <span class="n">name</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">_const</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>把以上代码变成const.py文件放到Python安装目录的Lib文件夹下</li>
</ul>


<h2>引号的使用与区别</h2>

<ol>
<li>单引号与双引号可以交叉使用，即双引号中的单引号维持原样，单引号中的双引号维持原样</li>
<li>三引号里面不能使用单引号和双引号，三引号中的格式维持不变，该回车就回车，该空格就空格</li>
<li>当需要把转义字符原样输出的时候可以使用自然字符串，即在字符串前面加r</li>
<li>子字符串运算方法：

<ul>
<li>索引运算（从0开始索引）</li>
<li>切片运算（[a:b]是指从第a下标开始到第b-1下标结束，同样第一位下标为0）</li>
</ul>
</li>
<li>列表中的元素是有序的

<ul>
<li>students=[&ldquo;小明&rdquo;,&ldquo;小华&rdquo;,&ldquo;小李&rdquo;,&ldquo;小娟&rdquo;,&ldquo;小云&rdquo;]，下标从0开始</li>
</ul>
</li>
<li>元祖里面的内容只能读取，不能修改，列表里面的内容既可以修改，又能读取

<ul>
<li>students=(&ldquo;小明&rdquo;,&ldquo;小华&rdquo;,&ldquo;小李&rdquo;,&ldquo;小娟&rdquo;,&ldquo;小云&rdquo;)</li>
</ul>
</li>
<li>Python中集合主要有两个功能，一个功能是建立关系，另一个是消除重复元素，集合的格式是：set(元素)

<ul>
<li>交集：&amp;</li>
<li>并集：|</li>
<li>差集：-</li>
<li>消除重复元素：new=set(a)</li>
</ul>
</li>
<li>字典也叫关联数组，用大括号括起来

<ul>
<li>k={&ldquo;name&rdquo;:&ldquo;Java&rdquo;,&ldquo;IDE&rdquo;:&ldquo;Eclipse&rdquo;}</li>
<li>print k[&ldquo;IDE&rdquo;]</li>
<li>添加字典里面的项目k[&ldquo;User&rdquo;]=&ldquo;morris&rdquo;</li>
</ul>
</li>
<li>Python中的标识符第一个字符必须只能是字母或者下划线，之后的部分可以使字母，下划线或者数组</li>
<li>在Python中，如果有一些对象需要持久性存储，并且不丢失我们这个对象的类型与数据，我们需要将这些对象进行序列化，序列化之后，需要使用的时候我们再回复为原来的数据。序列化的这种过程我们称之为pickle（腌制）

<ul>
<li>import pickle</li>
<li>lista=[&ldquo;mingyue&rdquo;,&ldquo;jishi&rdquo;,&ldquo;you&rdquo;]</li>
<li>listb=pickle.dumps(lista)#序列化</li>
<li>listc=pickle.loads(listb)#将对象原样恢复</li>
<li>group1=(&ldquo;bajiu&rdquo;,&ldquo;wen&rdquo;,&ldquo;qingtian&rdquo;)</li>
<li>f1=file(&lsquo;1.pkl&rsquo;,&lsquo;wb&rsquo;)</li>
<li>pickle.dump(group1,f1,True)</li>
<li>f1.close()</li>
<li>f2=file(&lsquo;1.pkl&rsquo;,&lsquo;rb&rsquo;)</li>
<li>t=pickle.load(f2)</li>
<li>f2.close()</li>
</ul>
</li>
<li>Python的行连接符：\</li>
<li></li>
</ol>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-05-28T21:42:24+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/python/'>python</a>, <a class='category' href='/blog/categories/study/'>study</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/28/cordova-startup/">
		
			Cordova-Startup</a>
	</h2>
	<div class="entry-content">
		<h2>Cordova环境部署</h2>

<ul>
<li><a href="https://nodejs.org">安装nodejs</a>,注意添加到环境变量PATH中</li>
<li>安装Cordova CLI： npm install -g cordova</li>
<li><a href="http://java.oracle.com">安装Java JDK</a>,注意添加环境变量CLASSPATH，和PATH</li>
<li><a href="http://developer.android.com/sdk/index.html">安装Android SDK</a>，注意把platform-tools和tools添加到PATH环境变量</li>
<li><a href="http://ant.apache.org/">安装Ant</a>,注意把bin目录添加到PATH环境变量中</li>
<li>测试：

<ol>
<li>npm -v</li>
<li>java -version</li>
<li>adb version</li>
<li>ant -v</li>
<li>cordova -v</li>
</ol>
</li>
<li>cordova常用命令：

<ol>
<li><code>cordova creat 项目名称 包名 APP显示名称</code></li>
<li><code>cordova build</code></li>
<li><code>cordova run --device</code></li>
</ol>
</li>
</ul>


<h2>Cordova启动流程</h2>

<ol>
<li>原生代码启动</li>
<li>splashscreen</li>
<li>Load HTML</li>
<li>顺序执行JavaScript，执行$(document).ready()</li>
<li>Cordova.js执行(异步执行)</li>
<li>deviceready</li>
<li>Cordova插件可用</li>
</ol>


<p><img src="http://i.imgur.com/Nn7Krru.gif" alt="suda-morris" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-05-28T10:43:48+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/cordova/'>cordova</a>, <a class='category' href='/blog/categories/study/'>study</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/25/microsoft-office-word-skills/">
		
			Microsoft-Office-Word-Skills</a>
	</h2>
	<div class="entry-content">
		<h2>从任意页开始设置页码</h2>

<ol>
<li>将鼠标光标点击到开始编页码的前一页末尾</li>
<li>点击菜单栏的<code>页面布局</code></li>
<li>在<code>页面布局</code>栏目下，点击分隔符后面的倒三角</li>
<li>弹出分隔符的相关功能栏目，点击<code>下一页</code></li>
<li>双击页眉的位置，激活页眉编辑</li>
<li>在需要开始编页码的那页页眉处点击<code>链接到前一页页眉</code></li>
<li>移动光标到本页的页脚，并激活页脚编辑</li>
<li>在同一页（即需要开始编页码的那页）的页脚处点击<code>链接到前一页页眉</code></li>
<li>然后在需要开始编页码的页脚处点击<code>页码</code>->设置页码格式，将起始页设置为1</li>
<li>点击进入<code>插入</code>菜单栏，选择<code>页码</code>,选择喜欢的页码格式</li>
</ol>


<h2>公式居中标号居右</h2>

<ol>
<li>在视图工具栏中打开标尺</li>
<li>公式先居中，在标尺上记录下此时公式的位置，根据标号长度大于预估距离页边的距离，并在标尺上做标记(此时应该有两个标记)，设置标记属性(只要在其中一个标记上双击即可)，将公式标号的位置属性设置为【右对齐】</li>
<li>将公式靠左对齐，紧跟其后写上标号。</li>
<li>光标紧跟公式前面，按下Tab键，公式即可跳到标尺上的第一个标记处。光标置于公式标号前，再按下Tab键，公式标号跳到靠近标尺末尾处，此时鼠标拖动第二个标记至标尺最右端，公式标号保证靠右对齐！</li>
</ol>


<p><img src="http://i.imgur.com/Nn7Krru.gif" alt="suda-morris" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-05-25T10:45:43+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/office/'>office</a>, <a class='category' href='/blog/categories/practise/'>practise</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/24/ubuntu-mate-14-04-2-lts-install/">
		
			Ubuntu-Mate-14-04-2-LTS-Install</a>
	</h2>
	<div class="entry-content">
		<h2>Ubuntu-Mate14.04.2-LTS安装</h2>

<ol>
<li><a href="https://ubuntu-mate.org/">进入Ubutnu-Mate官网下载ISO镜像后安装到虚拟机</a></li>
<li>安装结束后，打开自带的软件中心，进入->编辑->软件源，选择访问速度最快的国内镜像站(软件可以自动选取速度最快的站点)</li>
<li>依次安装以下软件，安装命令为:<code>sudo apt-get install</code>

<ul>
<li>文本编辑器:gedit vim</li>
<li>基本开发工具：build-essential</li>
<li>生成工程Makefile的工具：autoconf automake</li>
<li>词法扫描分析工具：flex bison texinfo git-core gnupg gperf valgrind</li>
<li>C语言函数用户手册：manpages-dev libncurses-dev libsdl-dev libesd0-dev libwxgtk2.6-dev ncurses-dev</li>
<li>其他程序的用户手册：binutils-doc cpp-doc gcc-doc glib-doc stl-manual</li>
<li>压缩工具： zip</li>
<li>网络工具: curl</li>
<li>串口工具：minicom，完了以后修改minicom的配置权限：<code>sudo chown morris：morris /etc/minicom/minirc.dfl</code></li>
<li>Ubuntu-Tweak工具安装：

<ul>
<li>添加tweak源：sudo add-apt-repository ppa:tualatrix/ppa</li>
<li>更新：sudo apt-get update</li>
<li>安装ubuntu-tweak：sudo apt-get install ubuntu-tweak</li>
</ul>
</li>
<li>超强vim配置文件：wget -qO- <a href="https://raw.github.com/ma6174/vim/master/setup.sh">https://raw.github.com/ma6174/vim/master/setup.sh</a> | sh -x</li>
<li>下载工具：uget与aria2

<ul>
<li><code>sudo add-apt-repository ppa:plushuang-tw/uget-stable</code></li>
<li><code>sudo ap-get update</code></li>
<li><code>sudo apt-get install uget</code></li>
<li><code>sudo apt-get install aria2</code></li>
<li>打开uget软件，进入插件设置，选择aria插件</li>
<li>修改最大连接数为16</li>
</ul>
</li>
<li>输入法工具安装：fcitx:

<ul>
<li><code>sudo apt-get install fcitx-table-wbpy</code></li>
<li>进入<code>语言支持</code>->把<code>键盘输入方式系统</code>改为<code>fcitx</code>，重启系统</li>
</ul>
</li>
<li>用WPS替换掉Ubuntu自带的Office</li>
<li>去<a href="http://www.qt.io/download/">Qt官网</a>下载QtCreator</li>
<li>安装Lua5.3：

<ul>
<li><a href="http://www.lua.org/ftp">下载安装源码</a></li>
<li>安装库文件：<code>sudo apt-get install libreadline</code>和<code>sudo apt-get install libreadline-gplv2-dev</code></li>
<li>进入源码顶层目录，修改Makefile里面的软件安装地址</li>
<li>修改完成后，<code>make linux</code>然后<code>make install</code></li>
</ul>
</li>
<li>编译crosstool-ng需要的安装环境
  <code>sudo apt-get install bison flex texinfo automake libtool cvs patch curl gcj subversion gawk cvsd gperf libexpat1-dev</code></li>
</ul>
</li>
<li>VirtualBox安装增强工具

<ul>
<li>进入VirtualBox设备->安装增强工具</li>
<li>在Ubuntu中，进入挂在的CD(一般在media下)，运行sudo ./VBoxLinuxAdditions.run后等待完成安装</li>
</ul>
</li>
<li>设置root密码：<code>sudo passwd root</code></li>
<li>修改Ubuntu默认JDK配置

<ol>
<li>将要添加的JDK加入Java菜单选项

<ul>
<li><code>update-alternatives --install /usr/bin/java java /usr/lib/jvm/java/jdk1.6.0_12/bin/java 300</code></li>
<li><code>update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/java/jdk1.6.0_12/bin/javac 300</code></li>
</ul>
</li>
<li>修改默认JDK

<ul>
<li><code>sudo update-alternatives --config java</code></li>
</ul>
</li>
</ol>
</li>
<li>NFS远程文件系统

<ol>
<li>安装NFS服务器：<code>sudo apt-get install nfs-kernel-server portmap</code></li>
<li>配置远程主机共享目录：

<ul>
<li>设置一个共享目录的方法是修改/etc/exports文件，增加一行例如:<code>/embeded/WenRisOS/NFS_doc *(rw,sync,no_root_squash)</code></li>
</ul>
</li>
<li>重启服务:<code>sudo /etc/init.d/nfs-kernel-server restart</code></li>
<li>检测NFS服务是否设置正常：<code>showmount -e</code></li>
<li>目标板挂载远程主机：mount -o nolock -t nfs 192.168.1.88:/embeded/WenRisOS/NFS_doc /mnt</li>
<li>使用uboot的nfs命令下载远程主机文件到开发板内存：<code>nfs 0x32000000 192.168.1.11:/work/system/linux/arch/arm/boot/uImage</code></li>
</ol>
</li>
<li>FTP服务器软件配置：

<ol>
<li>安装FTP服务：<code>sudo apt-get install vsftpd</code></li>
<li>修改FTP服务配置文件:<code>sudo vim /etc/vsftpd.conf</code>

<ul>
<li>使能listen,local_enable,write_enable</li>
</ul>
</li>
<li>重启FTP服务

<ul>
<li><code>sudo /etc/init.d/vsftpd restart</code></li>
</ul>
</li>
</ol>
</li>
<li>JLink安装

<ul>
<li><a href="https://www.segger.com/jlink-software.html">官网下载J-Link安装压缩包</a></li>
<li>注意选择Linux安装包的时候匹配操作系统的位数，这里下载了64位Linux系统的TGA压缩包，版本5.0</li>
<li>下载好的压缩包解压缩，打开里面的README.txt,按照其要求作相应的操作，各个本版可能要求不同，拿5.0来说，这里需要执行命令：<code>sudo cp 99-jlink.rules /etc/udev/rules.d/</code></li>
<li>最后接入JLink的USB接口，打开软件：<code>./JLinkExe</code>,如果显示usb连接不上，请检查USB是否连接可靠，虚拟机是否已经从实体机那获得了该JLink接口，多插拔几次，在该软件中使用命令usb可以尝试再次连接usb接口，如果成功，会出现类似如下的文字：</li>
</ul>
</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>J-Link&gt;usb
</span><span class='line'>Connecting to J-Link via USB (Port: 0)
</span><span class='line'>DLL version V5.00, compiled Jun  8 2015 21:14:03
</span><span class='line'>Firmware: J-Link ARM V8 compiled Nov 28 2014 13:44:46
</span><span class='line'>Hardware: V8.00
</span><span class='line'>S/N: 158000503 
</span><span class='line'>Feature(s): RDI,FlashDL,FlashBP,JFlash,GDBFull 
</span><span class='line'>VTarget = 3.319V
</span><span class='line'>Info: TotalIRLen = 9, IRPrint = 0x0011
</span><span class='line'>Found 2 JTAG devices, Total IRLen = 5:
</span><span class='line'>  #0 Id: 0x2B900F0F, IRLen: 04, IRPrint: 0x0, ARM ETB
</span><span class='line'>  #1 Id: 0x07B76F0F, IRLen: 05, IRPrint: 0x1, ARM1176 Core
</span><span class='line'>ARM11 identified.
</span><span class='line'>Target interface speed: 100 kHz
</span><span class='line'>J-Link&gt;</span></code></pre></td></tr></table></div></figure>


<h2>常见问题及解决方法</h2>

<ol>
<li>在Ubuntu登陆界面输入密码之后，黑屏一闪后，又跳转到登录界面。

<ul>
<li>原因：主目录下的.Xauthority文件拥有者变成了root，从而以用户登陆的时候无法都取.Xauthority文件。</li>
<li>方法1：将.Xauthority的拥有者改为登陆用户。开机后在登陆界面按下shift + ctrl + F1进入tty命令行终端登陆后输入: sudo chown 用户名:用户名 .Xauthority</li>
<li>方法2：命令行输入：dpkg-reconfigure lightdm重新配置登陆器，重启</li>
</ul>
</li>
<li>如何在64位系统上编译32位可执行程序

<ul>
<li>确认当前架构为64位的内核

<ul>
<li>打开终端输入<code>dpkg --print-architecture</code>,如果看到amd64表示已经拥有了64位架构的内核</li>
</ul>
</li>
<li>确认打开了多核架构的支持功能

<ul>
<li>打开终端输入<code>dpkg --print-foreign-architecture</code>,如果看到输出i386表示已经打开了多架构支持</li>
<li>如果没有打开，使用如下方法：

<ul>
<li>下载更新然后运行：<code>sudo dpkg --add-architecture i386</code>，然后<code>sudo apt-get update</code></li>
<li>输入<code>sudo apt-get -f dist-upgrade</code>检查已经拥有的库文件是否有更新版本</li>
</ul>
</li>
</ul>
</li>
<li>安装兼容包

<ul>
<li><code>sudo apt-get install libc6:i386</code></li>
<li><code>sudo apt-get install gcc-multilib g++-multilib</code></li>
<li><code>sudo apt-get install lib32z1 lib32ncurses5 lib32bz2-1.0 libgtk2.0-0:i386 libpangox-1.0-0:i386 libpangoxft-1.0-0:i386 libidn11:i386 gstreamer0.10-pulseaudio:i386 gstreamer0.10-plugins-base:i386 gstreamer0.10-plugins-good:i386</code></li>
</ul>
</li>
<li>注意，在13.10后Ubuntu不提供ia32-libs的套件了，但是还是可以这样来安装：</li>
</ul>


<pre><code class="`Shell Ubuntu14.04安装ia32-libs库"> sudo -i
 cd /etc/apt/sources.list.d
 echo "deb http://archive.ubuntu.com/ubuntu/ raring main restricted universe multiverse" &gt;ia32-libs-raring.list
 apt-get update
 apt-get install ia32-libs
 rm /etc/apt/sources.list.d/ia32-libs-raring.list
 apt-get update
 exit
 sudo apt-get install gcc-multilib
</code></pre></li>
</ol>


<p><img src="http://i.imgur.com/Nn7Krru.gif" alt="suda-morris" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-05-24T20:02:37+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/software/'>software</a>, <a class='category' href='/blog/categories/ubuntu/'>ubuntu</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/23/nuvoton-m451-eadc/">
		
			Nuvoton-M451-EADC</a>
	</h2>
	<div class="entry-content">
		<h2>新唐CortexM4内核芯片M451学习之&mdash;-模数转换EADC</h2>

<blockquote><ul>
<li>包含一个12位带16个外部输入通道或者8对差分模拟输入通道和3个内部通道的SAR-ADC(逐次逼近型模数转换器)</li>
<li>可以通过软件触发，PWM0/1触发，timer0~3溢出脉冲触发，ADINT0，ADINT1中断EOC(转换结束)脉冲触发和外部管脚(STADC)输入信号来启动转换</li>
<li>Vref最大5V，12位分辨率，保证10位精度</li>
<li>3个内部通道，分别为带隙电压,温度传感器和电池源</li>
<li>4个独立中断向量地址的ADC中断(ADINT0~3)</li>
<li>最大ADC时钟频率是20MHz</li>
<li>高达1Msps采样频率</li>
<li>内部采样时间可配置</li>
<li>双缓存用于采样控制逻辑模块0~3</li>
<li>转换结果存在18个数据寄存器中，带有效/溢出提示标志</li>
<li>支持PDMA</li>
<li>共有4个ADC中断ADINT0~3，每个中断有自己的中断向量地址并且ADINT0/ADINT1可以配置多个采样模块EOC脉冲(采样模块0~18的转换结束脉冲)作为它们的中断触发源</li>
<li>ADC控制器提供4个比较寄存器<code>EADC_CMP0~EADC_CMP3</code>来监控从采样模块0~18中指定的最多4个模块的A/D转换结果</li>
<li>DC控制器支持窗口比较模式，用户可以通过CMPWEN使能这个功能。如果用户使能了这个功能，当<code>EADC_CMP0</code>和<code>EADC_CMP1</code>比较条件都匹配时，ADCMPF0被置位。当<code>EADC_CMP2</code>和<code>EADC_CMP3</code>比较条件都匹配时，ADCMPF2将被置位</li>
<li>触发延时时间=<code>TRGDLYCNT*ADC_CLK*n</code>(n=1,2,4,16来自TRGDLYDIV设置).</li>
</ul>
</blockquote>

<h2>中断源</h2>

<p><img src="http://i.imgur.com/6HZ5VTs.png" alt="Nuvoton-M451-EADC中断源" /></p>

<h2>API</h2>

<p><img src="http://i.imgur.com/Nn7Krru.gif" alt="suda-morris" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-05-23T22:28:12+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/nuvoton-m451/'>nuvoton-m451</a>, <a class='category' href='/blog/categories/study/'>study</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/posts/2" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    suda-morris

Powered by Octopress-WenRis Group
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>